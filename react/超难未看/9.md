> ğŸ’­ å—¯ï¼Œç”¨æˆ·çš„é—®é¢˜æ˜¯å…³äºåœ¨ä½¿ç”¨React.lazyå’ŒSuspenseå®ç°ä»£ç åˆ†å‰²æ—¶ï¼Œç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­äº¤äº’çŠ¶æ€ä¸¢å¤±çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å¯èƒ½å‡ºç°åœ¨ç”¨æˆ·ä¸é¡µé¢äº¤äº’æ—¶ï¼Œæ¯”å¦‚ç‚¹å‡»å±•å¼€ä¸€ä¸ªä¸‹æ‹‰èœå•ï¼Œä½†å½“ç»„ä»¶æ­£åœ¨æ‡’åŠ è½½æ—¶ï¼ŒSuspenseçš„fallbackå¯èƒ½ä¼šæš‚æ—¶æ›¿æ¢æ‰ç»„ä»¶ï¼Œå¯¼è‡´ä¹‹å‰çš„çŠ¶æ€ä¸¢å¤±ã€‚
>
> é¦–å…ˆï¼Œæˆ‘è¦ç¡®å®šç”¨æˆ·çš„å…·ä½“åœºæ™¯ã€‚å‡è®¾ç”¨æˆ·æœ‰ä¸€ä¸ªåŠ¨æ€å¯¼å…¥çš„ç»„ä»¶ï¼Œå½“è¯¥ç»„ä»¶ç¬¬ä¸€æ¬¡åŠ è½½æ—¶ï¼Œä¼šæ˜¾ç¤ºfallbackï¼ˆå¦‚åŠ è½½åŠ¨ç”»ï¼‰ã€‚å¦‚æœç”¨æˆ·åœ¨è§¦å‘åŠ è½½ä¹‹åã€ç»„ä»¶åŠ è½½å®Œæˆä¹‹å‰è¿›è¡Œäº†ä¸€äº›äº¤äº’æ“ä½œï¼ˆæ¯”å¦‚è¾“å…¥æ–‡æœ¬ã€å±•å¼€èœå•ï¼‰ï¼Œè¿™äº›çŠ¶æ€å¯èƒ½åœ¨ç»„ä»¶åŠ è½½å®Œæˆåä¸¢å¤±ï¼Œå› ä¸ºSuspenseä¼šé‡æ–°æŒ‚è½½å­æ ‘ï¼Œå¯¼è‡´å­ç»„ä»¶çš„çŠ¶æ€é‡ç½®ã€‚
>
> ç”¨æˆ·çš„èº«ä»½å¯èƒ½æ˜¯ä¸€ä¸ªä¸­é«˜çº§çš„å‰ç«¯å¼€å‘è€…ï¼Œæ­£åœ¨ä¼˜åŒ–åº”ç”¨æ€§èƒ½ï¼Œä½¿ç”¨ä»£ç åˆ†å‰²æ¥å‡å°‘åˆå§‹åŒ…ä½“ç§¯ï¼Œä½†é‡åˆ°äº†ç”¨æˆ·ä½“éªŒçš„é—®é¢˜ã€‚ä»–ä»¬çš„ç›®æ ‡æ˜¯åœ¨ä¿æŒä»£ç åˆ†å‰²ä¼˜åŠ¿çš„åŒæ—¶ï¼Œé¿å…çŠ¶æ€ä¸¢å¤±ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
>
> éœ€è¦è§£å†³çš„é—®é¢˜æ˜¯æ€æ ·åœ¨Suspenseçš„fallbackæ˜¾ç¤ºæœŸé—´ä¿æŒçˆ¶ç»„ä»¶çš„çŠ¶æ€ï¼Œæˆ–è€…åœ¨ç»„ä»¶åŠ è½½å®Œæˆåæ¢å¤å­ç»„ä»¶çš„çŠ¶æ€ã€‚å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œå½“çˆ¶ç»„ä»¶ç®¡ç†æŸäº›çŠ¶æ€ï¼Œå¹¶ä¸”è¿™äº›çŠ¶æ€ä¼ é€’ç»™æ‡’åŠ è½½çš„å­ç»„ä»¶æ—¶ï¼Œç”±äºå­ç»„ä»¶çš„åŠ è½½è¿‡ç¨‹ä¸­è§¦å‘äº†é‡æ–°æ¸²æŸ“ï¼Œå¯¼è‡´çŠ¶æ€æ²¡æœ‰è¢«æ­£ç¡®ä¿ç•™ã€‚
>
> å¯èƒ½çš„åŸå› åŒ…æ‹¬ï¼šç»„ä»¶æ‡’åŠ è½½è§¦å‘äº†çˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œæˆ–è€…åœ¨Suspenseè¾¹ç•Œå†…çš„ç»„ä»¶é‡æ–°æŒ‚è½½å¯¼è‡´çŠ¶æ€é‡ç½®ã€‚Reactçš„Suspenseåœ¨ç­‰å¾…æ‡’åŠ è½½ç»„ä»¶æ—¶ï¼Œä¼šå¸è½½å½“å‰çš„å­æ ‘å¹¶æ˜¾ç¤ºfallbackï¼Œå½“åŠ è½½å®Œæˆåï¼Œé‡æ–°æŒ‚è½½å­æ ‘ï¼Œè¿™ä¼šå¯¼è‡´å­ç»„ä»¶çš„çŠ¶æ€ä¸¢å¤±ï¼Œå› ä¸ºæ¯æ¬¡æŒ‚è½½éƒ½æ˜¯æ–°çš„å®ä¾‹ã€‚
>
> è§£å†³æ–¹æ¡ˆçš„æ€è·¯å¯èƒ½åŒ…æ‹¬ï¼š
>
> 1. **å°†çŠ¶æ€æå‡åˆ°Suspenseå¤–éƒ¨çš„çˆ¶ç»„ä»¶ä¸­**ï¼šç¡®ä¿çŠ¶æ€ç”±Suspenseå¤–çš„ç»„ä»¶ç®¡ç†ï¼Œè¿™æ ·å³ä½¿å†…éƒ¨çš„å­æ ‘é‡æ–°æŒ‚è½½ï¼ŒçŠ¶æ€ä»è¢«ä¿ç•™ï¼Œå¹¶åœ¨åŠ è½½åé‡æ–°ä¼ å…¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¡¨å•çŠ¶æ€ç”±çˆ¶ç»„ä»¶ç®¡ç†ï¼Œå­ç»„ä»¶åªæ˜¯æ¥æ”¶propsï¼Œé‚£ä¹ˆåœ¨æ‡’åŠ è½½å®Œæˆåï¼Œçˆ¶ç»„ä»¶å¯ä»¥å°†ä¹‹å‰çš„çŠ¶æ€ä¼ é€’ç»™æ–°çš„å­ç»„ä»¶å®ä¾‹ï¼Œä¿æŒä¸€è‡´æ€§ã€‚
>
> 2. **ä½¿ç”¨Reactçš„çŠ¶æ€ç®¡ç†åº“ï¼ˆå¦‚Contextæˆ–Reduxï¼‰**ï¼šå°†äº¤äº’çŠ¶æ€å­˜å‚¨åœ¨å…¨å±€çŠ¶æ€ä¸­ï¼Œè¿™æ ·å³ä½¿ç»„ä»¶å¸è½½å†é‡æ–°æŒ‚è½½ï¼Œä¹Ÿèƒ½ä»å…¨å±€çŠ¶æ€ä¸­æ¢å¤ã€‚
>
> 3. **é¿å…åœ¨æ‡’åŠ è½½ç»„ä»¶ä¸­ä½¿ç”¨å†…éƒ¨çŠ¶æ€**ï¼šè®¾è®¡ç»„ä»¶ä¸ºå—æ§ç»„ä»¶ï¼Œä¾èµ–çˆ¶ç»„ä»¶ä¼ é€’çš„propsæ¥ç®¡ç†çŠ¶æ€ï¼Œè¿™æœ‰åŠ©äºåœ¨é‡æ–°æŒ‚è½½æ—¶æ¢å¤çŠ¶æ€ã€‚
>
> 4. **ä½¿ç”¨Memoizationæˆ–åœ¨çˆ¶çº§ç¼“å­˜æ•°æ®**ï¼šå¦‚æœå­ç»„ä»¶éœ€è¦åŠ è½½æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘åœ¨çˆ¶çº§ç¼“å­˜æ•°æ®ï¼Œé¿å…æ¯æ¬¡åŠ è½½ç»„ä»¶æ—¶é‡æ–°è·å–ã€‚
>
> å¯èƒ½éœ€è¦å…·ä½“çš„ä»£ç ç¤ºä¾‹æ¥è¯´æ˜è¿™äº›æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æœ‰ä¸€ä¸ªæŒ‰é’®å±•å¼€ä¸‹æ‹‰èœå•ï¼Œè¯¥ä¸‹æ‹‰èœå•æ˜¯æ‡’åŠ è½½çš„ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œå¼€å§‹åŠ è½½ç»„ä»¶ï¼ŒåŒæ—¶è§¦å‘Suspenseçš„fallbackã€‚åœ¨æ­¤æœŸé—´ï¼ŒæŒ‰é’®çš„çŠ¶æ€ï¼ˆå¦‚æ˜¯å¦å±•å¼€ï¼‰éœ€è¦è¢«ä¿ç•™ï¼Œä»¥ä¾¿ç»„ä»¶åŠ è½½åæ­£ç¡®æ˜¾ç¤ºä¸‹æ‹‰å†…å®¹ã€‚
>
> å¦å¤–ï¼Œå¯èƒ½éœ€è¦æ³¨æ„Reactçš„ç‰ˆæœ¬å’ŒSuspenseçš„è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯åœ¨å¹¶å‘æ¨¡å¼ä¸‹ï¼Œæ˜¯å¦ä¼šå½±å“ç»„ä»¶çš„æŒ‚è½½å’Œå¸è½½æ–¹å¼ã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨åŠ è½½è¿‡ç¨‹ä¸­æœ‰å¼‚æ­¥æ“ä½œï¼Œéœ€è¦ç¡®ä¿ç»„ä»¶åŠ è½½å®Œæˆåçš„çŠ¶æ€ä¸€è‡´æ€§é—®é¢˜ã€‚
>
> éœ€è¦è¿›ä¸€æ­¥è§£é‡Šå½“Suspenseæ˜¾ç¤ºfallbackæ—¶ï¼Œå­ç»„ä»¶ä¼šè¢«å¸è½½ï¼Œå¯¼è‡´å…¶å†…éƒ¨çŠ¶æ€ä¸¢å¤±ã€‚å¦‚æœäº¤äº’çŠ¶æ€ä¾èµ–äºç”¨æˆ·è¾“å…¥ï¼ˆå¦‚æ–‡æœ¬æ¡†çš„å€¼ï¼‰ï¼Œè¿™éƒ¨åˆ†å¦‚æœç”±å­ç»„ä»¶è‡ªå·±ç®¡ç†ï¼Œé‚£ä¹ˆåœ¨åŠ è½½åå­ç»„ä»¶é‡æ–°æŒ‚è½½ï¼ŒçŠ¶æ€å°±ä¼šä¸¢å¤±ã€‚è§£å†³æ–¹æ¡ˆä¹‹ä¸€æ˜¯å°†è¿™ç§çŠ¶æ€æå‡åˆ°çˆ¶ç»„ä»¶ï¼Œæˆ–è€…åœ¨å¤–éƒ¨å­˜å‚¨ï¼Œä»¥ä¾¿é‡æ–°æŒ‚è½½åæ¢å¤ã€‚
>
> å¯èƒ½éœ€è¦åˆ†æ­¥éª¤è¯´æ˜å¦‚ä½•å®ç°çŠ¶æ€æå‡ï¼Œæˆ–è€…å¦‚ä½•åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨useStateæ¥ç®¡ç†è¿™äº›äº¤äº’çŠ¶æ€ï¼Œç„¶åå°†å®ƒä»¬ä½œä¸ºpropsä¼ é€’ç»™æ‡’åŠ è½½çš„å­ç»„ä»¶ã€‚åŒæ—¶ï¼Œå¦‚ä½•å¤„ç†åŠ è½½æœŸé—´çš„äº¤äº’äº‹ä»¶ï¼Œæ¯”å¦‚é˜²æ­¢ç”¨æˆ·åœ¨åŠ è½½è¿‡ç¨‹ä¸­é‡å¤ç‚¹å‡»ï¼Œæˆ–è€…å…¶ä»–éœ€è¦ä¿æŒçš„UIçŠ¶æ€ã€‚
>
> æ€»ç»“å›ç­”æ—¶éœ€è¦ç»™å‡ºå…·ä½“çš„æ­¥éª¤æˆ–ç­–ç•¥ï¼Œå¹¶å¼ºè°ƒçŠ¶æ€ç®¡ç†çš„åŸåˆ™ï¼Œä»¥åŠå¦‚ä½•ç»“åˆReactçš„ç‰¹æ€§æ¥ä¿æŒçŠ¶æ€ä¸ä¸¢å¤±ã€‚
>
> 



---

åœ¨ `React.lazy + Suspense` çš„ä»£ç åˆ†å‰²åœºæ™¯ä¸­ï¼Œå½“åŠ¨æ€åŠ è½½çš„ç»„ä»¶å¤„äº **å¼‚æ­¥åŠ è½½çŠ¶æ€ï¼ˆPendingï¼‰** æ—¶ï¼ŒReact ä¼šæš‚æ—¶å¸è½½å½“å‰å­æ ‘å¹¶æ¸²æŸ“ `fallback`ã€‚å¦‚æœæ­£åœ¨åŠ è½½çš„ç»„ä»¶ï¼ˆæˆ–å…¶çˆ¶çº§ï¼‰ä¸­åŒ…å«ç”¨æˆ·äº¤äº’çŠ¶æ€ï¼ˆå¦‚è¡¨å•è¾“å…¥ã€å±•å¼€èœå•ç­‰ï¼‰ï¼ŒçŠ¶æ€ä¼šå› ç»„ä»¶å¸è½½è€Œä¸¢å¤±ã€‚ä»¥ä¸‹æ˜¯è§£å†³æ­¤é—®é¢˜çš„æ¸…æ™°æ–¹æ¡ˆï¼š

---

### **é—®é¢˜å¤ç°åœºæ™¯**
```jsx
const LazyModal = React.lazy(() => import("./Modal"));

const Parent = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [inputValue, setInputValue] = useState(""); // çŠ¶æ€åœ¨ Parent ç»´æŠ¤

  return (
    <div>
      <button onClick={() => setIsOpen(true)}>æ‰“å¼€å¼¹çª—</button>
      {isOpen && (
        <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
          <LazyModal
            value={inputValue}
            onChange={(v) => setInputValue(v)}
          />
        </Suspense>
      )}
    </div>
  );
};
```
å½“ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œ`LazyModal` å¼€å§‹åŠ è½½ã€‚åœ¨åŠ è½½å®Œæˆå‰çš„ `fallback` é˜¶æ®µï¼Œ`LazyModal` ä¼šè¢«å¸è½½ï¼Œå¯¼è‡´ `Parent` å†…éƒ¨çš„ `isOpen` çŠ¶æ€åœ¨åŠ è½½æœŸé—´æ„å¤–å…³é—­çš„è¯ï¼Œç”¨æˆ·äº¤äº’çŠ¶æ€ï¼ˆå¦‚ `inputValue`ï¼‰ä¼šè¢«æ¸…é™¤ã€‚

---

### **è§£å†³æ–¹æ¡ˆ 1ï¼šçŠ¶æ€æå‡åˆ° Suspense è¾¹ç•Œå¤–**
å°† **äº¤äº’çŠ¶æ€ä¸ Suspense è§£è€¦**ï¼Œç¡®ä¿å…³é”®çŠ¶æ€ä¸ç”±å¯èƒ½è¢«å¸è½½çš„å­æ ‘ç®¡ç†ï¼š
```jsx
const Parent = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [inputValue, setInputValue] = useState("");

  // å…³é”®ï¼šå§‹ç»ˆæ¸²æŸ“ Parent çš„çŠ¶æ€æ§åˆ¶ UIï¼Œä¸ä¾èµ– Suspense å†…éƒ¨
  return (
    <div>
      <button onClick={() => setIsOpen(true)}>æ‰“å¼€å¼¹çª—</button>
      {/* éå—æ§äº¤äº’çŠ¶æ€ä¿ç•™åœ¨ Suspense å¤–å±‚ */}
      <input
        value={inputValue}
        onChange={(e) => setInputValue(e.target.value)}
      />
      {isOpen && (
        <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
          <LazyModal
            value={inputValue}
            onChange={(v) => setInputValue(v)}
          />
        </Suspense>
      )}
    </div>
  );
};
```
**æ•ˆæœ**ï¼š`inputValue` çŠ¶æ€ç”±å¤–å±‚çš„ `input` ç®¡ç†ï¼Œå³ä½¿ `LazyModal` åŠ è½½æ—¶å¸è½½ï¼Œè¾“å…¥æ¡†çŠ¶æ€å§‹ç»ˆä¿ç•™ã€‚

---

### **è§£å†³æ–¹æ¡ˆ 2ï¼šç‹¬ç«‹ç»´æŠ¤äº¤äº’çŠ¶æ€**
è‹¥éœ€è¦ç”±å­ç»„ä»¶ç®¡ç†çŠ¶æ€ï¼Œå¯ä½¿ç”¨ **å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ Context/Reduxï¼‰** æˆ– **çŠ¶æ€æŒä¹…åŒ–å­˜å‚¨**ï¼š
```jsx
// ä½¿ç”¨ Context éš”ç¦»çŠ¶æ€
const ModalStateContext = createContext();

const Parent = () => {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <ModalStateContext.Provider value={useState("")}>
      <button onClick={() => setIsOpen(true)}>æ‰“å¼€å¼¹çª—</button>
      {isOpen && (
        <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
          <LazyModal />
        </Suspense>
      )}
    </ModalStateContext.Provider>
  );
};

// LazyModal å†…éƒ¨é€šè¿‡ Context è¯»å–çŠ¶æ€
const Modal = () => {
  const [value, setValue] = useContext(ModalStateContext);
  return <input value={value} onChange={(e) => setValue(e.target.value)} />;
};
```
**æ•ˆæœ**ï¼šçŠ¶æ€æ‰˜ç®¡åˆ° `Context`ï¼Œä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸè§£è€¦ï¼Œå¸è½½åçŠ¶æ€ä¾ç„¶ä¿ç•™ã€‚

---

### **è§£å†³æ–¹æ¡ˆ 3ï¼šä¼˜åŒ– Suspense æŒ‚è½½è¡Œä¸º**
ä¸º Suspense åŒ…è£¹ `memo` æˆ– `useMemo`ï¼Œå‡å°‘çˆ¶ç»„ä»¶æ¸²æŸ“é—´æ¥å¯¼è‡´çš„çŠ¶æ€ä¸¢å¤±ï¼š
```jsx
const Parent = () => {
  const [isOpen, setIsOpen] = useState(false);
  const lazyModal = useMemo(
    () => (
      <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
        <LazyModal />
      </Suspense>
    ),
    [] // é™æ€ä¾èµ–ï¼Œé¿å…çˆ¶ç»„ä»¶é‡å¤æ¸²æŸ“å¯¼è‡´ Suspense é‡è½½
  );

  return (
    <div>
      <button onClick={() => setIsOpen(true)}>æ‰“å¼€å¼¹çª—</button>
      {isOpen && lazyModal}
    </div>
  );
};
```
**æ•ˆæœ**ï¼šé€šè¿‡ `useMemo` ç¼“å­˜ Suspenseï¼Œé¿å…å› çˆ¶ç»„ä»¶çŠ¶æ€å˜åŒ–å¯¼è‡´æ•´ä¸ª Suspense å­æ ‘é‡å»ºã€‚

---

### **æ€»ç»“**
| åœºæ™¯                         | æ–¹æ¡ˆ                          | æ ¸å¿ƒé€»è¾‘                                  |
|------------------------------|-------------------------------|-----------------------------------------|
| è¡¨å•è¾“å…¥ç­‰ä¸´æ—¶äº¤äº’çŠ¶æ€       | çŠ¶æ€æå‡åˆ° Suspense å¤–éƒ¨       | ç¡®ä¿çŠ¶æ€æ§åˆ¶æƒåœ¨æœªå¸è½½çš„çˆ¶ç»„ä»¶           |
| è·¨ç»„ä»¶å…±äº«çŠ¶æ€               | å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆContext/Reduxï¼‰  | è„±ç¦»ç»„ä»¶å±‚çº§ï¼ŒæŒä¹…åŒ–å­˜å‚¨çŠ¶æ€             |
| Suspense å­æ ‘éœ€ä¿æŒæŒ‚è½½      | ç¼“å­˜ Suspense å®ä¾‹ï¼ˆuseMemoï¼‰  | é¿å…çˆ¶ç»„ä»¶æ¸²æŸ“è§¦å‘ Suspense é‡æ–°æŒ‚è½½     |

ç¡®ä¿äº¤äº’çŠ¶æ€ç”± **ç¨³å®šçš„çˆ¶ç»„ä»¶/å…¨å±€çŠ¶æ€** ç®¡ç†ï¼Œå¯å½»åº•é¿å…ç”±ä»£ç åˆ†å‰²å¯¼è‡´çš„æ¸²æŸ“ä¸­æ–­å’ŒçŠ¶æ€ä¸¢å¤±é—®é¢˜ã€‚
