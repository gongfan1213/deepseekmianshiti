> ğŸ’­ å¥½çš„ï¼Œç”¨æˆ·é—®çš„æ˜¯åœ¨ React çš„ Server Components æ¶æ„ä¸­ï¼Œå½“çˆ¶ç»„ä»¶æ˜¯æœåŠ¡ç«¯ç»„ä»¶ï¼Œå­ç»„ä»¶æ˜¯å®¢æˆ·ç«¯ç»„ä»¶æ—¶ï¼Œå¦‚ä½•æ­£ç¡®åˆ›å»ºå…±äº«çŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦ç”»å‡ºæ¶æ„ç¤ºæ„å›¾ã€‚æˆ‘å¾—ä»”ç»†æƒ³æƒ³è¿™ä¸ªé—®é¢˜åº”è¯¥å¦‚ä½•è§£å†³ã€‚
>
> é¦–å…ˆï¼Œæˆ‘éœ€è¦å›å¿†ä¸€ä¸‹ React Server Componentsï¼ˆRSCï¼‰çš„åŸºæœ¬æ¦‚å¿µã€‚RSC æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„ç»„ä»¶ï¼Œå®ƒä»¬ä¸ä¼šä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨çŠ¶æ€æˆ–è€…effectè¿™äº›å®¢æˆ·ç«¯ç‰¹æ€§ã€‚è€Œå®¢æˆ·ç«¯ç»„ä»¶åˆ™æ˜¯ä¼ ç»Ÿçš„Reactç»„ä»¶ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è¿è¡Œï¼Œæ‹¥æœ‰çŠ¶æ€å’Œäº¤äº’èƒ½åŠ›ã€‚
>
> ç°åœ¨çš„é—®é¢˜æ˜¯ä¸¤ä¸ªç»„ä»¶ï¼ŒParentæ˜¯æœåŠ¡ç«¯ï¼ŒChildæ˜¯å®¢æˆ·ç«¯ï¼Œå¦‚ä½•å…±äº«çŠ¶æ€ã€‚é€šå¸¸ï¼ŒReactä¸­çš„çŠ¶æ€å…±äº«æ˜¯é€šè¿‡çŠ¶æ€æå‡åˆ°å…±åŒçš„çˆ¶ç»„ä»¶ï¼Œæˆ–è€…ä½¿ç”¨Contextã€çŠ¶æ€ç®¡ç†åº“ï¼ˆå¦‚Reduxï¼‰ã€‚ä½†åœ¨RSCä¸­ï¼Œç”±äºçˆ¶ç»„ä»¶æ˜¯æœåŠ¡ç«¯ç»„ä»¶ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨çŠ¶æ€æˆ–è€…Contextï¼Œå› ä¸ºè¿™äº›åªèƒ½åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ã€‚
>
> å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†å…±äº«çŠ¶æ€æ”¾åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ã€‚ä¸€ä¸ªåŠæ³•æ˜¯è®©ParentæœåŠ¡ç«¯ç»„ä»¶æ¸²æŸ“ä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶ä½œä¸ºçˆ¶å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨å¯ä»¥ç®¡ç†çŠ¶æ€ï¼Œç„¶åä¼ é€’ç»™å­ç»„ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒParentä½œä¸ºæœåŠ¡ç«¯ç»„ä»¶ï¼Œæ¸²æŸ“ä¸€ä¸ªåŒ…è£¹çš„ClientParentç»„ä»¶ï¼Œè¿™ä¸ªClientParentæ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼Œè´Ÿè´£æŒæœ‰çŠ¶æ€ï¼Œå¹¶ä¸”å°†çŠ¶æ€ä½œä¸ºpropä¼ é€’ç»™Childï¼ˆå®¢æˆ·ç«¯ç»„ä»¶ï¼‰ã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡ç«¯ç»„ä»¶ä¸èƒ½ç›´æ¥ä¼ é€’çŠ¶æ€ï¼Œä½†å¯ä»¥å°†åˆå§‹çŠ¶æ€åºåˆ—åŒ–åä¼ ç»™å®¢æˆ·ç«¯ç»„ä»¶ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡ç«¯ç»„ä»¶å¯ä»¥è·å–åˆå§‹æ•°æ®ï¼Œå°†å…¶ä½œä¸ºpropä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ï¼Œå®¢æˆ·ç«¯ç»„ä»¶æ¥æ”¶åç”¨useStateåˆå§‹åŒ–æœ¬åœ°çŠ¶æ€ï¼Œæˆ–è€…åœ¨å®¢æˆ·ç«¯è¿›è¡ŒçŠ¶æ€ç®¡ç†ã€‚
>
> å¦å¤–ï¼Œéœ€è¦è€ƒè™‘åˆ°Server Componentsæ— æ³•ä½¿ç”¨Contextï¼Œæ‰€ä»¥å…±äº«çŠ¶æ€å¿…é¡»ç”±æŸä¸ªå®¢æˆ·ç«¯ç»„ä»¶ç®¡ç†ï¼Œç„¶åé€šè¿‡propsä¼ é€’ç»™å­ç»„ä»¶ã€‚çŠ¶æ€æå‡åˆ°æœ€è¿‘çš„å®¢æˆ·ç«¯å…±åŒç¥–å…ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚
>
> å‡è®¾ç”¨æˆ·å¯èƒ½çš„éœ€æ±‚æ˜¯å…·ä½“çš„å®ç°æ­¥éª¤ï¼Œæ¯”å¦‚ä»£ç ç»“æ„å’Œæ•°æ®æµåŠ¨æ–¹å¼ï¼Œä»¥åŠç¤ºæ„å›¾çš„æè¿°ã€‚ä»–ä»¬å¯èƒ½å…³å¿ƒå¦‚ä½•ä¿æŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çŠ¶æ€çš„åŒæ­¥ï¼Œå°¤å…¶æ˜¯åœ¨æœåŠ¡ç«¯è·å–åˆå§‹æ•°æ®åï¼Œå®¢æˆ·ç«¯å¦‚ä½•ç»§ç»­ç®¡ç†çŠ¶æ€çš„å˜åŒ–ã€‚
>
> å¯èƒ½çš„é£é™©ç‚¹åŒ…æ‹¬åˆå§‹æœåŠ¡ç«¯æ¸²æŸ“çš„çŠ¶æ€ä¸å®¢æˆ·ç«¯åç»­çŠ¶æ€çš„åŒæ­¥é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡ç«¯ä¼ é€’äº†ä¸€ä¸ªåˆå§‹å€¼ï¼Œå®¢æˆ·ç«¯ç»„ä»¶éœ€è¦åœ¨hydrateæ—¶æ­£ç¡®æ¥æ”¶è¿™ä¸ªåˆå§‹å€¼ï¼Œä»¥é¿å…æ°´åˆä¸åŒ¹é…çš„é”™è¯¯ã€‚
>
> å¦å¤–éœ€è¦æ³¨æ„ï¼ŒæœåŠ¡ç«¯ç»„ä»¶æ— æ³•äº’åŠ¨å®¢æˆ·ç«¯çš„äº¤äº’ï¼Œæ‰€ä»¥æ‰€æœ‰äº¤äº’ç›¸å…³çš„çŠ¶æ€å¿…é¡»ç”±å®¢æˆ·ç«¯ç»„ä»¶æ¥ç®¡ç†ã€‚çŠ¶æ€çš„å˜åŒ–åªèƒ½åœ¨å®¢æˆ·ç«¯ç»„ä»¶å†…éƒ¨æˆ–é€šè¿‡å®¢æˆ·ç«¯ç»„ä»¶ä¹‹é—´çš„ä¼ é€’æ¥å¤„ç†ã€‚
>
> å¯èƒ½çš„æ¶æ„ç¤ºæ„å›¾åº”è¯¥æ˜¾ç¤ºï¼ŒæœåŠ¡ç«¯ç»„ä»¶Parentæ¸²æŸ“ä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶ClientParentï¼Œè¯¥ClientParentç®¡ç†çŠ¶æ€ï¼Œå¹¶å°†çŠ¶æ€é€šè¿‡propsæˆ–Contextä¼ é€’ç»™Childå®¢æˆ·ç«¯ç»„ä»¶ã€‚æ•°æ®æµæ˜¯ä»Server Parentåˆ°Client Parentåˆ°Childï¼ŒçŠ¶æ€çš„ç®¡ç†åœ¨Client Parentå†…éƒ¨ã€‚
>
> éœ€è¦ç¡®è®¤æ˜¯å¦æ­£ç¡®å›¾ç¤ºäº†è¿™ä¸ªç»“æ„ï¼Œé…åˆæ–‡æœ¬è¯´æ˜ï¼Œå¯èƒ½ä¼šç”¨Mermaidä¹‹ç±»çš„å·¥å…·ç»˜åˆ¶ç¤ºæ„å›¾ã€‚
>
> 



### è§£å†³æ–¹æ¡ˆï¼šServer-Client çŠ¶æ€æ¡¥æ¥æ¨¡å¼

---

#### 1. æ ¸å¿ƒæŠ€æœ¯å®ç°åŸç†
åœ¨ Server Components æ¶æ„ä¸­ï¼Œ**æœåŠ¡ç«¯ç»„ä»¶æ— æ³•ç›´æ¥ç®¡ç†åŠ¨æ€çŠ¶æ€**ï¼Œéœ€è¦ç”¨æ··åˆæ¶æ„æ„å»º **åŒå‘çŠ¶æ€æ¡¥æ¢**ã€‚ä»¥ä¸‹æ˜¯ 3 ç§å…¸å‹è§£å†³æ–¹æ¡ˆï¼š

##### æ–¹æ¡ˆ 1: ä¸­é—´å®¢æˆ·ç«¯å®¹å™¨æ¡¥æ¥
```mermaid
graph LR
  A[Server Parent] --> B{å®¢æˆ·ç«¯å®¹å™¨}
  B -->|ä¼ é€’åºåˆ—åŒ–åˆå§‹æ•°æ®| C[Client Child]
  B -->|çŠ¶æ€å˜æ›´å›è°ƒ| A
  C -->|äº¤äº’æ›´æ–°çŠ¶æ€| B
```

##### æ–¹æ¡ˆ 2: URL çŠ¶æ€åŒæ­¥
```mermaid
graph TD
  A[Server Parent] -->|è¯»å– URLå‚æ•° | B[æ„å»ºåˆå§‹UI]
  B -->|ç”¨æˆ·äº¤äº’è§¦å‘| C[ä¿®æ”¹ URL SearchParams]
  C -->|è§¦è¾¾æœåŠ¡ç«¯| A
```

##### æ–¹æ¡ˆ 3: æœåŠ¡ç«¯ Actions ï¼ˆRSC ç»ˆæå½¢æ€ï¼‰
```mermaid
graph LR
  A[Client Child] -->|è°ƒç”¨| B[æœåŠ¡å™¨Action]
  B -->|è¿”å›æ–°çŠ¶æ€| A
```

---

#### 2. æ¨èæ–¹æ¡ˆï¼šæ¡¥æ¥å®¹å™¨è¯¦è§£ (é…åˆ Next.js App Router)

##### æ¶æ„ç¤ºæ„å›¾
```mermaid
graph TD
  SP[Server Parent] --> CC[Client Connector]
  CC -->|1. initialData åˆå§‹åŒ–| CH1[Client Child 1]
  CC -->|2. initialData åˆå§‹åŒ–| CH2[Client Child 2]
  CH1 -->|a. æ›´æ–°çŠ¶æ€| CC
  CH2 -->|b. æ›´æ–°çŠ¶æ€| CC
  CC -->|c. åŒæ­¥çŠ¶æ€| SP
  SP -.->|Server Actions| CC
```

##### å¯¹åº”ä»£ç å®ç°
```tsx
// Server Parent (app/page.tsx)
export default async function Parent() {
  const initialData = await fetchDataFromDB(); // æœåŠ¡ç«¯è·å–åˆå§‹æ•°æ®

  return (
    <ClientConnector initialData={initialData}>
      <Child1 />
      <Child2 />
    </ClientConnector>
  );
}

// å®¢æˆ·ç«¯æ¡¥æ¥å®¹å™¨ (components/client-connector.tsx)
'use client';
export function ClientConnector({
  initialData,
  children
}: { 
  initialData: string;
  children: React.ReactNode;
}) {
  const [value, setValue] = useState(initialData);

  return (
    <StateContext.Provider value={{ value, setValue }}>
      {children}
      <SyncButton onSubmit={handleUpdateServerState} />
    </StateProvider>
  );

  async function handleUpdateServerState(newValue: string) {
    await fetch('/api/update', { method: 'POST', body: newValue });
  }
}
```

##### æ ¸å¿ƒä¼˜åŠ¿
| æ–¹æ¡ˆ              | é€šä¿¡å»¶è¿Ÿ | SSG å‹å¥½åº¦ | äº¤äº’å¤æ‚åº¦ | çŠ¶æ€æŒä¹…åŒ–   |
|------------------|---------|-----------|-----------|-------------|
| çº¯å®¢æˆ·ç«¯æ–¹æ¡ˆ      | ä½       | âŒ         | å¤æ‚       | Session     |
| URL çŠ¶æ€åŒæ­¥      | ä¸­       | âœ…         | ä¸­ç­‰       | URL å¯è¿½è¸ª  |
| æœåŠ¡ç«¯ Actions    | ä¸­é«˜     | âœ…         | ç®€å•       | æœåŠ¡ç«¯æ§åˆ¶  |

---

#### 3. æŠ€æœ¯å…³é”®ç‚¹

##### æ€§èƒ½ä¼˜åŒ–æŠ€å·§
```tsx
// 1. ä½¿ç”¨ React.cache ç¼“å­˜æœåŠ¡ç«¯çŠ¶æ€
const getServerState = cache(async () => { 
  return fetchData();
});

// 2. æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯çš„è½»é‡åºåˆ—åŒ–
function transformState(serverState: any) {
  return JSON.parse(JSON.stringify(serverState)); // å»é™¤ä¸å¯åºåˆ—åŒ–å¯¹è±¡
}

// 3. åˆ†å—ä¼ è¾“ (ç»“åˆ Suspense)
<Suspense fallback={<Skeleton>}>
  <AsyncChildComponent />
</Suspense>
```

##### å®‰å…¨æ§åˆ¶æœ€ä½³å®è·µ
```ts
// å¯¹ Server Action å¢åŠ é‰´æƒå±‚
export async function updateServerState(newValue: string) {
  'use server';
  
  const session = await getAuth();
  if (!session.user) throw new Error('Unauthorized');
  
  await db.update({ data: newValue });
}
```

---

#### 4. æ‰©å±•é˜…è¯»ï¼šRSC çŠ¶æ€æ¶æ„è§„èŒƒ

| çŠ¶æ€ç±»å‹       | æ¨èå­˜æ”¾ä½ç½®          | æ›´æ–°æ–¹å¼               | å…¸å‹åœºæ™¯          |
|---------------|---------------------|----------------------|------------------|
| **å…¨å±€çŠ¶æ€**   | URL / Cookies       | Server Redirect      | ç”¨æˆ·åå¥½è®¾ç½®      |
| **ä¼šè¯çŠ¶æ€**   | Server Session      | Server Action        | è´­ç‰©è½¦å•†å“        |
| **UI çŠ¶æ€**    | å®¢æˆ·ç«¯ç¼“å­˜           | Client Interaction   | æŠ˜å é¢æ¿çŠ¶æ€      |
| **ä¸´æ—¶çŠ¶æ€**   | LocalStorage        | Debounced Update     | è¡¨å•è‰ç¨¿ä¿å­˜      |

```mermaid
graph LR
  User((ç”¨æˆ·)) -->|è§¦å‘äº¤äº’| Client[å®¢æˆ·ç«¯ç»„ä»¶]
  Client -->|è°ƒç”¨| Action[Server Action]
  Action -->|æ›´æ–°| DB[(æ•°æ®åº“)]
  DB -->|è¿”å›æ–°æ•°æ®| Action
  Action -->|é‡æ–°æ¸²æŸ“è·¯å¾„| RSC[Server Components]
  RSC -->|æµå¼ä¼ è¾“| NewUI[æœ€æ–°UI]
```
