> ğŸ’­ å—¯ï¼Œç”¨æˆ·ç°åœ¨æƒ³çŸ¥é“å¦‚ä½•å®ç°ä¸€ä¸ªç±»ä¼¼React Queryçš„ç¼“å­˜ç­–ç•¥ï¼Œä¸»è¦æ˜¯å¤„ç†é‡å¤æŸ¥è¯¢å’Œç«æ€æ¡ä»¶çš„é—®é¢˜ã€‚ä¹‹å‰çš„è®¨è®ºé›†ä¸­åœ¨Reduxçš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œç°åœ¨è½¬åˆ°æœåŠ¡ç«¯æ•°æ®ç¼“å­˜çš„æ–¹é¢ï¼Œå¯èƒ½ç”¨æˆ·æ­£åœ¨æ„å»ºä¸€ä¸ªéœ€è¦é«˜æ•ˆæ•°æ®è·å–çš„åº”ç”¨ï¼Œæˆ–è€…å¯¹ç°æœ‰çš„æ•°æ®è¯·æ±‚é€»è¾‘è¿›è¡Œä¼˜åŒ–ã€‚è¿™æ—¶å€™ï¼Œç†è§£React Queryçš„å†…éƒ¨æœºåˆ¶ä¼šæœ‰å¸®åŠ©ã€‚
>
> é¦–å…ˆï¼Œç”¨æˆ·çš„é—®é¢˜æ¶‰åŠä¸¤ä¸ªæ–¹é¢ï¼šç¼“å­˜ç­–ç•¥çš„å®ç°å’Œç«æ€æ¡ä»¶å¤„ç†ã€‚React Queryçš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯èƒ½å¤Ÿè‡ªåŠ¨å»é‡ç›¸åŒè¯·æ±‚ï¼Œå¹¶åœ¨ç»„ä»¶æŒ‚è½½æ—¶å¤ç”¨å·²æœ‰çš„æ•°æ®ï¼ŒåŒæ—¶é¿å…è¿‡æ—¶çš„å“åº”å¸¦æ¥çš„é—®é¢˜ã€‚
>
> è¦è®¾è®¡è¿™æ ·çš„ç³»ç»Ÿï¼Œé¦–å…ˆè¦è€ƒè™‘ç¼“å­˜æœºåˆ¶ã€‚å¦‚ä½•å­˜å‚¨å·²è·å–çš„æ•°æ®ï¼Ÿé€šå¸¸ä¼šç”¨ä¸€ä¸ªå…¨å±€çš„ç¼“å­˜å¯¹è±¡ï¼Œä»¥æŸ¥è¯¢é”®ï¼ˆquery keyï¼Œç±»ä¼¼äºå­—ç¬¦ä¸²ã€æ•°ç»„æˆ–å…¶ä»–å”¯ä¸€æ ‡è¯†ï¼‰ä½œä¸ºé”®ï¼Œå­˜å‚¨æ•°æ®ã€çŠ¶æ€ã€è¿‡æœŸæ—¶é—´ç­‰ä¿¡æ¯ã€‚
>
> ç„¶åæ˜¯å»é‡å¤„ç†ï¼Œå½“å¤šä¸ªç»„ä»¶è¯·æ±‚ç›¸åŒçš„æŸ¥è¯¢é”®æ—¶ï¼Œé¿å…åŒæ—¶å‘èµ·å¤šä¸ªç›¸åŒçš„è¯·æ±‚ã€‚è¿™éœ€è¦è·Ÿè¸ªæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ï¼Œå¦‚æœæœ‰ç›¸åŒçš„è¯·æ±‚å·²ç»åœ¨å¤„ç†ä¸­ï¼Œåç»­çš„è¯·æ±‚åº”ç­‰å¾…åŸå§‹è¯·æ±‚çš„ç»“æœï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„è¯·æ±‚ã€‚
>
> æ¥ä¸‹æ¥æ˜¯ç«æ€æ¡ä»¶çš„å¤„ç†ï¼Œå¸¸è§çš„ä¾‹å­æ˜¯å…ˆå‘èµ·çš„è¯·æ±‚åè¿”å›ï¼Œå¯¼è‡´æ—§æ•°æ®è¦†ç›–æ–°æ•°æ®ã€‚è§£å†³æ–¹æ¡ˆå¯ä»¥æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„æ ‡è¯†ï¼Œå¹¶åœ¨è¿”å›æ—¶åªå¤„ç†æœ€æ–°çš„è¯·æ±‚ç»“æœã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨AbortControlleræ¥å–æ¶ˆä¹‹å‰çš„è¯·æ±‚ï¼Œæˆ–è€…åœ¨è¯·æ±‚è¿”å›æ—¶æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå‘å‡ºçš„è¯·æ±‚ã€‚
>
> ç¼“å­˜çš„æœ‰æ•ˆæœŸç®¡ç†ä¹Ÿå¾ˆé‡è¦ï¼ŒReact Queryæœ‰stale-while-revalidateç­–ç•¥ï¼Œå³å…è®¸ç«‹å³è¿”å›è¿‡æœŸï¼ˆstaleï¼‰çš„æ•°æ®ï¼ŒåŒæ—¶åœ¨åå°é‡æ–°éªŒè¯æ•°æ®æ˜¯å¦æœ‰æ•ˆã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°è®¾ç½®æ•°æ®çš„è¿‡æœŸæ—¶é—´ï¼Œä»¥åŠè‡ªåŠ¨åœ¨åå°æ›´æ–°æ•°æ®çš„æœºåˆ¶ã€‚
>
> å¦å¤–ï¼Œç³»ç»Ÿéœ€è¦è€ƒè™‘ä½•æ—¶ä¸»åŠ¨æ¸…ç†ç¼“å­˜ï¼Œæ¯”å¦‚ç”¨LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç­–ç•¥æ¥é™åˆ¶ç¼“å­˜å¤§å°ï¼Œæˆ–è€…åœ¨å†…å­˜ç´§å¼ æ—¶æ¸…ç†æ—§ç¼“å­˜ã€‚
>
> åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘é”™è¯¯å¤„ç†ã€‚å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œåº”è¯¥é‡è¯•å¤šå°‘æ¬¡ï¼Œæ˜¯å¦è¦ç¼“å­˜é”™è¯¯çŠ¶æ€ï¼Œä»¥åŠå¦‚ä½•é€šçŸ¥ä¾èµ–çš„ç»„ä»¶ã€‚
>
> å¯¹äºè®¢é˜…æœºåˆ¶ï¼Œå½“æœ‰å¤šä¸ªç»„ä»¶è®¢é˜…åŒä¸€ä¸ªæŸ¥è¯¢é”®æ—¶ï¼Œè¦ç»´æŠ¤è®¢é˜…è€…çš„åˆ—è¡¨ï¼Œå¹¶åœ¨æ•°æ®æ›´æ–°æ—¶é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚è€Œå½“æœ€åä¸€ä¸ªè®¢é˜…è€…è§£é™¤è®¢é˜…æ—¶ï¼Œå¯èƒ½è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´åå†æ¸…ç†ç¼“å­˜ã€‚
>
> å…·ä½“åˆ°æ­¥éª¤ï¼Œå¯èƒ½éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š
>
> 1. åˆ›å»ºä¸€ä¸ªå…¨å±€ç¼“å­˜ç®¡ç†å™¨ï¼Œç»´æŠ¤å„ä¸ªæŸ¥è¯¢çš„çŠ¶æ€ã€‚
>
> 2. åœ¨å‘èµ·è¯·æ±‚å‰ï¼Œæ£€æŸ¥ç¼“å­˜æ˜¯å¦å­˜åœ¨ä¸”æœªè¿‡æœŸï¼Œå¦‚æœå¯ç”¨åˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ã€‚
>
> 3. å¦‚æœæœ‰æ­£åœ¨è¿›è¡Œçš„ç›¸åŒè¯·æ±‚ï¼Œè¿”å›è¯¥è¯·æ±‚çš„Promiseï¼Œè€Œä¸æ˜¯å‘èµ·æ–°çš„è¯·æ±‚ã€‚
>
> 4. ç¡®ä¿å¤„ç†è¯·æ±‚æ—¶ï¼Œåªæœ‰æœ€åä¸€æ¬¡è¯·æ±‚çš„ç»“æœä¼šè¢«åº”ç”¨ï¼Œå¿½ç•¥æ—§çš„è¯·æ±‚ç»“æœã€‚
>
> 5. è®¾ç½®æ•°æ®çš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶å®šæ—¶æˆ–åœ¨ä¸‹æ¬¡è®¿é—®æ—¶é‡æ–°éªŒè¯æ•°æ®ã€‚
>
> 6. å®ç°è®¢é˜…æœºåˆ¶ï¼Œè·Ÿè¸ªç»„ä»¶çš„ä½¿ç”¨æƒ…å†µï¼Œä»¥ä¾¿åœ¨åˆé€‚çš„æ—¶æœºè¿›è¡Œåƒåœ¾å›æ”¶ã€‚
>
> å…³äºç«æ€æ¡ä»¶çš„å¤„ç†ï¼Œå¯ä»¥ç»™æ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œå½“å“åº”è¿”å›æ—¶ï¼Œæ£€æŸ¥å½“å‰æœ€æ–°çš„è¯·æ±‚IDæ˜¯å¦ä¸è¯¥å“åº”åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™æ›´æ–°ç¼“å­˜ï¼Œå¦åˆ™å¿½ç•¥ã€‚æˆ–è€…ä½¿ç”¨AbortControlleræ¥å–æ¶ˆä¹‹å‰çš„è¯·æ±‚ï¼Œä½†å¯èƒ½è¦è€ƒè™‘å…¼å®¹æ€§ã€‚
>
> ç¼“å­˜ç­–ç•¥æ–¹é¢ï¼Œå¯èƒ½éœ€è¦ç”¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨æŸ¥è¯¢é”®å¯¹åº”çš„ç¼“å­˜æ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®åŒ…å«æ•°æ®ã€çŠ¶æ€ï¼ˆåŠ è½½ä¸­ã€æˆåŠŸã€é”™è¯¯ï¼‰ã€æ—¶é—´æˆ³ç­‰ä¿¡æ¯ã€‚è¯·æ±‚è¿‡ç¨‹ä¸­éœ€è¦è·Ÿè¸ªå½“å‰æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ï¼Œé˜²æ­¢é‡å¤ã€‚
>
> è®¢é˜…çš„å®ç°éœ€è¦è€ƒè™‘å½“ç»„ä»¶æŒ‚è½½æ—¶å¢åŠ è®¢é˜…è®¡æ•°ï¼Œå¸è½½æ—¶å‡å°‘ã€‚å½“è®¢é˜…è®¡æ•°å½’é›¶æ—¶ï¼Œå¯ä»¥å»¶è¿Ÿæ¸…é™¤ç¼“å­˜ï¼Œä»¥ä¾¿å¿«é€Ÿæ¢å¤åç»­çš„è®¿é—®ã€‚
>
> åœ¨æŠ€æœ¯å®ç°ä¸Šï¼Œå¯ä»¥ä½¿ç”¨Mapç»“æ„æ¥ç®¡ç†ç¼“å­˜ã€‚ä¾‹å¦‚ï¼š
>
> const cache = new Map();
>
> æ¯ä¸ªç¼“å­˜é¡¹å¯èƒ½åŒ…å«ï¼š
>
> - data: å­˜å‚¨çš„æ•°æ®
>
> - error: é”™è¯¯ä¿¡æ¯
>
> - promise: æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚çš„Promise
>
> - subscribers: è®¢é˜…è¯¥ç¼“å­˜çš„ç»„ä»¶æ•°é‡
>
> - timestamp: ç¼“å­˜æ—¶é—´
>
> - invalidateTimer: ç”¨äºè¿‡æœŸçš„å®šæ—¶å™¨
>
> æ­¤å¤–ï¼Œå¦‚æœç”¨æˆ·æƒ³åœ¨Reactä¸­ä½¿ç”¨è¿™æ ·çš„ç¼“å­˜ç³»ç»Ÿï¼Œå¯èƒ½éœ€è¦è‡ªå®šä¹‰é’©å­ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨é’©å­ä¸­æ³¨å†Œè®¢é˜…å’Œæ³¨é”€è®¢é˜…ï¼Œä»è€Œåœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶å¤„ç†è¯·æ±‚ã€‚
>
> è‡³äºå¹¶å‘è¯·æ±‚çš„å¤„ç†ï¼Œå¯ä»¥åœ¨å‘èµ·è¯·æ±‚æ—¶æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸åŒçš„æŸ¥è¯¢é”®åœ¨pendingçŠ¶æ€ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›è¯¥promiseã€‚è¿™æ ·ä¿è¯å¤šæ¬¡è°ƒç”¨åªä¼šè§¦å‘ä¸€ä¸ªå®é™…è¯·æ±‚ã€‚
>
> æ€»ç»“æ¥è¯´ï¼Œè®¾è®¡è¿™æ ·çš„ç¼“å­˜ç³»ç»Ÿéœ€è¦å¤„ç†å­˜å‚¨ã€å»é‡ã€ç«æ€ã€è¿‡æœŸã€è®¢é˜…å’Œåƒåœ¾å›æ”¶ç­‰å¤šä¸ªæ–¹é¢ã€‚è€Œç«æ€æ¡ä»¶ä¸»è¦ä¾èµ–è·Ÿè¸ªæœ€æ–°çš„è¯·æ±‚æ ‡è¯†ï¼Œå–æ¶ˆæˆ–å¿½ç•¥æ—§çš„è¯·æ±‚ç»“æœã€‚
>
> 



### å¦‚ä½•å®ç°ä¸€ä¸ªç±»ä¼¼ React Query çš„ç¼“å­˜ç­–ç•¥ï¼Ÿ

è¦å®ç°ç±»ä¼¼ React Query çš„ç¼“å­˜ç­–ç•¥ï¼Œéœ€è§£å†³ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š  
1. **é‡å¤è¯·æ±‚çš„å»é‡ä¸åˆå¹¶**  
2. **è‡ªåŠ¨ç¼“å­˜å¤±æ•ˆä¸é‡æ–°éªŒè¯ï¼ˆStale-While-Revalidate, SWRï¼‰**  
3. **ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰ä¸æ—§å“åº”å¿½ç•¥**  
4. **è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼ˆCleanupï¼‰ä¸å†…å­˜ç®¡ç†**  

ä»¥ä¸‹æ˜¯å®ç°è¿™ä¸€ç­–ç•¥çš„åˆ†æ­¥æ–¹æ¡ˆï¼š

---

### **1. å®šä¹‰ç¼“å­˜ç»“æ„**
è®¾è®¡ä¸€ä¸ª **å…¨å±€ç¼“å­˜ç®¡ç†å™¨**ï¼Œå­˜å‚¨æ‰€æœ‰æŸ¥è¯¢çš„çŠ¶æ€ï¼Œä½¿ç”¨ `Map` æˆ–å¯¹è±¡å®ç°ç»Ÿä¸€ç¼“å­˜æ± ï¼š  
```typescript
type QueryKey = string | any[];  // é€šè¿‡åºåˆ—åŒ–å‡½æ•°ï¼ˆå¦‚ JSON.stringifyï¼‰å½’ä¸€åŒ–ä¸ºå­—ç¬¦ä¸²

interface CacheEntry<T> {
  data: T | null;       // ç¼“å­˜æ•°æ®
  error: Error | null;  // é”™è¯¯ä¿¡æ¯
  promise: Promise<T> | null;  // æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ Promise
  timestamp: number;    // ç¼“å­˜æ—¶é—´æˆ³
  subscribers: number;  // è®¢é˜…çš„ç»„ä»¶æ•°é‡
  invalidateTimer?: NodeJS.Timeout;  // æ— æ•ˆåŒ–å®šæ—¶å™¨ï¼ˆç”¨äºè‡ªåŠ¨é‡æ–°éªŒè¯ï¼‰
}
const cache = new Map<QueryKey, CacheEntry<any>>();
```

---

### **2. è¯·æ±‚å»é‡ä¸åˆå¹¶**
åœ¨å‘èµ·æ–°è¯·æ±‚å‰ï¼Œæ£€æŸ¥ç¼“å­˜æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæŸ¥è¯¢ï¼š  
```typescript
async function fetchQuery<T>(
  queryKey: QueryKey,
  queryFn: () => Promise<T>,
  options: {
    staleTime?: number;  // å…è®¸ä½¿ç”¨è¿‡æœŸç¼“å­˜çš„æ—¶é•¿ï¼ˆé»˜è®¤ 0ï¼‰
    cacheTime?: number;  // ç¼“å­˜ä¿ç•™çš„æ—¶é•¿ï¼ˆé»˜è®¤ 5åˆ†é’Ÿï¼‰
  } = {}
): Promise<T> {
  const key = serialize(queryKey);  // åºåˆ—åŒ– QueryKey
  const entry = cache.get(key);

  // ç¼“å­˜å‘½ä¸­ï¼šå­˜åœ¨ä¸”æ•°æ®æœªè¿‡æœŸ
  if (entry && entry.data !== null && !isStale(entry, options.staleTime)) {
    return entry.data;  // ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼ˆéé˜»å¡ï¼‰
  }

  // è¯·æ±‚åˆå¹¶ï¼šå­˜åœ¨æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚
  if (entry?.promise) {
    return entry.promise;
  }

  // åˆ›å»ºæ–°ç¼“å­˜æ¡ç›®
  const newEntry: CacheEntry<T> = {
    data: null,
    error: null,
    promise: null,
    timestamp: Date.now(),
    subscribers: 0,
  };
  cache.set(key, newEntry);

  try {
    const fetchPromise = queryFn();
    newEntry.promise = fetchPromise;

    const data = await fetchPromise;
    newEntry.data = data;
    newEntry.timestamp = Date.now();

    // è®¾ç½®è‡ªåŠ¨é‡æ–°éªŒè¯çš„å®šæ—¶å™¨ï¼ˆSWRï¼‰
    if (options.staleTime !== Infinity) {
      const revalidate = () => fetchQuery(key, queryFn, options);
      newEntry.invalidateTimer = setTimeout(revalidate, options.staleTime || 0);
    }

    // æ¸…é™¤è¯·æ±‚ Promise ä»¥é¿å…å†…å­˜æ³„æ¼
    newEntry.promise = null;

    return data;
  } catch (error) {
    newEntry.error = error as Error;
    throw error;
  }
}
```

---

### **3. å¤„ç†ç«æ€æ¡ä»¶**
é€šè¿‡ **å”¯ä¸€è¯·æ±‚æ ‡è¯†ç¬¦** æˆ– **è‡ªåŠ¨å–æ¶ˆæœºåˆ¶** ç¡®ä¿ä»…ä¿ç•™æœ€æ–°è¯·æ±‚çš„å“åº”ï¼š  
```typescript
// æ–¹å¼ 1: è¯·æ±‚å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆæœ€ç®€å•ï¼‰
let currentRequestId = 0;

async function fetchWithRaceGuard<T>(queryFn: () => Promise<T>): Promise<T> {
  const requestId = ++currentRequestId;
  const data = await queryFn();
  
  // ä»…å½“è¯¥è¯·æ±‚æ˜¯æœ€åä¸€ä¸ªå‘èµ·çš„è¯·æ±‚æ—¶æ›´æ–°ç¼“å­˜
  if (requestId === currentRequestId) {
    return data;
  }
  throw new Error("Obsolete request result");  // å¿½ç•¥æ—§è¯·æ±‚ç»“æœ
}

// æ–¹å¼ 2: AbortControllerï¼ˆéœ€è¦æ”¯æŒ APIï¼‰
const controller = new AbortController();

async function fetchWithAbort<T>(queryFn: (signal?: AbortSignal) => Promise<T>): Promise<T> {
  const prevController = controller;
  prevController.abort();  // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚
  return queryFn(controller.signal);  // æ”¯æŒå¯ä¸­æ–­çš„è¯·æ±‚
}
```

---

### **4. è‡ªåŠ¨ç¼“å­˜å¤±æ•ˆä¸é‡æ–°éªŒè¯**  
é€šè¿‡ `staleTime` å’Œ `cacheTime` æ§åˆ¶ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸï¼š  
```typescript
function isStale(entry: CacheEntry<any>, staleTime = 0): boolean {
  return Date.now() - entry.timestamp > staleTime;
}

// åœ¨è®¾ç½®ç¼“å­˜æ¡ç›®æ—¶å¯åŠ¨å®šæ—¶å™¨ï¼ˆå‚è€ƒæ­¥éª¤ 2 çš„ä»£ç ï¼‰
```

---

### **5. è®¢é˜…æœºåˆ¶ä¸åƒåœ¾å›æ”¶**  
è¿½è¸ªç»„ä»¶çš„æŒ‚è½½ä¸å¸è½½ï¼Œè‡ªåŠ¨æ¸…ç†æ— è®¢é˜…çš„ç¼“å­˜ï¼š  
```typescript
// ç»„ä»¶æŒ‚è½½æ—¶å¢åŠ è®¢é˜…è®¡æ•°
function useQuery<T>(queryKey: QueryKey, queryFn: () => Promise<T>) {
  const [data, setData] = useState<T | null>(null);
  
  useEffect(() => {
    const key = serialize(queryKey);
    const entry = cache.get(key) || { subscribers: 0 };

    entry.subscribers++;
    cache.set(key, entry);

    fetchQuery(queryKey, queryFn).then(setData);

    return () => {
      entry.subscribers--;
      // å»¶è¿Ÿæ¸…ç†æ— è®¢é˜…çš„ç¼“å­˜
      setTimeout(() => {
        if (entry.subscribers <= 0) {
          cache.delete(key);
        }
      }, cacheTime || 5 * 60 * 1000);
    };
  }, [queryKey]);
  
  return data;
}
```

---

### **6. ç¼“å­˜å±‚çº§ä¼˜åŒ–**
å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–æ€§èƒ½ï¼š  
- å†…å­˜é™åˆ¶ä¸ LRUï¼ˆLeast Recently Usedï¼‰ç¼“å­˜ç­–ç•¥  
- æœ¬åœ°æŒä¹…åŒ–ï¼ˆå¦‚ `localStorage` çš„äºŒæ¬¡ç¼“å­˜ï¼‰  
- è¯·æ±‚ä¼˜å…ˆçº§ä¸é¢„åŠ è½½  

---

### **æœ€ç»ˆè®¾è®¡è¦ç‚¹æ€»ç»“**
| **ç‰¹æ€§**            | **å®ç°æ–¹å¼**                                |
|---------------------|--------------------------------------------|
| é‡å¤è¯·æ±‚åˆå¹¶        | Promise å¤ç”¨ä¸ç¼“å­˜æ¡ç›®é”å®š                 |
| ç«æ€æ¡ä»¶å¤„ç†        | æœ€æ–°è¯·æ±‚è¦†ç›–æ—§è¯·æ±‚ï¼ˆæ ‡è¯†ç¬¦æˆ– Abort æœºåˆ¶ï¼‰  |
| è‡ªåŠ¨é‡æ–°éªŒè¯        | Stale-While-Revalidate (SWR) + å®šæ—¶å™¨      |
| åƒåœ¾å›æ”¶            | åŸºäºè®¢é˜…è®¡æ•°çš„å»¶è¿Ÿæ¸…ç†                     |
| æ€§èƒ½ä¼˜åŒ–            | å†…å­˜ç¼“å­˜ + LRU ç­–ç•¥ + æœ¬åœ°æŒä¹…åŒ–           |

---

### æ³¨æ„äº‹é¡¹
1. **åºåˆ—åŒ–æŸ¥è¯¢é”®**ï¼šç¡®ä¿å°† `QueryKey` åºåˆ—åŒ–ä¸ºå”¯ä¸€å­—ç¬¦ä¸²ï¼ˆå¦‚ `JSON.stringify`ï¼‰ï¼Œé¿å…å¼•ç”¨ä¸åŒä½†å†…å®¹ç›¸åŒçš„é”®è¢«è¯¯åˆ¤ä¸ºä¸åŒã€‚  
2. **é”™è¯¯é™çº§**ï¼šå¤„ç†å¤šæ¬¡é‡è¯•ã€ç½‘ç»œæ³¢åŠ¨ç­‰æƒ…å†µï¼Œé¿å…ç¼“å­˜æ±¡æŸ“ã€‚  
3. **å†…å­˜æ³„æ¼**ï¼šåˆç†è®¾ç½® `cacheTime` å’Œåœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†è®¡æ—¶å™¨ã€‚  

æ­¤æ–¹æ¡ˆå®Œæ•´å¤ç°äº† React Query çš„æ ¸å¿ƒç¼“å­˜ç­–ç•¥ï¼Œå¯é…åˆå…·ä½“ä¸šåŠ¡åœºæ™¯è¿›è¡Œæ‰©å±•ã€‚
