> ðŸ’­ å¥½çš„ï¼Œç”¨æˆ·å¸Œæœ›æˆ‘å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ”¯æŒè·¨ç»„ä»¶çŠ¶æ€å…±ç”¨ä¸”è‡ªåŠ¨åˆ¤å®šä¾èµ–å…³ç³»çš„ State Hookï¼Œç±»ä¼¼äºŽ Zustandã€‚è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥æ¯”è¾ƒæ·±å…¥ï¼Œéœ€è¦ç»“åˆçŽ°æœ‰çš„çŠ¶æ€ç®¡ç†åº“çš„å®žçŽ°æ–¹æ³•ï¼Œå°¤å…¶æ˜¯è‡ªåŠ¨æ”¶é›†ä¾èµ–çš„éƒ¨åˆ†ã€‚
>
> é¦–å…ˆï¼Œæˆ‘éœ€è¦å›žæƒ³ä¸€ä¸‹ Zustand çš„åŸºæœ¬åŽŸç†ã€‚Zustand æ˜¯ä¸€ä¸ªè½»é‡çº§çš„çŠ¶æ€ç®¡ç†åº“ï¼Œä½¿ç”¨æ–¹å¼æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª storeï¼Œç»„ä»¶é€šè¿‡ useStore hook æ¥è®¢é˜…çŠ¶æ€çš„å˜åŒ–ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©æ€§åœ°èŽ·å–éœ€è¦çš„çŠ¶æ€ç‰‡æ®µï¼Œä¾èµ–æ˜¯è‡ªåŠ¨åˆ¤å®šçš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šã€‚
>
> é‚£è¦å®žçŽ°ç±»ä¼¼çš„è‡ªåŠ¨ä¾èµ–æ”¶é›†ï¼Œå¯èƒ½éœ€è¦åˆ©ç”¨ React çš„ useState æˆ–è€… useReducerï¼Œå¹¶è¿½è¸ªç»„ä»¶ä¸­å®žé™…è®¿é—®çš„çŠ¶æ€å±žæ€§ã€‚æ¯å½“ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œhook éœ€è¦è®°å½•å“ªäº›çŠ¶æ€å±žæ€§è¢«è®¿é—®è¿‡ï¼Œç„¶åŽåœ¨çŠ¶æ€æ›´æ–°æ—¶ï¼Œåªé€šçŸ¥é‚£äº›ä¾èµ–è¿™äº›å±žæ€§çš„ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚
>
> å…³é”®ç‚¹åœ¨äºŽå¦‚ä½•è‡ªåŠ¨æ”¶é›†ä¾èµ–é¡¹ã€‚Vue çš„å“åº”å¼ç³»ç»Ÿé€šè¿‡ES6 Proxyæ¥è¿½è¸ªå±žæ€§çš„è®¿é—®ï¼Œç±»ä¼¼åœ°ï¼Œè¿™é‡Œæ˜¯å¦å¯ä»¥åœ¨åˆ›å»ºçŠ¶æ€æ—¶ä½¿ç”¨Proxyæ¥æ‹¦æˆªå±žæ€§çš„è¯»å–ï¼Œä»Žè€Œè‡ªåŠ¨è®°å½•ç»„ä»¶æ‰€ä¾èµ–çš„çŠ¶æ€å±žæ€§ï¼Ÿè¿™æ ·æ¯ä¸ªç»„ä»¶åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è®¿é—®çš„çŠ¶æ€å±žæ€§éƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œå½“è¿™äº›å±žæ€§å˜åŒ–æ—¶ï¼Œå¯¹åº”çš„ç»„ä»¶å°±ä¼šè¢«è§¦å‘æ›´æ–°ã€‚
>
> æ‰€ä»¥å¯èƒ½çš„è®¾è®¡æ­¥éª¤æ˜¯ï¼š
>
> 1. åˆ›å»ºä¸€ä¸ªå…¨å±€çŠ¶æ€å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ProxyåŒ…è£¹è¯¥å¯¹è±¡ï¼Œä»¥ä¾¿æ‹¦æˆªå¯¹çŠ¶æ€çš„è¯»å–æ“ä½œã€‚
>
> 2. å½“ç»„ä»¶ä½¿ç”¨è‡ªå®šä¹‰Hookï¼ˆæ¯”å¦‚useStoreï¼‰æ—¶ï¼Œåœ¨ç»„ä»¶çš„æ¸²æŸ“é˜¶æ®µï¼Œé€šè¿‡Proxyæ”¶é›†æ‰€æœ‰è¢«è®¿é—®çš„çŠ¶æ€å±žæ€§ã€‚
>
> 3. å°†æ”¶é›†åˆ°çš„ä¾èµ–å±žæ€§ä¿å­˜åœ¨ç»„ä»¶å¯¹åº”çš„effectæˆ–refä¸­ï¼Œä»¥ä¾¿åŽç»­æ¯”è¾ƒã€‚
>
> 4. å½“çŠ¶æ€æ›´æ–°æ—¶ï¼Œæ£€æŸ¥æ›´æ–°çš„å±žæ€§æ˜¯å¦åŒ¹é…æŸä¸ªç»„ä»¶çš„ä¾èµ–å±žæ€§ï¼Œå¦‚æžœæœ‰åˆ™è§¦å‘ç»„ä»¶çš„æ›´æ–°ã€‚
>
> ä¸è¿‡ï¼Œå¦‚ä½•åœ¨Reactä¸­å®žçŽ°è¿™ä¸€ç‚¹æ˜¯æŒ‘æˆ˜ï¼Œå› ä¸ºReactä¸ç›´æŽ¥æä¾›é’©å­æ¥æ•èŽ·çŠ¶æ€è®¿é—®ã€‚Zustandçš„å®žçŽ°å¯èƒ½æ›´é«˜æ•ˆï¼Œå®ƒçš„useStore hookå¯èƒ½åˆ©ç”¨äº†ç±»ä¼¼äºŽselectorçš„å‡½æ•°ï¼Œå¹¶é€šè¿‡æ¯”è¾ƒä¸Šä¸€æ¬¡å’Œå½“å‰çš„ç»“æžœæ¥å†³å®šæ˜¯å¦æ›´æ–°ç»„ä»¶ã€‚ä¸è¿‡ç”¨æˆ·éœ€æ±‚æ˜¯è‡ªåŠ¨åˆ¤å®šä¾èµ–ï¼Œä¸éœ€è¦æ‰‹åŠ¨å†™selectorã€‚
>
> å¯èƒ½çš„å®žçŽ°æ–¹å¼ï¼š
>
> ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™useStoreï¼Œç±»ä¼¼äºŽuseStore(state => state.someProp)ï¼Œä½†è¿™æ ·éœ€è¦ç”¨æˆ·æ˜¾å¼åœ°é€‰æ‹©ä¾èµ–ã€‚ä½†å¦‚æžœè¦å®žçŽ°è‡ªåŠ¨ï¼Œå¯èƒ½éœ€è¦å¦ä¸€ç§æ–¹å¼ï¼Œæ¯”å¦‚åœ¨æ¸²æŸ“é˜¶æ®µè¿½è¸ªçŠ¶æ€å±žæ€§çš„è®¿é—®ã€‚
>
> æ¯”å¦‚ï¼Œåœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨å¯åŠ¨ä¸€ä¸ªâ€œæ”¶é›†â€æ¨¡å¼ï¼Œå½“ç»„ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­è®¿é—®åˆ°çŠ¶æ€ä¸­çš„å±žæ€§æ—¶ï¼Œå°†è¿™äº›å±žæ€§è®°å½•ä¸‹æ¥ï¼Œä½œä¸ºè¯¥ç»„ä»¶çš„ä¾èµ–ã€‚ä¹‹åŽå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ£€æŸ¥å“ªäº›ç»„ä»¶çš„ä¾èµ–ä¸Žå˜åŒ–çš„å±žæ€§æœ‰äº¤é›†ï¼Œä»Žè€Œè§¦å‘æ›´æ–°ã€‚
>
> è¦å®žçŽ°è¿™ç§è‡ªåŠ¨æ”¶é›†ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ES6çš„Proxyæ¥åŒ…è£…çŠ¶æ€å¯¹è±¡ã€‚å½“ç»„ä»¶åœ¨æ¸²æŸ“æœŸé—´è®¿é—®çŠ¶æ€å±žæ€§æ—¶ï¼Œè¿™äº›è®¿é—®ä¼šè¢«Proxyæ•èŽ·ï¼Œæ­¤æ—¶è®°å½•ä¸‹è¢«è®¿é—®çš„å±žæ€§ï¼Œå¹¶å…³è”åˆ°å½“å‰çš„ç»„ä»¶å®žä¾‹æˆ–æŸä¸ªä¸Šä¸‹æ–‡ä¸­çš„ä¾èµ–æ”¶é›†å™¨ã€‚
>
> ä¸è¿‡è¿™å¯èƒ½éœ€è¦ä¾µå…¥ç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œæˆ–è€…åœ¨useStore hookä¸­ä½¿ç”¨æŸç§æœºåˆ¶åœ¨æ¯ä¸ªæ¸²æŸ“å‘¨æœŸä¸´æ—¶ç»‘å®šä¸€ä¸ªä¾èµ–æ”¶é›†å™¨ã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰hookä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡æ¥è®°å½•å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶å®žä¾‹ï¼Œå¹¶åœ¨æ­¤å˜é‡å­˜åœ¨çš„æœŸé—´ï¼Œå°†æ‰€æœ‰çŠ¶æ€çš„è®¿é—®è®°å½•åˆ°è¯¥ç»„ä»¶çš„ä¾èµ–åˆ—è¡¨ä¸­ã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒReactçš„å‡½æ•°ç»„ä»¶å¯èƒ½åœ¨æ¸²æŸ“æ—¶å¤šæ¬¡è°ƒç”¨ï¼Œå› æ­¤éœ€è¦ç¡®ä¿ä¾èµ–æ”¶é›†ä¸Žæ­£ç¡®çš„ç»„ä»¶å®žä¾‹å…³è”ã€‚è¿™å¯èƒ½éœ€è¦åˆ©ç”¨useRefæ¥ä¿å­˜æ¯ä¸ªç»„ä»¶çš„ä¾èµ–åˆ—è¡¨ã€‚
>
> ç„¶è€Œï¼Œè¿™éƒ¨åˆ†å®žçŽ°å¯èƒ½ä¼šæ¯”è¾ƒæ£˜æ‰‹ï¼Œå› ä¸ºReactçš„æ¸²æŸ“æ˜¯å‡½æ•°å¼çš„ï¼Œä¸èƒ½åœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´ç›´æŽ¥è¿½è¸ªåˆ°ç»„ä»¶çš„å®žä¾‹ã€‚æˆ–è€…å¯èƒ½éœ€è¦é€šè¿‡è‡ªå®šä¹‰hookçš„å†…éƒ¨çŠ¶æ€å’ŒuseEffectæ¥ç®¡ç†ä¾èµ–å…³ç³»ã€‚
>
> å¦å¤–ï¼Œå½“ä¸€ä¸ªçŠ¶æ€è¢«æ›´æ–°æ—¶ï¼Œéœ€è¦é€šçŸ¥æ‰€æœ‰ä¾èµ–è¯¥çŠ¶æ€çš„ç»„ä»¶è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚è¿™æ—¶éœ€è¦è€ƒè™‘ä½¿ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ŒçŠ¶æ€å˜æ›´æ—¶è§¦å‘æ‰€æœ‰è®¢é˜…è€…æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ã€‚
>
> é‚£ä¹ˆï¼Œå…·ä½“æ­¥éª¤å¯èƒ½æ˜¯ï¼š
>
> 1. åˆ›å»ºå…¨å±€çŠ¶æ€å­˜å‚¨ï¼Œä½¿ç”¨Proxyä»£ç†çŠ¶æ€å¯¹è±¡ï¼Œæ‹¦æˆªè¯»å–æ“ä½œã€‚
>
> 2. åœ¨hookä¸­è·Ÿè¸ªå½“å‰ç»„ä»¶å®žä¾‹ï¼ˆæˆ–å‡½æ•°ç»„ä»¶æ¸²æŸ“æ—¶çš„ä¸Šä¸‹æ–‡ï¼‰æ‰€è®¿é—®çš„çŠ¶æ€å±žæ€§ã€‚
>
> 3. ç»„ä»¶æŒ‚è½½æ—¶è®¢é˜…çŠ¶æ€å˜åŒ–ï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè®¢é˜…ã€‚
>
> 4. å½“çŠ¶æ€å˜åŒ–æ—¶ï¼ŒéåŽ†æ‰€æœ‰è®¢é˜…çš„ç»„ä»¶ï¼Œæ£€æŸ¥å…¶ä¾èµ–çš„å±žæ€§æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œä»Žè€Œå†³å®šæ˜¯å¦è§¦å‘æ›´æ–°ã€‚
>
> å…³äºŽè‡ªåŠ¨ä¾èµ–æ”¶é›†çš„ç»†èŠ‚ï¼š
>
> å½“ç»„ä»¶è°ƒç”¨useStoreæ—¶ï¼Œå¯èƒ½è¿”å›žçŠ¶æ€çš„Proxyå¯¹è±¡ã€‚åœ¨ç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œæ¯å½“è®¿é—®çŠ¶æ€å±žæ€§ï¼ŒProxyä¼šæ•èŽ·è¿™äº›getæ“ä½œï¼Œè®°å½•åˆ°å½“å‰ç»„ä»¶çš„ä¾èµ–åˆ—è¡¨ä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¯æ¬¡æ¸²æŸ“å‰ï¼Œåˆ©ç”¨ä¸€ä¸ªå…¨å±€å˜é‡å­˜å‚¨å½“å‰ç»„ä»¶çš„ä¾èµ–æ”¶é›†å™¨ï¼Œåœ¨ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œæ¯å½“çŠ¶æ€å±žæ€§è¢«è¯»å–ï¼Œå°±å°†è¯¥å±žæ€§æ·»åŠ åˆ°ä¾èµ–åˆ—è¡¨ã€‚æ¸²æŸ“ç»“æŸåŽï¼Œä¿å­˜è¿™ä¸ªåˆ—è¡¨ï¼Œå¹¶å°†å…¶ä¸Žä¹‹å‰çš„ä¾èµ–åˆ—è¡¨è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æžœæ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šè§¦å‘æ›´æ–°ã€‚
>
> ä½†æ˜¯è¿™éœ€è¦ç¡®ä¿ä¾èµ–æ”¶é›†æ˜¯åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æ­£ç¡®å·¥ä½œï¼Œä»¥åŠæ¯ä¸ªæ¸²æŸ“å‘¨æœŸéƒ½èƒ½æ­£ç¡®è®°å½•åˆ°ä¾èµ–ã€‚è¿™ç§æ€è·¯ç±»ä¼¼äºŽMobXçš„observer HOCï¼Œå®ƒä¼šè‡ªåŠ¨è·Ÿè¸ªç»„ä»¶æ¸²æŸ“ä¸­ä½¿ç”¨çš„å¯è§‚å¯Ÿå±žæ€§ã€‚
>
> ç»“åˆåˆ°React Hooksè®¾è®¡ä¸­ï¼Œå¯èƒ½éœ€è¦ç»“åˆuseStateæˆ–useReduceræ¥ç®¡ç†ç»„ä»¶çš„å¼ºåˆ¶æ›´æ–°ã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰hookä¸­ï¼Œå¯ä»¥ä½¿ç”¨useStateæ¥è§¦å‘ç»„ä»¶æ›´æ–°ï¼ŒåŒæ—¶åˆ©ç”¨Proxyè®°å½•ä¾èµ–ï¼Œå¹¶è®¢é˜…çŠ¶æ€çš„å˜æ›´äº‹ä»¶ã€‚
>
> å…·ä½“å®žçŽ°æ­¥éª¤ï¼š
>
> æ­¥éª¤ä¸€ï¼šåˆ›å»ºå…¨å±€çŠ¶æ€ä»“åº“
>
> åˆ›å»ºä¸€ä¸ªçŠ¶æ€å­˜å‚¨åº“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªProxyå¯¹è±¡ï¼Œç”¨äºŽè¿½è¸ªå¯¹çŠ¶æ€çš„è®¿é—®ã€‚æ¯”å¦‚ï¼š
>
> ```javascript
>
> function createStore(initialState) {
>
>   const listeners = new Set(); // ç»„ä»¶è®¢é˜…åˆ—è¡¨
>
>   let state = new Proxy(initialState, {
>
>     get(target, prop) {
>
>       // å½“ç»„ä»¶è¯»å–çŠ¶æ€æ—¶ï¼Œè®°å½•è®¿é—®çš„å±žæ€§
>
>       track(prop);
>
>       return target[prop];
>
>     },
>
>     set(target, prop, value) {
>
>       target[prop] = value;
>
>       trigger(prop); // è§¦å‘æ›´æ–°
>
>       return true;
>
>     }
>
>   });
>
>   function track(prop) {
>
>     // å½“å‰æ­£åœ¨æ”¶é›†ä¾èµ–çš„ç»„ä»¶ï¼Œè®°å½•å±žæ€§åˆ°å…¶ä¾èµ–åˆ—è¡¨ä¸­
>
>     const currentComponent = getCurrentComponent();
>
>     if (currentComponent) {
>
>       currentComponent.deps.add(prop);
>
>     }
>
>   }
>
>   function trigger(changedProp) {
>
>     // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ£€æŸ¥æ˜¯å¦ä¾èµ–å˜åŒ–äº†çš„å±žæ€§
>
>     listeners.forEach(listener => {
>
>       if (listener.deps.has(changedProp)) {
>
>         listener.forceUpdate();
>
>       }
>
>     });
>
>   }
>
>   return {
>
>     state,
>
>     subscribe(listener) {
>
>       listeners.add(listener);
>
>       return () => listeners.delete(listener);
>
>     }
>
>   };
>
> }
>
> ```
>
> æ­¥éª¤äºŒï¼šåœ¨Hookä¸­å¤„ç†ä¾èµ–æ”¶é›†
>
> åœ¨è‡ªå®šä¹‰çš„useStore Hookä¸­ï¼Œç®¡ç†ç»„ä»¶çš„ä¾èµ–æ”¶é›†ï¼š
>
> ```javascript
>
> const store = createStore({ count: 0, text: 'hello' });
>
> function useStore() {
>
>   const [, forceUpdate] = useState({});
>
>   const componentRef = useRef({ deps: new Set() });
>
>   useEffect(() => {
>
>     const listener = {
>
>       deps: componentRef.current.deps,
>
>       forceUpdate: () => forceUpdate({})
>
>     };
>
>     const unsubscribe = store.subscribe(listener);
>
>     return () => unsubscribe();
>
>   }, []);
>
>   // åœ¨æ¸²æŸ“å‰è®¾ç½®å½“å‰ç»„ä»¶ï¼Œå¼€å§‹æ”¶é›†ä¾èµ–
>
>   setCurrentComponent(componentRef.current);
>
>   componentRef.current.deps = new Set(); // æ¸…ç©ºæ—§çš„ä¾èµ–
>
>   const state = store.state;
>
>   // åœ¨èŽ·å–ProxyçŠ¶æ€æ—¶ï¼Œtrackå‡½æ•°ä¼šè¢«è§¦å‘æ”¶é›†ä¾èµ–
>
>   // æ¸²æŸ“å®ŒæˆåŽï¼Œæ¸…ç†currentComponent
>
>   resetCurrentComponent();
>
>   return state;
>
> }
>
> ```
>
> è¿™é‡Œçš„setCurrentComponentå¯èƒ½éœ€è¦é€šè¿‡æ¨¡å—å†…çš„å…¨å±€å˜é‡æ¥å®žçŽ°ï¼Œä¾‹å¦‚ï¼š
>
> ```javascript
>
> let currentComponent = null;
>
> function getCurrentComponent() {
>
>   return currentComponent;
}
>
> function setCurrentComponent(component) {
>
>   currentComponent = component;
>
> }
>
> function resetCurrentComponent() {
>
>   currentComponent = null;
>
> }
>
> ```
>
> å½“ä¸€ä¸ªç»„ä»¶åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œè°ƒç”¨useStoreæ—¶ä¼šè®¾ç½®currentComponentä¸ºè‡ªèº«çš„å¼•ç”¨ï¼Œç„¶åŽæ¯æ¬¡è®¿é—®store.stateçš„æŸä¸ªå±žæ€§æ—¶ï¼ŒProxyçš„getæ–¹æ³•è¢«è§¦å‘ï¼Œè°ƒç”¨trackï¼Œæ­¤æ—¶å°†å±žæ€§æ·»åŠ åˆ°currentComponent.depsä¸­ã€‚æ¸²æŸ“å®ŒæˆåŽï¼ŒcurrentComponentè¢«æ¸…ç©ºï¼Œé¿å…å…¶ä»–ç»„ä»¶åœ¨ä¹‹åŽçš„æ¸²æŸ“ä¸­é”™è¯¯è®°å½•å±žæ€§ã€‚
>
> æ­¥éª¤ä¸‰ï¼šå¤„ç†çŠ¶æ€å˜æ›´
>
> å½“çŠ¶æ€å±žæ€§è¢«ä¿®æ”¹æ—¶ï¼Œè§¦å‘triggerå‡½æ•°ï¼ŒéåŽ†æ‰€æœ‰listenerï¼Œæ£€æŸ¥ä»–ä»¬çš„depsæ˜¯å¦åŒ…å«å˜æ›´çš„å±žæ€§ï¼Œå¦‚æžœæœ‰çš„è¯ï¼Œè°ƒç”¨forceUpdateå¼ºåˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚
>
> ä½†è¿™é‡Œé¢å¯èƒ½å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼š
>
> 1. ä¾èµ–æ”¶é›†å¯èƒ½ä¸å¤Ÿç²¾ç¡®ã€‚ä¾‹å¦‚ï¼Œç»„ä»¶å¯èƒ½åœ¨æŸä¸ªæ¡ä»¶ä¸‹æ‰ä¼šè®¿é—®æŸä¸ªå±žæ€§ï¼Œè¿™ä¼šå¯¼è‡´ä¸åŒæ¸²æŸ“é—´çš„ä¾èµ–å˜åŒ–ï¼Œä»Žè€Œè§¦å‘ä¸å¿…è¦çš„æ›´æ–°æˆ–é—æ¼å¿…è¦çš„æ›´æ–°ã€‚
>
> 2. ä½¿ç”¨å…¨å±€å˜é‡currentComponentå¯èƒ½ä¼šå¯¼è‡´åœ¨å¼‚æ­¥æ“ä½œä¸­çš„é—®é¢˜ï¼Œå› ä¸ºæ¸²æŸ“æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥åªè¦åœ¨renderå‡½æ•°æ‰§è¡Œæ—¶æ­£ç¡®è®¾ç½®åº”è¯¥æ²¡é—®é¢˜ï¼Œä½†åœ¨å¼‚æ­¥ä»£ç ä¸­ï¼Œï¼ˆå¦‚setTimeoutä¸­è®¿é—®çŠ¶æ€ï¼‰å°±ä¼šæœ‰é”™è¯¯æ”¶é›†çš„å¯èƒ½ã€‚ä½†é€šå¸¸ï¼Œç”¨æˆ·å¯èƒ½åœ¨effectä¸­è®¿é—®çŠ¶æ€ï¼Œè¿™æ—¶åº”ä¸å±žäºŽæ¸²æŸ“é˜¶æ®µï¼Œä¸ä¼šè¢«æ”¶é›†åˆ°ä¾èµ–ï¼Œä½†å…·ä½“æƒ…å†µéœ€è¦çœ‹Hookçš„è®¾è®¡ã€‚
>
> å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒReactç»„ä»¶å¯èƒ½å› ä¸ºçˆ¶ç»„ä»¶æ¸²æŸ“è€Œå¤šæ¬¡è°ƒç”¨ï¼Œå¯¼è‡´ä¾èµ–æ”¶é›†å‡ºçŽ°æ··ä¹±ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœåœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ï¼Œç»„ä»¶çš„ä¾èµ–ä¸åŒï¼Œä½†ç”±äºŽProxyä»…åœ¨æ¸²æŸ“æœŸé—´æ”¶é›†ä¾èµ–ï¼Œé‚£ä¹ˆéœ€è¦ç¡®ä¿æ¯æ¬¡æ¸²æŸ“å‰æ¸…ç©ºæ—§ä¾èµ–ã€‚
>
> å¦å¤–éœ€è¦è€ƒè™‘å¦‚ä½•åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­æ­£ç¡®æ›´æ–°ä¾èµ–åˆ—è¡¨ã€‚
>
> ä¾‹å¦‚ï¼Œåœ¨æ­¥éª¤äºŒçš„useStoreä¸­ï¼š
>
> ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œä¼šæ”¶é›†ä¾èµ–å¦‚countï¼›è€Œç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶ï¼Œå¯èƒ½èŽ·å–äº†textå±žæ€§ã€‚æ­¤æ—¶triggerçš„listenerä¸­çš„depséœ€è¦æ›´æ–°ä¸ºæ–°çš„textå±žæ€§ï¼Œä»¥ä¾¿åŽç»­çŠ¶æ€å˜æ›´åªè§¦å‘å¿…è¦çš„æ›´æ–°ã€‚
>
> è¿™ä¸€ç‚¹åœ¨ä¹‹å‰çš„ä»£ç ç¤ºä¾‹ä¸­æ²¡æœ‰å¤„ç†ï¼Œå› ä¸ºcomponentRef.current.depsä¼šæ¯æ¬¡åœ¨æ¸²æŸ“å‰è¢«é‡ç½®ä¸ºæ–°çš„Setã€‚ä¸”åœ¨effectä¸­ï¼Œlistener.depså¼•ç”¨çš„æ˜¯ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶çš„depsï¼Œè¿™å¯èƒ½é€ æˆé—®é¢˜ã€‚
>
> å› æ­¤ï¼Œå¯èƒ½éœ€è¦å°†ä¾èµ–åˆ—è¡¨çš„æ›´æ–°åŒæ­¥åˆ°è®¢é˜…çš„listenerä¸­åŽ»ã€‚æˆ–è€…ï¼Œåœ¨æ¯æ¬¡æ¸²æŸ“åŽæ›´æ–°listenerçš„ä¾èµ–ã€‚
>
> ä½†effectä»…åœ¨æŒ‚è½½æ—¶è¿è¡Œä¸€æ¬¡ï¼Œè¿™æ—¶å€™çš„ä¾èµ–ä¸ä¼šè‡ªåŠ¨æ›´æ–°ã€‚å¯èƒ½å¯¼è‡´åœ¨åŽç»­æ¸²æŸ“ä¸­ï¼Œç»„ä»¶çš„ä¾èµ–å·²ç»å˜åŒ–ï¼ˆæ¯”å¦‚è®¿é—®äº†ä¸åŒçš„å±žæ€§ï¼‰ï¼Œä½†è®¢é˜…çš„listenerçš„depsä»ç„¶å¼•ç”¨æ—§çš„é›†åˆï¼Œæ— æ³•æ­£ç¡®è§¦å‘æ›´æ–°ã€‚
>
> æ‰€ä»¥è¿™ä¸€æ­¥å¯èƒ½æ˜¯è¿™ä¸ªè®¾è®¡çš„å…³é”®éš¾ç‚¹ã€‚å¦‚ä½•ç¡®ä¿æ¯æ¬¡ç»„ä»¶æ¸²æŸ“åŽï¼Œå…¶ä¾èµ–çš„æœ€æ–°é›†åˆèƒ½åæ˜ åˆ°listenerä¸­çš„æ£€æŸ¥æ¡ä»¶ï¼Ÿ
>
> å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼šå°†ç»„ä»¶çš„æœ€æ–°ä¾èµ–ä¿å­˜åˆ°æŸä¸ªåœ°æ–¹ï¼Œç„¶åŽåœ¨è§¦å‘å™¨è§¦å‘æ—¶ï¼Œæ£€æŸ¥æœ€æ–°çš„ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œæ¯æ¬¡æ¸²æŸ“åŽï¼Œæ›´æ–°listenerçš„depsï¼š
>
> ä½†æ˜¯åœ¨ä¾‹å­ä¸­ï¼Œlisteneræ˜¯æŒ‚åœ¨ç»„ä»¶effectä¸­çš„ï¼Œä½¿ç”¨componentRefä¿å­˜ï¼Œè€Œæ¯æ¬¡æ¸²æŸ“æ—¶ï¼ŒcomponentRef.currentè¢«èµ‹äºˆä¸€ä¸ªæ–°çš„Setä½œä¸ºdepsã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦æ¯æ¬¡æ¸²æŸ“åŽï¼Œæ›´æ–°å…¶ä¾èµ–åˆ°å¯¹åº”çš„listenerã€‚æˆ–è€…ï¼Œå°†forceUpdateå’Œdepsä¿å­˜åœ¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ¯æ¬¡æ¸²æŸ“æ—¶æ›´æ–°è¿™ä¸ªå¯¹è±¡çš„depsã€‚
>
> ä¿®æ”¹ä»£ç å®žçŽ°ï¼š
>
> åœ¨ç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ—¶ï¼ˆå³useStoreçš„æ‰§è¡Œä¸­ï¼‰ï¼Œåœ¨æ”¶é›†å®Œä¾èµ–åŽï¼Œå°†componentRef.current.depså­˜å…¥æŸä¸ªåœ°æ–¹ï¼Œæ¯”å¦‚listenerçš„depså¯ä»¥æ˜¯ä¸€ä¸ªå¼•ç”¨çš„å˜é‡ã€‚æ¯”å¦‚ï¼Œåœ¨effectä¸­ï¼Œå¯ä»¥ç»´æŠ¤depsçš„æ›´æ–°ï¼š
>
> ```javascript
>
> function useStore() {
>
>   const [, forceUpdate] = useState({});
>
>   const deps = useRef(new Set());
>
>   const listener = useRef({ deps: deps.current, forceUpdate: () => forceUpdate({}) });
>
>   useEffect(() => {
>
>     const unsubscribe = store.subscribe(listener.current);
>
>     return () => unsubscribe();
>
>   }, []);
>
>   // æ¯æ¬¡æ¸²æŸ“å‰ï¼Œæ¸…ç©ºä¾èµ–å¹¶è®¾ç½®å½“å‰ç»„ä»¶
>
>   setCurrentComponent({ deps: deps.current });
>
>   deps.current = new Set(); // é‡ç½®ä¸ºæ–°çš„Setï¼Ÿ
>
>   // è®¿é—®store.stateå°†æ¿€å‘Proxyçš„getterï¼Œæ”¶é›†ä¾èµ–
>
>   const state = store.state;
>
>   // ç¡®ä¿ç›‘å¬å™¨çš„depsæ˜¯æœ€æ–°çš„
>
>   listener.current.deps = deps.current;
>
>   resetCurrentComponent();
>
>   return state;
>
> }
```
>
> å†çœ‹è¿™è¡Œï¼šæ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œdeps.current è¢«åˆ›å»ºä¸ºæ–°çš„Setã€‚ç„¶åŽåœ¨ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œæ¯å½“è®¿é—®ä¸€ä¸ªçŠ¶æ€å±žæ€§ï¼Œtrack(prop)å°±ä¼šå°†propæ·»åŠ åˆ°deps.currentä¸­ã€‚ç„¶åŽï¼Œæ¸²æŸ“å®ŒæˆåŽï¼Œå°†listener.current.depsè®¾ç½®ä¸ºdeps.currentã€‚
>
> ä½†æ˜¯ï¼Œè¿™ç§å¤„ç†å¯èƒ½æœ‰é—®é¢˜ï¼Œå› ä¸ºåŽŸæ¥çš„depså¼•ç”¨æ˜¯ä¼ é€’ç»™effectçš„ï¼Œä½†effectä»…åœ¨æŒ‚è½½æ—¶åˆå§‹åŒ–ã€‚åŽç»­å¦‚æžœdeps.currentå˜åŒ–ï¼ŒEffectä¸­çš„listenerå¯èƒ½ä»ç„¶å¼•ç”¨æ—§çš„depså®žä¾‹å—ï¼Ÿä¾‹å¦‚ï¼š
>
> åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œdeps.currentæ˜¯Set1ï¼Œlistener.current.depsæ˜¯Set1ã€‚
>
> åœ¨ç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶ï¼Œdeps.currentè¢«é‡ç½®ä¸ºSet2ï¼Œå¹¶ä¸”åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æ”¶é›†äº†æ–°çš„å±žæ€§ï¼Œç„¶åŽåœ¨ç»“æŸåŽï¼Œlistener.current.depsè¢«è®¾ç½®ä¸ºSet2ã€‚é‚£ä¹ˆå½“çŠ¶æ€å˜æ›´æ—¶ï¼Œè§¦å‘å™¨æ£€æŸ¥listenerçš„depså³ä¸ºSet2ï¼Œæ˜¯æ­£ç¡®çš„ã€‚ä¸ç®¡effectæ˜¯å¦æ›´æ–°ï¼Œå› ä¸ºlistener.currentæ˜¯è¢«æ”¹å˜çš„å¯¹è±¡ã€‚æ‰€ä»¥å½“ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œlistenerçš„depsä¼šæ›´æ–°åˆ°æœ€æ–°çš„çŠ¶æ€ï¼Œæ— éœ€é‡æ–°æ‰§è¡Œè®¢é˜…ï¼ˆå› ä¸ºeffectåªåœ¨æŒ‚è½½æ—¶è®¢é˜…ä¸€æ¬¡ï¼Œæ­¤æ—¶listenerå¯¹è±¡è¢«storeçš„è®¢é˜…ä¿ç•™ï¼Œæ‰€ä»¥å®ƒçš„depså±žæ€§å¯ä»¥ä¿®æ”¹ï¼‰ã€‚
>
> è¿™æ—¶ï¼Œåœ¨è§¦å‘å™¨è§¦å‘çš„æ—¶å€™ï¼Œä¼šéåŽ†æ¯ä¸ªlistenerï¼ˆå³ç»„ä»¶å®žä¾‹çš„ç›‘å¬å¯¹è±¡ï¼‰ï¼Œå¹¶ä¸”æ£€æŸ¥å…¶depsæ˜¯å¦æœ‰å˜æ›´çš„å±žæ€§ã€‚ä½†æ˜¯è¿™äº›depså·²ç»æ˜¯æœ€æ–°çš„ï¼Œå› ä¸ºç»„ä»¶æ¯æ¬¡æ¸²æŸ“åŽéƒ½ä¼šæ›´æ–°ç›‘å¬å™¨çš„depsã€‚
>
> è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½è§£å†³ä¾èµ–æ›´æ–°çš„é—®é¢˜ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“çŠ¶æ€å˜æ›´è§¦å‘æ—¶ï¼Œç»„ä»¶å¯èƒ½å·²ç»é‡æ–°æ¸²æŸ“ï¼Œè¿™æ—¶å€™å…¶æœ€æ–°çš„depsä¼šè¢«æ­£ç¡®å¼•ç”¨ã€‚
>
> æŽ¥ä¸‹æ¥çš„ç¤ºä¾‹åœºæ™¯ï¼š
>
> ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“è®¿é—®äº†countï¼Œå¯¹åº”çš„deps.currentï¼ˆSet1ï¼‰è¢«è®¾ç½®ä¸º{count}ï¼Œlistenerçš„depsæ˜¯Set1ã€‚æ­¤æ—¶çŠ¶æ€æ›´æ–°countçš„è¯ï¼Œç»„ä»¶è§¦å‘æ›´æ–°ã€‚
>
> åœ¨æ›´æ–°åŽçš„æ¸²æŸ“ä¸­ï¼Œè®¿é—®äº†textå±žæ€§ï¼Œæ­¤æ—¶deps.currentè¢«é‡ç½®ä¸ºæ–°çš„Set2ï¼Œæ”¶é›†textå±žæ€§ã€‚æ¸²æŸ“å®ŒæˆåŽï¼Œlistenerçš„depsæ›´æ–°ä¸ºSet2ã€‚è¿™æ—¶ï¼Œå½“å˜æ›´textæ—¶è§¦å‘ç»„ä»¶æ›´æ–°ï¼ŒåŒæ ·ï¼Œå½“å˜æ›´countæ—¶ï¼Œæ­¤æ—¶ç»„ä»¶ä¾èµ–å·²ç»ä»…ä»…æ˜¯textï¼Œæ‰€ä»¥ä¸è§¦å‘å…¶æ›´æ–°ã€‚
>
> è¿™æ ·å°±èƒ½å®žçŽ°è‡ªåŠ¨ä¾èµ–æ”¶é›†çš„æ•ˆæžœã€‚
>
> æŽ¥ä¸‹æ¥è¦è€ƒè™‘çš„æ˜¯ï¼š
>
> å¦‚ä½•ç¡®ä¿Proxyçš„getæ‹¦æˆªåœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå³ä»…å½“ç»„ä»¶æ­£åœ¨æ¸²æŸ“æ—¶æ‰è®°å½•ä¾èµ–ã€‚å› ä¸ºå¦‚æžœåœ¨useEffectä¸­æˆ–å…¶ä»–å¼‚æ­¥æ“ä½œä¸­è®¿é—®çŠ¶æ€ï¼Œè¿™æ—¶å€™å¯èƒ½æ²¡æœ‰å½“å‰ç»„ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œå¯¼è‡´ä¾èµ–ä¸ä¼šè¢«æ­£ç¡®æ”¶é›†ï¼Œæˆ–é”™è¯¯åœ°æ”¶é›†åˆ°å…¶ä»–ç»„ä»¶çš„ä¸Šä¸‹æ–‡ã€‚
>
> æ¯”å¦‚ï¼š
>
> function Component() {
>
>   const state = useStore();
>
>   useEffect(() => {
>
>     console.log(state.text); // è¿™æ¡è®¿é—®æ˜¯å¦ä¼šè¢«è®°å½•ä¸ºä¾èµ–ï¼Ÿ
>
>   }, [state.text]);
>
>   return <div>{state.count}</div>;
>
> }
>
> åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œstate.countè¢«è®¿é—®ï¼Œå› è€Œæ”¶é›†åˆ°countçš„ä¾èµ–ã€‚è€ŒuseEffectä¸­çš„state.textä¸ä¼šè¢«æ”¶é›†ï¼Œå› ä¸ºEffectçš„å›žè°ƒåœ¨æ¸²æŸ“ä¹‹åŽæ‰§è¡Œï¼Œæ­¤æ—¶currentComponentå·²ç»è¢«é‡ç½®ä¸ºnullï¼Œæ— æ³•è·Ÿè¸ªã€‚
>
> è¿™æ—¶ï¼Œå½“textè¢«ä¿®æ”¹æ—¶ï¼Œä¸ä¼šè§¦å‘ç»„ä»¶æ›´æ–°ã€‚å› ä¸ºç»„ä»¶çš„ä¾èµ–æ˜¯countã€‚ä½†å¦‚æžœç”¨æˆ·åœ¨Effectä¸­æœ‰ç”¨åˆ°textï¼Œåˆ™ä¸ä¼šè‡ªåŠ¨è§¦å‘æ›´æ–°ã€‚è¿™è¯´æ˜Žè¿™ç§æƒ…å†µä¸‹è‡ªåŠ¨æ”¶é›†çš„å±€é™æ€§â€”â€”åªæœ‰æ¸²æŸ“æœŸé—´è®¿é—®çš„çŠ¶æ€å±žæ€§æ‰ä¼šè¢«ä½œä¸ºä¾èµ–ã€‚å› æ­¤ï¼Œç”¨æˆ·éœ€è¦æ³¨æ„åœ¨Effectä¸­çš„çŠ¶æ€è®¿é—®ä¸ä¼šè¢«è‡ªåŠ¨è·Ÿè¸ªï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨ç®¡ç†ã€‚
>
> è¿™å¯èƒ½éœ€è¦å‘Šè¯‰ç”¨æˆ·ï¼Œåœ¨æ¸²æŸ“ä¹‹å¤–çš„æ“ä½œä¸­çŠ¶æ€å˜åŒ–æ—¶ï¼Œå¦‚ä½•è§¦å‘æ›´æ–°ã€‚æˆ–è€…ï¼Œåªèƒ½åœ¨æ¸²æŸ“æœŸé—´æ”¶é›†ä¾èµ–ï¼Œè¿™å¯èƒ½é™åˆ¶äº†è‡ªåŠ¨æ”¶é›†çš„èƒ½åŠ›ï¼Œä½†ç¬¦åˆå¸¸è§çš„Hooksè§„èŒƒï¼ˆä¾èµ–æ•°ç»„ä¸­çš„å€¼é€šå¸¸åœ¨æ¸²æŸ“æ—¶ç¡®å®šï¼‰ã€‚
>
> å› æ­¤ï¼Œè®¾è®¡è¿™æ ·çš„Hookæ—¶éœ€è¦æ˜Žç¡®ä¾èµ–æ”¶é›†çš„èŒƒå›´ä»…é™äºŽæ¸²æŸ“æ—¶çš„åŒæ­¥è®¿é—®ã€‚
>
> å¦ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•è§¦å‘åˆå§‹çš„è®¢é˜…ã€‚åœ¨ä¸Šè¿°è‡ªå®šä¹‰çš„useStoreä¸­ï¼Œæ¯ä¸ªç»„ä»¶åœ¨æŒ‚è½½æ—¶è®¢é˜…åˆ°storeã€‚åœ¨æ¯æ¬¡çŠ¶æ€å˜æ›´æ—¶ï¼Œæ£€æŸ¥å½¼æ­¤çš„ä¾èµ–å±žæ€§æ˜¯å¦æœ‰äº¤é›†ï¼Œä»Žè€Œå†³å®šæ˜¯å¦æ›´æ–°ã€‚
>
> è¿™åŸºæœ¬ä¸Šç±»ä¼¼äºŽä¸€ç§è‡ªåŠ¨åŒ–çš„ä¾èµ–è®¢é˜…ï¼Œä¸åŒäºŽZustandä¸­çš„é€šè¿‡é€‰æ‹©å™¨æ¥æ˜¾å¼é€‰æ‹©æ‰€éœ€çŠ¶æ€ç‰‡æ®µï¼Œä½†åœ¨è¿™ç§è®¾è®¡ä¸­ï¼Œä¾èµ–æ”¶é›†æ˜¯éšå¼çš„ï¼ŒåŸºäºŽç»„ä»¶å®žé™…è®¿é—®çš„å±žæ€§ã€‚
>
> æ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼š
>
> å¦‚æžœçŠ¶æ€å¯¹è±¡è¾ƒå¤§ï¼Œä½†ç»„ä»¶åªä½¿ç”¨äº†å…¶ä¸­ä¸€å°éƒ¨åˆ†å±žæ€§ï¼Œé‚£ä¹ˆè¿™ç§è‡ªåŠ¨æ”¶é›†çš„æ–¹å¼å¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ã€‚ç„¶è€Œï¼Œæ¯ä¸ªç»„ä»¶éƒ½è®¢é˜…åˆ°å…¨å±€ç›‘å¬å™¨çš„é›†åˆï¼Œå½“å±žæ€§å˜æ›´æ—¶ï¼Œéœ€è¦éåŽ†æ‰€æœ‰è®¢é˜…è€…ï¼Œæ£€æŸ¥å®ƒä»¬çš„ä¾èµ–é›†åˆæ˜¯å¦æœ‰æ­¤å±žæ€§ã€‚é¢‘ç¹çš„éåŽ†å¯èƒ½å¯¹æ€§èƒ½æœ‰å½±å“ã€‚å°¤å…¶æ˜¯å½“æœ‰å¾ˆå¤šè®¢é˜…çš„ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶æœ‰ä¸€ä¸ªä¾èµ–é›†åˆçš„æƒ…å†µä¸‹ï¼Œè¿™å°±éœ€è¦é«˜æ•ˆçš„æ£€æŸ¥æ–¹å¼ï¼Œä¾‹å¦‚ä½¿ç”¨Set.hasæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæ‰€ä»¥æ•´ä½“æ€§èƒ½å¯èƒ½è¿˜æ˜¯å¯ä»¥æŽ¥å—ã€‚
>
> å¯èƒ½çš„ä¼˜åŒ–ï¼šå°†çŠ¶æ€çš„æ¯ä¸ªå±žæ€§ç»´æŠ¤ä¸€ä¸ªè®¢é˜…è€…åˆ—è¡¨ï¼Œè¿™æ ·å½“æŸä¸ªå±žæ€§å˜æ›´æ—¶ï¼Œåªéœ€è¦é€šçŸ¥å¯¹åº”çš„è®¢é˜…è€…ã€‚ä¾‹å¦‚ï¼Œæ¯å½“ä¸€ä¸ªç»„ä»¶è®¿é—®å±žæ€§countï¼Œä¼šåœ¨countçš„è®¢é˜…è€…åˆ—è¡¨ä¸­æ·»åŠ è¯¥ç»„ä»¶ã€‚è¿™æ ·ï¼Œå½“countå˜æ›´æ—¶ï¼Œä»…éœ€è¦é€šçŸ¥è¿™ä¸ªåˆ—è¡¨ä¸­çš„ç»„ä»¶ã€‚è¿™éœ€è¦æ›´ç»†ç²’åº¦çš„ä¾èµ–ç®¡ç†ã€‚
>
> ä½†åŽŸæ¥çš„Proxyè®¾è®¡ä¸­ï¼Œå½“ç»„ä»¶è®¿é—®å¤šä¸ªå±žæ€§æ—¶ï¼Œæ¯”å¦‚countå’Œtextï¼Œé‚£ä¹ˆç»„ä»¶çš„listenerä¼šè¢«æ·»åŠ åˆ°countå’Œtextçš„è®¢é˜…åˆ—è¡¨ä¸­å—ï¼Ÿ
>
> éœ€è¦æ”¹å˜è·Ÿè¸ªæ–¹å¼ï¼Œä¸æ˜¯æ”¶é›†æ‰€æœ‰è®¿é—®è¿‡çš„å±žæ€§åˆ°ä¸€ä¸ªSeté‡Œï¼Œè€Œæ˜¯åœ¨æ¯ä¸ªå±žæ€§çš„getteræ—¶ï¼Œå°†å½“å‰çš„listeneråŠ å…¥åˆ°æ­¤å±žæ€§çš„ç›‘å¬åˆ—è¡¨ä¸­ã€‚æ¯å½“setå±žæ€§æ—¶ï¼Œåªéœ€è¦è§¦å‘è¯¥å±žæ€§çš„æ‰€æœ‰listenersã€‚è¿™å¯èƒ½æ›´é«˜æ•ˆã€‚
>
> ä¾‹å¦‚ï¼Œstoreçš„ç»“æž„å¯ä»¥æ”¹ä¸ºï¼š
>
> æ¯ä¸ªå±žæ€§å…³è”ä¸€ä¸ªç›‘å¬å™¨é›†åˆï¼Œä¾‹å¦‚ï¼š
>
> ```javascript
>
> function createStore(initialState) {
>
>   const listeners = new Map(); // keyæ˜¯å±žæ€§åï¼Œvalueæ˜¯Set(listener)
>
>   let state = new Proxy(initialState, {
>
>     get(target, prop) {
>
>       track(prop); // è¿½è¸ªå½“å‰ç»„ä»¶ç›‘å¬ä¾èµ–è¿™ä¸ªå±žæ€§
>
>       return target[prop];
>
>     },
>
>     set(target, prop, value) {
>
>       target[prop] = value;
>
>       trigger(prop); // è§¦å‘æ­¤å±žæ€§çš„æ‰€æœ‰ç›‘å¬è€…
>
>       return true;
>
>     }
>
>   });
>
>   function track(prop) {
>
>     const currentComponent = getCurrentComponent();
>
>     if (currentComponent) {
>
>       let listenersForProp = listeners.get(prop);
>
>       if (!listenersForProp) {
>
>         listenersForProp = new Set();
>
>         listeners.set(prop, listenersForProp);
>
>       }
>
>       listenersForProp.add(currentComponent.listener);
>
>     }
>
>   }
>
>   function trigger(prop) {
>
>     const listenersForProp = listeners.get(prop);
>
>     if (listenersForProp) {
>
>       listenersForProp.forEach(listener => listener.forceUpdate());
>
>     }
>
>   }
>
>   return { state };
>
> }
>
> ```
>
> ç„¶åŽï¼Œç»„ä»¶åœ¨useStoreä¸­ä¼šåšçš„æ˜¯ï¼š
>
> ```javascript
>
> function useStore() {
>
>   const [, forceUpdate] = useState({});
>
>   const listener = useRef({ forceUpdate: () => forceUpdate({}) });
>
>   useEffect(() => {
>
>     return () => {
>
>       // åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œä»Žæ‰€æœ‰çš„å±žæ€§ç›‘å¬åˆ—è¡¨ä¸­ç§»é™¤è¯¥listener
>
>       listeners.forEach(listenerSet => {
>
>         listenerSet.delete(listener.current);
>
>       });
>
>     };
>
>   }, []);
>
>   setCurrentComponent({ listener: listener.current });
>
>   const state = store.state;
>
>   resetCurrentComponent();
>
>   return state;
>
> }
```
>
> è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç»„ä»¶åœ¨è®¿é—®å±žæ€§æ—¶ï¼Œä¼šå°†æ­¤ç»„ä»¶å¯¹åº”çš„listeneræ·»åŠ åˆ°è¯¥å±žæ€§çš„ç›‘å¬åˆ—è¡¨ä¸­ã€‚å½“æŸä¸ªå±žæ€§å˜åŒ–æ—¶ï¼Œä»…è§¦å‘ç›‘å¬è¯¥å±žæ€§ç»„çš„listenerã€‚è¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ï¼Œé¿å…éåŽ†æ‰€æœ‰è®¢é˜…è€…ã€‚å½“ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œå¦‚è®¿é—®countå’Œtextï¼Œå®ƒä»¬çš„listenerä¼šåˆ†åˆ«æ³¨å†Œåˆ°countå’Œtextå¯¹åº”çš„ç›‘å¬åˆ—è¡¨ä¸­ï¼Œè€Œæ¯æ¬¡çŠ¶æ€å˜æ›´åªéœ€é€šçŸ¥å¯¹åº”çš„ç»„ä»¶ã€‚
>
> å¦å¤–ï¼Œç»„ä»¶çš„å¸è½½éœ€è¦ä»Žæ‰€æœ‰å±žæ€§çš„ç›‘å¬åˆ—è¡¨ä¸­ç§»é™¤å®ƒçš„listenerï¼Œè€ƒè™‘åˆ°è®¢é˜…å¯èƒ½æ´’æ»¡å¤šä¸ªå±žæ€§ï¼Œè¿™åœ¨Effectæ¸…ç†ä¸­å¯èƒ½æ¯”è¾ƒå¤æ‚ã€‚ä¾‹å¦‚ï¼Œéœ€è¦éåŽ†æ‰€æœ‰å±žæ€§ï¼Œæ£€æŸ¥å®ƒä»¬çš„ç›‘å¬åˆ—è¡¨æ˜¯å¦åŒ…å«è¯¥listenerå¹¶åˆ é™¤ã€‚æˆ–è€…ï¼Œå¯ä»¥åœ¨æ¯ä¸ªlistenerè‡ªèº«ç»´æŠ¤ä¸€ä¸ªå®ƒå·²ç»è®¢é˜…çš„å±žæ€§åˆ—è¡¨ï¼Œå¸è½½æ—¶éåŽ†è¯¥åˆ—è¡¨è¿›è¡Œåˆ é™¤ã€‚è¿™å¯èƒ½éœ€è¦æ›´å¤æ‚çš„æ•°æ®ç»“æž„ã€‚
>
> æˆ–è€…ï¼Œåœ¨trackå‡½æ•°ä¸­ï¼Œè®°å½•æ¯ä¸ªlistenerè®¢é˜…çš„å±žæ€§ï¼Œç„¶åŽåœ¨listenerè¢«ç§»é™¤æ—¶ï¼ˆä¾‹å¦‚ç»„ä»¶å¸è½½ï¼‰ï¼Œä»Žå¯¹åº”çš„å±žæ€§ç›‘å¬åˆ—è¡¨ä¸­åˆ é™¤è¯¥listenerã€‚ä¾‹å¦‚ï¼š
>
> ```javascript
>
> const listenerSubscriptions = new Map(); // keyæ˜¯listenerï¼Œvalueæ˜¯Set(
