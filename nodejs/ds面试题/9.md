> ğŸ’­ å¥½ï¼Œç”¨æˆ·ç°åœ¨æƒ³äº†è§£ä¸‰ç§å¼‚æ­¥é”™è¯¯å¤„ç†æ¨¡å¼çš„å¯¹æ¯”ï¼šå›è°ƒå‡½æ•°ã€Promiseå’Œasync/awaitã€‚è¿™éœ€è¦åˆ†åˆ«è®¨è®ºæ¯ç§æ–¹å¼çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¼˜ç¼ºç‚¹ä»¥åŠé€‚ç”¨åœºæ™¯ã€‚
>
> é¦–å…ˆï¼Œå›è°ƒå‡½æ•°æ˜¯æ—©æœŸçš„å¼‚æ­¥å¤„ç†æ–¹æ³•ï¼Œå°¤å…¶åœ¨Node.jsä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚å›è°ƒçš„é”™è¯¯å¤„ç†é€šå¸¸éµå¾ªâ€œé”™è¯¯ä¼˜å…ˆâ€æ¨¡å¼ï¼Œå³å›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”™è¯¯å¯¹è±¡ï¼Œä¹‹åæ‰æ˜¯ç»“æœæ•°æ®ã€‚è¿™ç§æ¨¡å¼çš„ä¼˜ç‚¹åœ¨äºç›´è§‚ï¼Œä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®¹æ˜“å¯¼è‡´å›è°ƒåœ°ç‹±ï¼Œä»£ç å¯è¯»æ€§å·®ï¼Œé”™è¯¯å¤„ç†éœ€è¦æ¯ä¸ªå›è°ƒä¸­éƒ½å†™ä¸€éï¼Œå®¹æ˜“é—æ¼ã€‚
>
> æ¥ç€æ˜¯Promiseï¼Œå®ƒå¼•å…¥äº†é“¾å¼è°ƒç”¨ï¼Œé€šè¿‡.catch()æ¥æ•è·é”™è¯¯ï¼Œæˆ–è€…åœ¨.then()ä¸­å¤„ç†é”™è¯¯ã€‚è¿™ç§æ–¹å¼è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä½†è¦æ³¨æ„å¦‚æœåœ¨é“¾ä¸­é—æ¼äº†catchï¼Œå…¨å±€çš„æœªæ•è·é”™è¯¯å¤„ç†å°±ä¼šè¢«è§¦å‘ã€‚Promiseçš„é”™è¯¯å¤„ç†æ›´åŠ é›†ä¸­ï¼Œå¯ä»¥åœ¨é“¾çš„æœ«å°¾ç»Ÿä¸€å¤„ç†é”™è¯¯ï¼Œä½†æ¯ä¸ªthenä¸­çš„é”™è¯¯å¤„ç†æ–¹å¼éœ€è¦å¼€å‘è€…ä»”ç»†è®¾è®¡ï¼Œå¦åˆ™å¯èƒ½è·³è¿‡æŸäº›é”™è¯¯ã€‚
>
> ç„¶åæ˜¯async/awaitï¼ŒåŸºäºPromiseçš„è¯­æ³•ç³–ï¼Œå…è®¸ç”¨åŒæ­¥çš„æ–¹å¼å†™å¼‚æ­¥ä»£ç ã€‚é”™è¯¯å¤„ç†é€šè¿‡try/catchå—æ¥å®ç°ï¼Œç±»ä¼¼äºåŒæ­¥ä»£ç ä¸­çš„å¼‚å¸¸å¤„ç†ã€‚è¿™ç§æ–¹å¼ä»£ç æ›´æ¸…æ™°ï¼Œé”™è¯¯å¤„ç†æ›´é›†ä¸­ï¼Œä½†éœ€è¦æ³¨æ„åœ¨å¾ªç¯æˆ–å¹¶å‘æ“ä½œä¸­çš„é”™è¯¯æ•è·ï¼Œå¯èƒ½éœ€è¦ç»“åˆPromise.allç­‰æ–¹æ³•æ¥å¤„ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚
>
> å¯¹æ¯”è¿™ä¸‰ç§æ–¹å¼ï¼Œå›è°ƒå‡½æ•°çš„é”™è¯¯å¤„ç†éœ€è¦åœ¨æ¯ä¸ªå±‚çº§æ‰‹åŠ¨æ£€æŸ¥ï¼Œä»£ç å†—é•¿æ˜“é”™ï¼›Promiseé€šè¿‡é“¾å¼è°ƒç”¨å’Œcatchæ–¹æ³•ç®€åŒ–äº†é”™è¯¯å¤„ç†ï¼Œä½†ä¾ç„¶éœ€è¦æ­£ç¡®çš„é“¾å¼ç®¡ç†ï¼›è€Œasync/awaitåˆ©ç”¨try/catchä½¿å¾—é”™è¯¯å¤„ç†æ›´ç›´è§‚ï¼ŒåŒæ—¶èƒ½ä¸åŒæ­¥ä»£ç çš„é£æ ¼ç»Ÿä¸€ï¼Œä½†å¦‚æœåœ¨awaitè¡¨è¾¾å¼å¤–å¿˜è®°åŒ…è£¹try/catchï¼Œå¯èƒ½ä¼šå¯¼è‡´æœªå¤„ç†çš„Promiseæ‹’ç»ã€‚
>
> è¿˜è¦è€ƒè™‘å…¼å®¹æ€§å’Œç°ä»£å¼€å‘ç¯å¢ƒçš„æ”¯æŒã€‚å›è°ƒå‡½æ•°é€‚ç”¨äºæ‰€æœ‰ç¯å¢ƒï¼Œä½†ç°ä»£é¡¹ç›®æ›´å€¾å‘äºä½¿ç”¨Promiseå’Œasync/awaitã€‚æ­¤å¤–ï¼ŒNode.jsä¸­å¯ä»¥é€šè¿‡process.on('unhandledRejection')æ¥æ•è·æœªå¤„ç†çš„Promiseé”™è¯¯ï¼Œè€Œæµè§ˆå™¨ç¯å¢ƒä¹Ÿæœ‰ç±»ä¼¼çš„æœºåˆ¶ã€‚
>
> å¯èƒ½è¿˜éœ€è¦è®¨è®ºé”™è¯¯ä¼ é€’çš„æœºåˆ¶ï¼Œä¾‹å¦‚åœ¨Promiseé“¾ä¸­é”™è¯¯å¦‚ä½•å†’æ³¡åˆ°æœ€è¿‘çš„catchï¼Œè€Œasync/awaitä¸­é”™è¯¯ä¼šè¢«æœ€è¿‘çš„try/catchæ•è·ã€‚æ­¤å¤–ï¼Œä½¿ç”¨asyncå‡½æ•°æ—¶ï¼Œå³ä½¿æ²¡æœ‰æ˜¾å¼çš„try/catchï¼Œè¢«æ‹’ç»çš„Promiseä¼šè¢«è½¬æ¢ä¸ºæœªå¤„ç†çš„æ‹’ç»ï¼Œå› æ­¤éœ€è¦é€‚å½“çš„å…¨å±€é”™è¯¯å¤„ç†ã€‚
>
> æœ€åï¼Œæ€»ç»“æ—¶å¯èƒ½éœ€è¦æ¯”è¾ƒå„æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼ŒæŒ‡å¯¼ç”¨æˆ·åœ¨ä¸åŒåœºæ™¯ä¸‹é€‰æ‹©åˆé€‚çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œç»´æŠ¤é—ç•™ä»£ç æ—¶å¯èƒ½ç”¨å›è°ƒï¼Œæ–°é¡¹ç›®é¦–é€‰async/awaitï¼Œè€ŒPromiseé€‚ç”¨äºéœ€è¦é“¾å¼è°ƒç”¨çš„ä¸­é—´æƒ…å†µã€‚åŒæ—¶ï¼Œé”™è¯¯å¤„ç†çš„å…¨é¢æ€§ã€ä»£ç å¯ç»´æŠ¤æ€§å’Œå¼€å‘ä¾¿æ·æ€§æ˜¯å…³é”®è€ƒé‡å› ç´ ã€‚
>
> 



---

å¤„ç†å¼‚æ­¥é”™è¯¯æ˜¯ JavaScript å¼€å‘çš„æ ¸å¿ƒæŒ‘æˆ˜ä¹‹ä¸€ã€‚ä¸åŒçš„å¼‚æ­¥æ¨¡å¼ï¼ˆå›è°ƒå‡½æ•°ã€Promiseã€async/awaitï¼‰åœ¨é”™è¯¯å¤„ç†ä¸Šæœ‰æ˜¾è‘—å·®å¼‚ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„å®ç°æ–¹å¼å’Œé€‚ç”¨åœºæ™¯å¯¹æ¯”ï¼š

---

### **ä¸€ã€å›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰**
#### **ğŸ‘‰ æ ¸å¿ƒæœºåˆ¶**
é€šè¿‡ **é”™è¯¯ä¼˜å…ˆï¼ˆError-First Callbackï¼‰** ä¼ é€’é”™è¯¯ä¸ç»“æœï¼š
```javascript
function asyncTask(callback) {
  fs.readFile('file.txt', (err, data) => {
    if (err) {
      callback(err); // é”™è¯¯ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’
      return;
    }
    callback(null, data); // æˆåŠŸæ—¶è¿”å› null ä½œä¸ºé”™è¯¯å ä½ç¬¦
  });
}

// ä½¿ç”¨
asyncTask((err, result) => {
  if (err) {
    console.error('Error:', err);
    return;
  }
  console.log('Result:', result);
});
```

#### **â— ç—›ç‚¹**
1. **å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰**ï¼šå¤šçº§åµŒå¥—å¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤ã€‚
2. **é”™è¯¯å¤„ç†é‡å¤**ï¼šæ¯ä¸ªå›è°ƒå¿…é¡»æ‰‹åŠ¨æ£€æŸ¥ `err`ã€‚
3. **æ— æ³•ç»Ÿä¸€æ•è·**ï¼šæœªå¤„ç†çš„é”™è¯¯å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ— å“åº”ã€‚

---

### **äºŒã€Promise**
#### **ğŸ‘‰ æ ¸å¿ƒæœºåˆ¶**
é€šè¿‡ `.then()` æ¥æ”¶ç»“æœã€`.catch()` æ•è·é“¾å¼è°ƒç”¨ä¸­çš„é”™è¯¯ï¼š
```javascript
function asyncTask() {
  return new Promise((resolve, reject) => {
    fs.readFile('file.txt', (err, data) => {
      if (err) {
        reject(err); // é”™è¯¯ä¼ é€’åˆ° catch
      } else {
        resolve(data);
      }
    });
  });
}

// ä½¿ç”¨ï¼ˆé“¾å¼è°ƒç”¨ï¼‰
asyncTask()
  .then(data => processData(data)) 
  .then(finalData => saveData(finalData))
  .catch(err => {
    console.error('Promise Chain Error:', err);
  });
```

#### **âœ¨ ä¼˜ç‚¹**
1. **é“¾å¼è°ƒç”¨**ï¼Œé¿å…å›è°ƒåµŒå¥—ã€‚
2. **ç»Ÿä¸€é”™è¯¯å¤„ç†**ï¼š`.catch()` å¯ä»¥é›†ä¸­æ•è·é“¾ä¸­ä»»æ„ä½ç½®çš„é”™è¯¯ã€‚
3. **Promise.all/any** æ”¯æŒæ‰¹é‡å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚

#### **âš ï¸ æ³¨æ„äº‹é¡¹**
- `catch` éœ€æ”¾ç½®åœ¨è°ƒç”¨é“¾æœ«å°¾ï¼Œå¦åˆ™åç»­ `.then()` çš„æœªè¢«æ•è·é”™è¯¯å¯èƒ½å¯¼è‡´é™é»˜æ•…éšœã€‚
- æœªå¤„ç†çš„ Promise æ‹’ç»ï¼ˆunhandledRejectionï¼‰å¯èƒ½å¯¼è‡´ç¨‹åºç»ˆæ­¢ï¼ˆNode.jsé»˜è®¤è¡Œä¸ºï¼‰ã€‚

---

### **ä¸‰ã€async/await**
#### **ğŸ‘‰ æ ¸å¿ƒæœºåˆ¶**
é€šè¿‡ `try/catch` æ•è·å¼‚æ­¥æ“ä½œé”™è¯¯ï¼Œè¯­æ³•æ¥è¿‘åŒæ­¥ä»£ç é€»è¾‘ï¼š
```javascript
async function handleData() {
  try {
    const data = await asyncTask(); // ç­‰å¾… Promise ç»“æœ
    const processed = await processData(data);
    await saveData(processed);
  } catch (err) {
    console.error('Async/Await Error:', err);
  }
}

handleData();
```

#### **âœ¨ ä¼˜ç‚¹**
1. **ä»£ç æ‰å¹³åŒ–**ï¼šå½»åº•è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ã€‚
2. **é”™è¯¯é›†ä¸­å¤„ç†**ï¼šä¸€ä¸ª `try/catch` å¯è¦†ç›–å¤šä¸ª `await` æ“ä½œã€‚
3. **ç›´è§‚æ€§**ï¼šé”™è¯¯å¤„ç†é€»è¾‘è´´è¿‘åŒæ­¥ä»£ç æ€ç»´ã€‚

#### **âš ï¸ æ³¨æ„äº‹é¡¹**
- å¿˜è®°åŒ…è£¹ `try/catch` ä¼šå¯¼è‡´æœªå¤„ç†çš„ Promise æ‹’ç»ã€‚
- å¹¶è¡Œè¯·æ±‚éœ€é…åˆ `Promise.all()` é¿å…ä¸²è¡Œç­‰å¾…ï¼š
  ```javascript
  async function parallelTasks() {
    try {
      const [a, b] = await Promise.all([taskA(), taskB()]);
    } catch (err) {
      // ä»»æ„ä»»åŠ¡å¤±è´¥å‡ä¼šè§¦å‘
    }
  }
  ```

---

### **å››ã€æ¨ªå‘å¯¹æ¯”**

| ç‰¹æ€§                | å›è°ƒå‡½æ•°                  | Promise                     | async/await                |
|---------------------|-------------------------|-----------------------------|----------------------------|
| **ä»£ç ç»“æ„**         | åµŒå¥—å±‚çº§æ·±             | é“¾å¼ç»“æ„                  | åŒæ­¥é£æ ¼ï¼Œæ‰å¹³åŒ–          |
| **é”™è¯¯å¤„ç†éš¾åº¦**     | é«˜ï¼ˆéœ€é€å±‚æ£€æŸ¥ï¼‰       | ä¸­ï¼ˆéœ€ç»´æŠ¤è°ƒç”¨é“¾ï¼‰        | ä½ï¼ˆç±»ä¼¼åŒæ­¥ä»£ç ï¼‰        |
| **é”™è¯¯å†’æ³¡**         | éœ€æ‰‹åŠ¨ä¼ æ’­é”™è¯¯         | è‡ªåŠ¨å†’æ³¡åˆ°æœ€è¿‘çš„ `.catch` | è‡ªåŠ¨å†’æ³¡åˆ°æœ€è¿‘çš„ `catch`  |
| **æµè§ˆå™¨å…¼å®¹æ€§**     | å…¨æ”¯æŒ                 | ES6+ (polyfill å…¼å®¹)       | ES2017+ (éœ€è¦è½¬è¯‘)         |
| **å…¨å±€é”™è¯¯æ•è·**     | æ— æ³•æ‰¹é‡æ•è·           | é€šè¿‡ `unhandledrejection` äº‹ä»¶ | åŒ Promise               |
| **é€‚ç”¨åœºæ™¯**         | ä¼ ç»Ÿ Node.js åº“å›è°ƒ    | ç°ä»£ APIã€é“¾å¼é€»è¾‘         | å¤æ‚ä¸šåŠ¡é€»è¾‘ã€æ–°é¡¹ç›®      |

---

### **äº”ã€æœ€ä½³å®è·µ**
#### **1. ä¼˜å…ˆ async/await**
å¤„ç†å¤æ‚å¼‚æ­¥é€»è¾‘å’Œé”™è¯¯é“¾è·¯æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ `async/await` æå‡ä»£ç å¯è¯»æ€§ï¼š
```javascript
// âœ… é¿å…åµŒå¥—
async function fetchUserData(userId) {
  try {
    const user = await getUser(userId); 
    const orders = await getOrders(user.id);
    return { user, orders };
  } catch (err) {
    logErrorToService(err); 
    throw new CustomError('Fetch failed', { cause: err });
  }
}
```

#### **2. å–„ç”¨å…¨å±€é”™è¯¯æ•è·**
è¡¥å……å…œåº•é”™è¯¯å¤„ç†æœºåˆ¶ï¼ˆå¦‚å´©æºƒå‰æ—¥å¿—ä¸ŠæŠ¥ï¼‰ï¼š
```javascript
// Node.js ç¯å¢ƒ
process.on('unhandledRejection', (reason, promise) => {
  console.error('Unhandled Rejection at:', promise, 'Reason:', reason);
});

// æµè§ˆå™¨ç¯å¢ƒ
window.addEventListener('unhandledrejection', (event) => {
  event.preventDefault();
  console.error('Unhandled rejection:', event.reason);
});
```

#### **3. å°è£…é”™è¯¯è¾¹ç•Œ**
æ¡†æ¶ä¸­å¯ä½¿ç”¨ç»Ÿä¸€é”™è¯¯æ‹¦æˆªï¼ˆå¦‚ React Error Boundaryã€Express ä¸­é—´ä»¶ï¼‰ï¼š
```javascript
// Express ç»Ÿä¸€é”™è¯¯ä¸­é—´ä»¶
app.use(async (err, req, res, next) => {
  if (err instanceof CustomError) {
    res.status(500).json({ error: err.message });
  } else {
    res.status(500).send('Unknown error');
  }
  await sendErrorToMonitoring(err); // ä¸ŠæŠ¥åˆ°ç›‘æ§å¹³å°
});
```

---

### **æ€»ç»“**
- **å›è°ƒå‡½æ•°**é€‚ç”¨äºé—ç•™ä»£ç æˆ–åº•å±‚åº“å¼€å‘ã€‚
- **Promise**é€‚åˆç®€å•çš„é“¾å¼å¼‚æ­¥é€»è¾‘ã€‚
- **async/await**æ˜¯å¤æ‚ä¸šåŠ¡é€»è¾‘çš„æœ€ä½³é€‰æ‹©ï¼Œé…åˆ `try/catch` å®ç°æ¸…æ™°é”™è¯¯å¤„ç†ã€‚
- **å…œåº•æœºåˆ¶ï¼ˆå…¨å±€é”™è¯¯ç›‘å¬ï¼‰** é¡»å§‹ç»ˆä½œä¸ºæœ€åä¸€é“é˜²çº¿ã€‚
