### **什么是 AABB（轴对齐包围盒）？**

**AABB** 是 **Axis-Aligned Bounding Box** 的缩写，中文称为 **轴对齐包围盒**。它是计算机图形学中常用的一种简单的几何包围体，用于描述一个物体在二维或三维空间中的最小矩形（2D）或立方体（3D）。

---

### **1. AABB 的特点**

1. **轴对齐**：
   - AABB 的边始终与坐标轴对齐（即矩形的边平行于 X 和 Y 轴，立方体的边平行于 X、Y 和 Z 轴）。
   - 这使得 AABB 的计算和碰撞检测非常高效。

2. **最小包围**：
   - AABB 是能够完全包围目标物体的最小矩形（或立方体）。

3. **简单高效**：
   - 由于 AABB 的边与坐标轴对齐，计算其范围（宽度、高度、深度）非常简单，适合快速碰撞检测和几何计算。

---

### **2. 为什么需要计算 AABB？**

在图形学中，物体可能会被旋转、缩放或移动。旋转后的物体可能不再与坐标轴对齐，因此需要计算其旋转后的 AABB，以便：
1. **确定物体的占用空间**：
   - 计算物体在画布或工作区中的范围。
2. **碰撞检测**：
   - 用于快速判断两个物体是否可能发生碰撞。
3. **纹理适配**：
   - 在这段代码中，AABB 被用来计算纹理图片的缩放比例，使纹理能够完全覆盖原始图片。

---

### **3. AABB 的计算原理**

#### **3.1 旋转后的物体**
当一个矩形（或其他形状）被旋转时，其边可能不再与坐标轴对齐。此时，物体的实际占用空间是一个 **旋转后的矩形**。

#### **3.2 AABB 的定义**
AABB 是能够完全包围旋转后物体的最小矩形，其边与坐标轴对齐。

#### **3.3 如何计算 AABB？**
1. **获取物体的顶点坐标**：
   - 计算物体的四个顶点（左上角、右上角、左下角、右下角）的坐标。
2. **旋转顶点**：
   - 根据物体的旋转角度，计算每个顶点旋转后的坐标。
3. **计算 AABB 的范围**：
   - 找到旋转后顶点的最小和最大 X 坐标（`minX` 和 `maxX`）。
   - 找到旋转后顶点的最小和最大 Y 坐标（`minY` 和 `maxY`）。
   - AABB 的宽度和高度分别为：
     ```text
     width = maxX - minX
     height = maxY - minY
     ```

---

### **4. 为什么这样计算？**

#### **4.1 旋转后的物体不再与坐标轴对齐**
- 当物体被旋转时，其原始宽度和高度已经不能直接描述其占用空间。
- 需要通过计算旋转后的顶点坐标，找到物体的最小包围矩形。

#### **4.2 AABB 是最小的轴对齐矩形**
- AABB 是能够完全包围物体的最小矩形，计算简单且高效。
- 在纹理适配中，AABB 的宽度和高度可以用来计算纹理的缩放比例。

---

### **5. 示例：计算 AABB**

#### **5.1 示例场景**
假设有一个矩形，宽度为 `100`，高度为 `50`，其中心点在 `(0, 0)`，旋转角度为 `45°`。

#### **5.2 计算步骤**

1. **计算原始顶点坐标**：
   - 矩形的四个顶点相对于中心点的坐标为：
     ```text
     (-50, -25), (50, -25), (50, 25), (-50, 25)
     ```

2. **旋转顶点**：
   - 使用旋转公式：
     ```text
     x' = x * cos(θ) - y * sin(θ)
     y' = x * sin(θ) + y * cos(θ)
     ```
   - 计算每个顶点旋转后的坐标（`θ = 45°`）：
     ```text
     (-50, -25) -> (-17.68, -53.03)
     (50, -25)  -> (53.03, -17.68)
     (50, 25)   -> (17.68, 53.03)
     (-50, 25)  -> (-53.03, 17.68)
     ```

3. **计算 AABB 的范围**：
   - 找到旋转后顶点的最小和最大 X 坐标：
     ```text
     minX = -53.03, maxX = 53.03
     ```
   - 找到旋转后顶点的最小和最大 Y 坐标：
     ```text
     minY = -53.03, maxY = 53.03
     ```
   - AABB 的宽度和高度为：
     ```text
     width = maxX - minX = 53.03 - (-53.03) = 106.06
     height = maxY - minY = 53.03 - (-53.03) = 106.06
     ```

---

### **6. 在代码中的应用**

#### **代码片段**
```typescript
const { newWidth, newHeight } = getAABBSizeAfterRotation(originalImage);
const scaleX = newWidth / (imageElement.width * imageElement.scaleX);
const scaleY = newHeight / (imageElement.height * imageElement.scaleY);
const scale = Math.max(scaleX, scaleY);
```

#### **逻辑分析**
1. **调用 `getAABBSizeAfterRotation`**：
   - 计算原始图片旋转后的 AABB 的宽度（`newWidth`）和高度（`newHeight`）。

2. **计算纹理的缩放比例**：
   - 计算纹理在 X 轴和 Y 轴上的缩放比例：
     ```typescript
     scaleX = newWidth / (imageElement.width * imageElement.scaleX);
     scaleY = newHeight / (imageElement.height * imageElement.scaleY);
     ```
   - 取较大的缩放比例（`Math.max(scaleX, scaleY)`），确保纹理能够完全覆盖原始图片。

---

### **7. 总结**

1. **AABB 的作用**：
   - AABB 是旋转后物体的最小轴对齐包围矩形，用于描述物体的占用空间。
   - 在这段代码中，AABB 被用来计算纹理的缩放比例，使纹理能够完全覆盖原始图片。

2. **AABB 的计算**：
   - 通过旋转物体的顶点，找到旋转后顶点的最小和最大坐标，计算出 AABB 的宽度和高度。

3. **为什么需要 AABB**：
   - 旋转后的物体不再与坐标轴对齐，原始宽度和高度无法描述其占用空间。
   - AABB 提供了一种简单高效的方式来计算物体的范围。

通过这种方式，代码能够确保纹理图片与原始图片的尺寸和位置完全匹配。
