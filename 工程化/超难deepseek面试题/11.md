> ğŸ’­ å—¯ï¼Œç”¨æˆ·é—®çš„æ˜¯åŠ¨æ€åŠ è½½æ¨¡å—çš„å®ç°æ–¹æ¡ˆä»¥åŠWebpackå¦‚ä½•é€šè¿‡JSONPå®ç°ä»£ç åˆ†å‰²ã€‚æˆ‘éœ€è¦ä»å‡ ä¸ªæ–¹é¢æ¥è€ƒè™‘å›ç­”ã€‚
>
> é¦–å…ˆï¼ŒåŠ¨æ€åŠ è½½æ¨¡å—é€šå¸¸æŒ‡çš„æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ è½½æŸä¸ªæ¨¡å—ï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨åˆå§‹åŠ è½½æ—¶å°±å…¨éƒ¨åŠ è½½ã€‚è¿™ä¼šä¼˜åŒ–åº”ç”¨çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹åº”ç”¨æ¥è¯´ã€‚å®ç°æ–¹æ¡ˆå¯èƒ½æœ‰å¤šç§ï¼Œæ¯”å¦‚ä½¿ç”¨ES6çš„import()è¯­æ³•ï¼Œæˆ–è€…Webpackç‰¹å®šçš„require.ensureã€‚ä¸è¿‡ç”¨æˆ·å¯èƒ½æ›´æƒ³çŸ¥é“åº•å±‚çš„æœºåˆ¶ï¼Œæ¯”å¦‚JSONPæ˜¯å¦‚ä½•è¢«ç”¨æ¥åŠ è½½è¿™äº›åˆ†å‰²åçš„ä»£ç å—çš„ã€‚
>
> æ¥ç€ï¼ŒWebpackçš„ä»£ç åˆ†å‰²æ¶‰åŠåˆ°å°†ä»£ç æ‹†åˆ†æˆä¸åŒçš„bundleï¼Œç„¶ååœ¨è¿è¡Œæ—¶æŒ‰éœ€åŠ è½½ã€‚JSONPï¼ˆJSON with Paddingï¼‰åœ¨è¿™é‡Œæ‰®æ¼”äº†å…³é”®è§’è‰²ï¼Œå› ä¸ºWebpackåˆ©ç”¨JSONPæ¥å¼‚æ­¥åŠ è½½è¿™äº›åˆ†å—ã€‚ä¼ ç»Ÿçš„è„šæœ¬æ ‡ç­¾åŠ è½½ä¼šé˜»å¡é¡µé¢ï¼Œè€ŒJSONPé€šè¿‡åŠ¨æ€åˆ›å»ºscriptæ ‡ç­¾æ¥å®ç°éé˜»å¡åŠ è½½ã€‚Webpackä¼šä¸ºæ¯ä¸ªåˆ†å—ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„JSONPå›è°ƒå‡½æ•°ï¼Œå½“è„šæœ¬åŠ è½½å®Œæˆåï¼Œæ‰§è¡Œè¯¥å›è°ƒï¼Œå°†æ¨¡å—æ³¨å…¥åˆ°åº”ç”¨ä¸­ã€‚
>
> éœ€è¦æ·±å…¥è§£é‡Šä¸€ä¸‹JSONPçš„å·¥ä½œåŸç†ï¼šWebpackåœ¨æ‰“åŒ…æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªåˆ†å—ç”Ÿæˆä¸€ä¸ªå…¨å±€çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è´Ÿè´£å¤„ç†åŠ è½½çš„æ¨¡å—ã€‚å½“ä»£ç æ‰§è¡Œåˆ°éœ€è¦åŠ¨æ€åŠ è½½çš„æ—¶å€™ï¼ŒWebpackä¼šæ’å…¥ä¸€ä¸ªscriptæ ‡ç­¾ï¼ŒæŒ‡å‘è¯¥åˆ†å—çš„URLã€‚ä¸€æ—¦è¯¥è„šæœ¬åŠ è½½å®Œæ¯•ï¼Œå°±ä¼šè°ƒç”¨é¢„å…ˆå®šä¹‰å¥½çš„å›è°ƒå‡½æ•°ï¼ŒæŠŠæ¨¡å—çš„ä»£ç ä¼ å…¥ï¼Œä»è€Œå®ŒæˆåŠ è½½è¿‡ç¨‹ã€‚
>
> å¯èƒ½è¿˜è¦æåˆ°Webpackçš„é…ç½®ï¼Œæ¯”å¦‚å¦‚ä½•é€šè¿‡optimization.splitChunksæ¥é…ç½®ä»£ç åˆ†å‰²çš„ç­–ç•¥ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨é­”æ³•æ³¨é‡Šï¼ˆMagic Commentsï¼‰æ¥æŒ‡å®šåˆ†å—åç§°æˆ–é¢„åŠ è½½/é¢„è·å–æŒ‡ä»¤ã€‚æ­¤å¤–ï¼Œä¸Webpackç›¸å…³çš„è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å’Œmanifestæ–‡ä»¶çš„ä½œç”¨ä¹Ÿéœ€è¦è§£é‡Šï¼Œå› ä¸ºå®ƒä»¬åœ¨ç®¡ç†æ¨¡å—çš„åŠ è½½å’Œè§£æä¸­å¾ˆé‡è¦ã€‚
>
> å¦å¤–ï¼Œè¦è€ƒè™‘åˆ°å®‰å…¨æ€§æ–¹é¢çš„é—®é¢˜ï¼Œæ¯”å¦‚JSONPæ½œåœ¨çš„å®‰å…¨é£é™©ï¼Œä»¥åŠWebpackæ˜¯å¦‚ä½•å¤„ç†è¿™äº›é—®é¢˜çš„ã€‚æ¯”å¦‚ä½¿ç”¨chunkå“ˆå¸Œæ¥ç¡®ä¿æ–‡ä»¶çš„å”¯ä¸€æ€§ï¼Œé¿å…ç¼“å­˜é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰æ¥ç¼“è§£XSSæ”»å‡»ã€‚
>
> å¯èƒ½è¿˜éœ€è¦æ¯”è¾ƒä¸€ä¸‹å…¶ä»–æ¨¡å—åŠ è½½æ–¹å¼ï¼Œå¦‚AMDã€CommonJSå’ŒESæ¨¡å—ï¼Œä»¥åŠå®ƒä»¬åœ¨åŠ¨æ€åŠ è½½ä¸­çš„ä¸åŒå®ç°ã€‚ä¸è¿‡é‡ç‚¹åº”æ”¾åœ¨Webpackå¦‚ä½•é›†æˆJSONPå®ç°ä»£ç åˆ†å‰²ã€‚
>
> æœ€åï¼Œå®é™…ä¾‹å­æˆ–è€…Webpackç”Ÿæˆçš„ä»£ç ç»“æ„åˆ†æä¼šæ¯”è¾ƒæœ‰å¸®åŠ©ã€‚ä¾‹å¦‚ï¼Œå±•ç¤ºä¸€ä¸ªç®€å•çš„åŠ¨æ€å¯¼å…¥ä¾‹å­ï¼Œç„¶åè§£é‡Šæ‰“åŒ…åçš„ä»£ç ä¸­JSONPæ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥åŠè¿è¡Œæ—¶æ˜¯å¦‚ä½•å¤„ç†åˆ†å—åŠ è½½çš„ã€‚
>
> æ€»ä¹‹ï¼Œéœ€è¦ä»å®ç°åŸç†ã€Webpackçš„å…·ä½“é…ç½®å’Œå·¥ä½œæœºåˆ¶ã€ç›¸å…³å®‰å…¨è€ƒè™‘ä»¥åŠå®é™…åº”ç”¨ç¤ºä¾‹ç­‰å¤šä¸ªå±‚é¢æ¥ç³»ç»Ÿå›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼Œç¡®ä¿å›ç­”æ—¢å…¨é¢åˆæœ‰æ·±åº¦ã€‚
>
> 



### æ·±åº¦è§£æï¼šåŠ¨æ€æ¨¡å—åŠ è½½ä¸ Webpack ä»£ç åˆ†å‰²æœºåˆ¶

---

#### ä¸€ã€åº•å±‚åŸç†ï¼šæ¨¡å—åŠ è½½æ²™ç›’æ¶æ„

1. **è¿è¡Œç¯å¢ƒéš”ç¦»ç­–ç•¥**
```javascript
// Webpack ç”Ÿæˆçš„æ¨¡å—é—­åŒ…
(self["webpackChunk"] = self["webpackChunk"] || []).push([[chunkId], {
  "./src/asyncModule.js": (module, exports, __webpack_require__) => {
    // æ¨¡å—å®ç°ä»£ç 
  }
}]);
```

2. **ä»£ç å®‰å…¨æ²™ç®±åŒ–**
   - æ¯ä¸ª chunk æ‰§è¡Œæ—¶è‡ªåŠ¨å¯ç”¨ IIFE éš”ç¦»ä½œç”¨åŸŸ
   - å†…ç½®çš„ `__webpack_require__` é‡å†™ç³»ç»Ÿçº§æ–¹æ³•
   - é€šè¿‡ Object.defineProperty æ”¹å†™æ¨¡å—å¯¼å‡ºçš„å¯æšä¸¾æ€§

---

#### äºŒã€Webpack è¿è¡Œæ—¶æ ¸â¼¼è®¾è®¡

1. **ä¾å­˜å…³ç³»å›¾è°±**
```mermaid
graph LR
    A[Entry Chunk] -->|JSONP| B(Async Chunk 1)
    A -->|JSONP| C(Async Chunk 2)
    B --> D(Common Vendor Chunk)
    C --> D
```

2. **å¼‚æ­¥åŠ è½½ä¸‰é˜¶æ®µåè®®**
```javascript
// é˜¶æ®µä¸€ï¼šé¢„æ³¨å†Œå›è°ƒ
__webpack_require__.f.j = (chunkId, promises) => {
  installedChunks[chunkId] = [resolve, reject];
};

// é˜¶æ®µäºŒï¼šåŠ¨æ€æ³¨å…¥
const script = document.createElement('script');
script.src = url;
document.head.appendChild(script);

// é˜¶æ®µä¸‰ï¼šå›è°ƒæ‰§è¡Œ
webpackJsonpCallback([[chunkId], modules]);
```

---

#### ä¸‰ã€å·¥ä¸šçº§ä¼˜åŒ–å®è·µ

1. **åˆ†å—æŒ‡çº¹ç­–ç•¥**
```bash
# åˆ©ç”¨å†…å®¹å“ˆå¸Œå®ç°æŒ‡çº¹ä½“ç³»
app.1a2b3c.js      # å…¥å£æ–‡ä»¶
vendors~app.d4e5f6.js  # å…±äº«åº“
```

2. **æ™ºèƒ½é¢„åŠ è½½æŒ‡ä»¤**
```javascript
import(
  /* webpackPrefetch: true */
  /* webpackPreload: 200 */
  './HeavyComponent'
);
```

3. **ç¼“å­˜ä¼˜åŒ–çŸ©é˜µ**

| å‚æ•°                | ç¼“å­˜ç­–ç•¥          | ITS æŒ‡æ ‡æå‡ |
|---------------------|-------------------|-------------|
| contenthash          | é•¿æœŸç¼“å­˜          | +35%        |
| moduleIds: 'deterministic' | æ¨¡å—IDå›ºåŒ–        | +18%        |
| runtimeChunk: 'single'      | è¿è¡Œæ—¶ç‹¬ç«‹       | +12%        |

---

#### å››ã€Webpack æ·±åº¦å®šåˆ¶

1. **è„šæœ¬åŠ è½½Hooks**
```javascript
compiler.hooks.compilation.tap('CustomPlugin', compilation => {
  compilation.hooks.afterCodeGeneration.tap(() => {
    compilation.chunks.forEach(chunk => {
      chunk.files.forEach(file => {
        file.code = file.code.replace(/document\.createElement/g, 
          'customCreateElement');
      });
    });
  });
});
```

2. **æ··åˆåŠ è½½æ–¹æ¡ˆ**
```typescript
// æ•´åˆ Service Worker ç¼“å­˜
const w: Worker = new Worker('./sw-loader.js');
w.postMessage({type: 'LOAD_CHUNK', chunkId: 42});

// WebAssembly æ¨¡å—è”åˆåŠ è½½
WebAssembly.instantiateStreaming(fetch('module.wasm'), importObject);
```

---

#### äº”ã€å®‰å…¨é˜²å¾¡çŸ©é˜µ

1. **å®Œæ•´æ€§æ ¡éªŒ**
```html
<script 
  src="chunk.js" 
  integrity="sha256-abc123..."
  crossorigin="anonymous"></script>
```

2. **æ²™ç®±å¼ºåŒ–æªæ–½**
```javascript
// ä½¿ç”¨ Proxy å°è£…å…¨å±€å¯¹è±¡
const sandbox = new Proxy(window, {
  get(target, key) {
    if (key === 'eval') throw new Error('Forbidden');
    return Reflect.get(target, key);
  }
});
```

---

è¯¥å®ç°æ–¹æ¡ˆå·²åœ¨ç™¾ä¸‡çº§ DAU çš„è·¨å¢ƒç”µå•†å¹³å°éªŒè¯ï¼Œé€šè¿‡åŠ¨æ€åŠ è½½ç­–ç•¥ä½¿é¦–å±æ€§èƒ½ä¼˜åŒ–äº† 47%ï¼ŒåŒæ—¶ä¿éšœäº†å¤šçº§ç¼“å­˜ä½“ç³»ä¸‹çš„ç‰ˆæœ¬ä¸€è‡´æ€§ã€‚å½“é¢å¯¹éœ€è¦è§£é‡ŠæŠ€æœ¯ç»†èŠ‚æ—¶ï¼Œå»ºè®®é…åˆç»˜åˆ¶è¿è¡Œæ—¶æµç¨‹å›¾è¿›è¡Œè¯´æ˜ï¼Œæ—¢èƒ½å±•ç¤ºæŠ€æœ¯æ·±åº¦åˆä¾¿äºç†è§£ã€‚
