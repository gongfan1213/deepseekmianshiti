> ğŸ’­ å—¯ï¼Œç”¨æˆ·ç°åœ¨é—®çš„æ˜¯webpackçš„å·¥ä½œæµç¨‹ã€‚æˆ‘å…ˆå›æƒ³ä¸€ä¸‹è‡ªå·±ä¹‹å‰å­¦è¿‡çš„webpackçŸ¥è¯†ã€‚Webpackæ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œä¸»è¦ç”¨æ¥å¤„ç†å‰ç«¯èµ„æºçš„ä¾èµ–å…³ç³»ï¼Œå°†å®ƒä»¬æ‰“åŒ…æˆé™æ€æ–‡ä»¶ã€‚é‚£ä¹ˆå®ƒçš„å·¥ä½œæµç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤å‘¢ï¼Ÿ
>
> é¦–å…ˆï¼Œç”¨æˆ·å¯èƒ½éœ€è¦äº†è§£webpackçš„æ•´ä½“æµç¨‹ï¼Œæ‰€ä»¥å¾—ä»å…¥å£æ–‡ä»¶å¼€å§‹è¯´èµ·ã€‚å…¥å£æ˜¯webpackå¼€å§‹æ„å»ºçš„èµ·ç‚¹ï¼Œç„¶åæ ¹æ®å¯¼å…¥çš„æ¨¡å—é€’å½’åœ°æ„å»ºä¾èµ–å›¾ã€‚æµç¨‹ä¸­æ¶‰åŠåˆ°çš„æ ¸å¿ƒæ­¥éª¤å¯èƒ½åŒ…æ‹¬è§£ææ¨¡å—ã€åŠ è½½å™¨å¤„ç†ã€æ’ä»¶å¹²é¢„ã€æ‰“åŒ…è¾“å‡ºç­‰ç­‰ã€‚é‚£æ˜¯ä¸æ˜¯åº”è¯¥æŒ‰ç…§æ­¥éª¤é¡ºåºæ¥è¯¦ç»†è§£é‡Šå‘¢ï¼Ÿ
>
> æ¥ç€è€ƒè™‘ç”¨æˆ·å¯èƒ½çš„èƒŒæ™¯ã€‚å¯èƒ½æ˜¯ä¸€ä¸ªåˆšæ¥è§¦webpackçš„å‰ç«¯å¼€å‘è€…ï¼Œæˆ–è€…æ˜¯å·²ç»ä½¿ç”¨è¿‡ä½†æƒ³æ›´æ·±å…¥äº†è§£å†…éƒ¨æœºåˆ¶çš„äººã€‚å¦‚æœæ˜¯å‰è€…ï¼Œéœ€è¦é¿å…è¿‡äºæ·±å…¥çš„æœ¯è¯­ï¼Œè€Œå¦‚æœæ˜¯åè€…åˆ™éœ€è¦æ›´è¯¦ç»†çš„è¿‡ç¨‹æè¿°ã€‚ç”¨æˆ·çš„é—®é¢˜æ¯”è¾ƒåŸºç¡€ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä¸€ä¸ªä»æµ…å…¥æ·±çš„è§£é‡Šï¼ŒåŒæ—¶å…¼é¡¾æ ¸å¿ƒæ¦‚å¿µã€‚
>
> ç”¨æˆ·å¯èƒ½æƒ³äº†è§£æ•´ä¸ªæµç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µï¼Œä¾‹å¦‚åˆå§‹åŒ–é…ç½®ã€è§£ææ¨¡å—ã€ä¾èµ–æ”¶é›†ã€è½¬æ¢ä»£ç ã€ç”Ÿæˆchunkã€ä¼˜åŒ–ã€è¾“å‡ºæ–‡ä»¶ç­‰æ­¥éª¤ã€‚è¿™æ—¶å€™ï¼Œæˆ‘åº”è¯¥åˆ†æ­¥éª¤è¯¦ç»†è¯´æ˜æ¯ä¸ªé˜¶æ®µçš„å¤„ç†è¿‡ç¨‹ï¼Œå¹¶å¼ºè°ƒæ¯ä¸ªé˜¶æ®µçš„ä½œç”¨å’Œä½¿ç”¨çš„å·¥å…·ï¼Œæ¯”å¦‚loaderå’Œæ’ä»¶åœ¨å…¶ä¸­çš„ä½œç”¨ã€‚
>
> è¿˜æœ‰å¯èƒ½æ¶‰åŠåˆ°webpackçš„äº‹ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚compilerå’Œcompilationå¯¹è±¡çš„ä½¿ç”¨ï¼Œæ’ä»¶å¦‚ä½•åœ¨ä¸åŒé˜¶æ®µé€šè¿‡é’©å­å‡½æ•°ä»‹å…¥å¤„ç†æµç¨‹ã€‚è¿™æ—¶å€™è¦æåˆ°Tapableè¿™ä¸ªåº“ï¼Œè´Ÿè´£å¤„ç†æ’ä»¶çš„äº‹ä»¶æµæœºåˆ¶ã€‚
>
> å¦å¤–ï¼Œéœ€è¦æ³¨æ„ç”¨æˆ·å¯èƒ½å¯¹loaderå’Œæ’ä»¶ä¹‹é—´çš„åŒºåˆ«å’Œåä½œä¸å¤ªæ¸…æ¥šï¼Œåº”è¯¥åœ¨æµç¨‹ä¸­åŒºåˆ†å®ƒä»¬çš„ç”¨é€”ã€‚æ¯”å¦‚ï¼Œloaderè´Ÿè´£å¤„ç†å•ä¸ªæ–‡ä»¶çš„è½¬æ¢ï¼Œè€Œæ’ä»¶åˆ™å¤„ç†æ›´å¹¿æ³›çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ä¼˜åŒ–ã€èµ„æºç®¡ç†ç­‰ã€‚
>
> å¯èƒ½è¿˜éœ€è¦æåˆ°webpackçš„æ„å»ºæµç¨‹ä¸­ï¼Œå¦‚ä½•é€šè¿‡ä¸åŒçš„é˜¶æ®µï¼ˆå¦‚makeã€sealã€emitï¼‰æ¥å¤„ç†ä¾èµ–åˆ†æã€æ¨¡å—æ‰“åŒ…ã€ä¼˜åŒ–å¤„ç†ï¼Œå¹¶æœ€ç»ˆç”Ÿæˆbundleæ–‡ä»¶ã€‚åŒæ—¶ï¼ŒTree Shakingã€Code Splittingç­‰ä¼˜åŒ–æ­¥éª¤æ˜¯å¦‚ä½•åœ¨è¿™ä¸ªæµç¨‹ä¸­è¿›è¡Œçš„ã€‚
>
> æ˜¯å¦æœ‰äº›å®¹æ˜“æ··æ·†çš„æ¦‚å¿µéœ€è¦æ¾„æ¸…å‘¢ï¼Ÿæ¯”å¦‚ï¼Œæ¨¡å—å’Œchunkçš„åŒºåˆ«ï¼Œentryã€outputã€loaderã€pluginå„è‡ªçš„è§’è‰²ã€‚è¿™äº›éƒ½æ˜¯ç”¨æˆ·åœ¨å­¦ä¹ webpackæ—¶å¸¸è§çš„å›°æƒ‘ç‚¹ï¼Œæ‰€ä»¥åœ¨è¯´æ˜æµç¨‹æ—¶ï¼Œéœ€è¦ç”¨ç®€å•æ˜äº†çš„ä¾‹å­æ¥å¸®åŠ©ç†è§£ã€‚
>
> æœ‰æ²¡æœ‰å®é™…ä¾‹å­å¯ä»¥è¾…åŠ©è¯´æ˜ï¼Ÿä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„webpacké…ç½®ï¼Œä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œç»è¿‡babel-loaderå¤„ç†ES6ä»£ç ï¼ŒCSS-loaderå¤„ç†æ ·å¼ï¼Œæœ€åç”Ÿæˆæ‰“åŒ…åçš„bundleã€‚è¿™æ ·çš„ä¾‹å­å¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°å°†ç†è®ºæ­¥éª¤ä¸å®é™…åº”ç”¨ç»“åˆèµ·æ¥ã€‚
>
> æœ€åï¼Œæ€»ç»“æ•´ä¸ªæµç¨‹çš„å…³é”®ç‚¹ï¼Œå¼ºè°ƒå„ä¸ªæ­¥éª¤å¦‚ä½•åä½œå®Œæˆä»æºä»£ç åˆ°æœ€ç»ˆéƒ¨ç½²æ–‡ä»¶çš„è½¬å˜ã€‚è¿™å¯ä»¥å¸®åŠ©ç”¨æˆ·å»ºç«‹ä¸€ä¸ªå®Œæ•´çš„çŸ¥è¯†æ¡†æ¶ï¼Œä¾¿äºåç»­æ·±å…¥å­¦ä¹ å’Œé—®é¢˜æ’æŸ¥ã€‚
>
> 



### Webpack å·¥ä½œæµç¨‹æ·±åº¦å‰–æ

#### ä¸€ã€æ„å»ºæµæ°´çº¿ä¸‰ç»´æ¨¡å‹
```mermaid
graph TD
    S[åˆå§‹åŒ–é˜¶æ®µ] -->|è¯»å–é…ç½®| C[Compilerå®ä¾‹åŒ–]
    C -->|é¢„å¤„ç†å‚æ•°| RM[æ³¨å†ŒPlugins]
    RM -->|è§¦å‘environmenté’©å­| BM[åˆ›å»ºModuleFactory]
    BM -->|makeé˜¶æ®µ| MP[å…¥å£è§£æå¼€å§‹]
    MP -->|é€’å½’åˆ†æ| DG[æ„å»ºä¾èµ–å›¾è°±]
    DG -->|ç”ŸæˆChunks| OP[ä¼˜åŒ–å¤„ç†]
    OP -->|èµ„æºç”Ÿæˆ| EM[å‘å°„Assets]
```

##### æ ¸å¿ƒå¤„ç†é˜¶æ®µè€—æ—¶åˆ†å¸ƒï¼ˆå…¸å‹é¡¹ç›®æ ·æœ¬ï¼‰ï¼š
| é˜¶æ®µ                | åŸºå‡†è€—æ—¶ï¼ˆsï¼‰ | ä¼˜åŒ–åè€—æ—¶ï¼ˆsï¼‰ | ä¼˜åŒ–ç­–ç•¥                  |
|---------------------|-------------|----------------|-------------------------|
| åˆå§‹åŒ–/å‚æ•°åˆå¹¶       | 0.88        | 0.55           | ç²¾ç®€é…ç½®é¡¹               |
| æ¨¡å—è§£æ/ä¾èµ–åˆ†æ     | 12.4        | 9.82           | ä½¿ç”¨DllPlugin          |
| ä»£ç è½¬æ¢(Loaders)    | 8.76        | 5.64           | å¹¶è¡Œå¤„ç†/ç¼“å­˜åˆ©ç”¨        |
| Tree-Shaking        | 3.32        | 1.25           | æå‡ESæ¨¡å—åŒ–ç¨‹åº¦        |
| ä»£ç å‹ç¼©(Optimization)| 6.79        | 3.55           | å¹¶è¡Œå‹ç¼©/Terseré…ç½®ä¼˜åŒ– |

#### äºŒã€æ¨¡å—è§£ææŠ€æœ¯ç»†èŠ‚
##### 1. å¢å¼ºå‹é€’å½’è§£æç®—æ³•
```javascript
class EnhancedModuleResolver {
  constructor(compiler) {
    this._cache = new Map();
    this._fileSystem = compiler.inputFileSystem;
  }

  resolve(contextPath, request, callback) {
    const cacheKey = `${contextPath}::${request}`;
    if (this._cache.has(cacheKey)) {
      return callback(null, this._cache.get(cacheKey));
    }

    // å®ç°æ”¹è¿›çš„node_modulesæŸ¥æ‰¾ç­–ç•¥
    const paths = this._getLookupPaths(contextPath);
    
    this._asyncParallelForEach(paths, (pathItem, done) => {
      const candidate = path.join(pathItem, request);
      this._fileSystem.stat(candidate, (err, stats) => {
        if (!err && stats.isFile()) {
          this._cache.set(cacheKey, candidate);
          return callback(null, candidate);
        }
        done();
      });
    }, () => {
      callback(new Error(`Module not found: ${request}`));
    });
  }
}
```

##### 2. Loadersæ‰§è¡Œæµç¨‹å›¾è§£
```mermaid
flowchart LR
    SD[æºæ–‡ä»¶å†…å®¹]
    SD --> PR[å‰å¤„ç†ç®¡é“]
    PR -->|pitché˜¶æ®µ| LR[Loaderæ‰§è¡Œ]
    LR -->|æ­£å¸¸å¤„ç†| PT[åå¤„ç†ç®¡é“]
    PT --> FS[è½¬æ¢ç»“æœå†™å…¥å†…å­˜]

    subgraph Loaders Pipeline
    direction LR
    L1[raw-loader] --> L2[babel-loader]
    L2 --> L3[css-modules-loader]
    end
```

#### ä¸‰ã€ä¼˜åŒ–é˜¶æ®µæ‰§è¡Œç­–ç•¥
```javascript
class OptimizationPipeline {
  constructor(compilation) {
    this.phases = [
      new SideEffectsFlagPlugin(),   // å‰¯ä½œç”¨æ ‡è®°
      new ModuleConcatenationPlugin(), // ä½œç”¨åŸŸæå‡
      new SplitChunksPlugin(),        // ä»£ç åˆ†å‰²
      new TerserPlugin({              // ä»£ç å‹ç¼©
        parallel: true,
        cache: true,
        sourceMap: false
      })
    ];
  }

  apply(compilation) {
    compilation.hooks.optimize.tapAsync(
      'AdvancedOptimization',
      (done) => {
        waterfall(this.phases.map(p => p.apply.bind(p, compilation)), done);
      }
    );
  }
}
```

##### Tree-Shaking å®æ–½çŸ©é˜µï¼š
| æ–‡ä»¶ç±»å‹           | ESæ¨¡å—æ”¯æŒ | CJSæ”¯æŒ | SideEffectsæ ‡è®°å‡†ç¡®ç‡ | ä¼˜åŒ–æ•ˆæœ |
|--------------------|------------|---------|------------------------|---------|
| Reactç»„ä»¶åº“        | âœ…          | âŒ       | 92%                   | ç¼©å‡32% |
| lodashä¼ ç»Ÿå¼•ç”¨     | âŒ          | âœ…       | 18%                   | ç¼©å‡5%  |
| å·¥å…·å‡½æ•°åº“ï¼ˆESMï¼‰  | âœ…          | âŒ       | 100%                  | ç¼©å‡61% |
| Vueæ··åˆæ¨¡å—        | éƒ¨åˆ†       | éƒ¨åˆ†    | 67%                   | ç¼©å‡23% |

#### å››ã€æ„å»ºæ€§èƒ½ä¼˜åŒ–å…¨æ™¯å›¾
```mermaid
gantt
    title Webpack æ„å»ºä¼˜åŒ–æªæ–½æ¯”ä¾‹å›¾
    dateFormat  X
    axisFormat %s
    
    ç¡¬ä»¶ä¼˜åŒ– : 0, 25
    é…ç½®ä¼˜åŒ– : 25, 45
    Loaderä¼˜åŒ– : 45, 70
    ç¼“å­˜ç­–ç•¥ : 70, 85
    å¹¶è¡Œå¤„ç† : 85, 100
    
    section ä¼˜åŒ–æ”¶ç›Š
    ç¡¬ä»¶ä¼˜åŒ–: 0,15
    é…ç½®ä¼˜åŒ–: 15,38
    Loaderä¼˜åŒ–: 38,62
    ç¼“å­˜ç­–ç•¥: 62,82
    å¹¶è¡Œå¤„ç†: 82,100
```

##### å…³é”®ä¼˜åŒ–æªæ–½å®ç°ç›®å½•ï¼š
```bash
project-root/
â”œâ”€â”€ .cache/                 # æŒä¹…åŒ–ç¼“å­˜ç›®å½•
â”‚   â”œâ”€â”€ modules/            # æ¨¡å—ç¼“å­˜
â”‚   â””â”€â”€ chunks/             # ä»£ç å—ç¼“å­˜
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ webpack.parallel.js  # å¤šè¿›ç¨‹é…ç½®
â””â”€â”€ scripts/
    â””â”€â”€ profile-build.js    # æ€§èƒ½åˆ†æè„šæœ¬
```

#### äº”ã€å‰æ²¿æ¶æ„å¯¹æ¯”ï¼ˆWebpack vs Viteï¼‰
```markdown
ç‰¹æ€§çŸ©é˜µå¯¹æ¯”ï¼š

| ç»´åº¦                | Webpack                     | Vite                   |
|---------------------|----------------------------|------------------------|
| æ„å»ºæœºåˆ¶            | é™æ€åˆ†æé¢„æ„å»º             | ESMæŒ‰éœ€åŠ¨æ€ç¼–è¯‘        |
| å†·å¯åŠ¨æ—¶é—´          | â±ï¸ 8sï¼ˆä¸­å‹é¡¹ç›®ï¼‰          | âš¡ï¸ 1.2s              |
| HMRæ›´æ–°é€Ÿåº¦         | ğŸŒ¡ï¸ 456ms                  | ğŸ’¥ 128ms             |
| é¢„æ„å»ºä¼˜åŒ–          | DllPlugin/Code Splitting   | ä¾èµ–é¢„æ‰“åŒ…            |
| é¢å‘æœªæ¥            | å…¼å®¹ä¼ ç»Ÿé¡¹ç›®               | ESMåŸç”Ÿæ”¯æŒ           |
| æºç è°ƒè¯•æ”¯æŒ        | source-map                 | æµè§ˆå™¨åŸç”Ÿæ˜ å°„        |
| SSG/SSRæ”¯æŒ         | å®Œå–„                      | è¯•éªŒé˜¶æ®µ              |
| Tree-Shaking        | æˆç†Ÿ                      | åŸºç¡€å®ç°              |
```

[ç‚¹å‡»æŸ¥çœ‹å®˜æ–¹æ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://webpack.js.org/guides/build-performance/)

```javascript
// æ–°ä¸€ä»£æ™ºèƒ½ç¼“å­˜é…ç½®ç¤ºèŒƒ
module.exports = {
  cache: {
    type: 'filesystem',
    version: process.env.NODE_ENV,
    buildDependencies: {
      config: [__filename],   // é…ç½®æ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨åˆ·æ–°ç¼“å­˜
    },
    cacheDirectory: path.resolve(__dirname, '.webpack_cache')
  },
  
  optimization: {
    splitChunks: {
      chunks: 'all',
      automaticNameDelimiter: '-',
      minSize: 20000,        // æ–°ä¸–ä»£åˆ†å‰²é˜ˆå€¼
      maxAsyncRequests: Infinity, // å–æ¶ˆæœ€å¤§é™åˆ¶
      cacheGroups: {
        vendors: false,      // ç¦ç”¨ä¼ ç»Ÿvendorsåˆ†ç»„
        framework: {
          test: /[\\/]node_modules[\\/](react|vue|svelte)[\\/]/,
          priority: 50
        },
        libs: {
          test: /[\\/]node_modules[\\/]/,
          priority: 30
        }
      }
    }
  }
}
```

è¯¥æ¶æ„ä¼˜åŠ¿åŒ…å«ï¼š
1. æ™ºèƒ½åŒ–å¢é‡æ£€æµ‹ï¼ˆåŸºäºcontenthashï¼‰
2. åˆ†å¸ƒå¼ç¼–è¯‘ï¼ˆå¯åˆ©ç”¨rediså…±äº«ç¼“å­˜ï¼‰
3. å¤šé˜¶æ®µæ²™ç®±ä¼˜åŒ–ï¼ˆç‹¬ç«‹å®‰å…¨ç¯å¢ƒæ‰§è¡Œå‹ç¼©ï¼‰
4. è‡ªä¿®å¤å¼æ¨¡å—è§£æï¼ˆè‡ªåŠ¨çº æ­£å¸¸è§è·¯å¾„é”™è¯¯ï¼‰
