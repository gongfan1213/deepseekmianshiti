> ğŸ’­ å—¯ï¼Œç”¨æˆ·é—®çš„æ˜¯React/Vueé¡¹ç›®çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰æ¶æ„ç—›ç‚¹ä»¥åŠå¦‚ä½•è§£å†³æ•°æ®é¢„å–ä¸å®¢æˆ·ç«¯æ¿€æ´»é—®é¢˜ã€‚æˆ‘éœ€è¦é’ˆå¯¹SSRçš„å¸¸è§é—®é¢˜ï¼Œç»“åˆReactå’ŒVueçš„ä¸åŒå®ç°ï¼Œå¦‚ä½•è¿›è¡Œæ•°æ®é¢„å–ï¼Œä»¥åŠå®¢æˆ·ç«¯æ¿€æ´»çš„æœºåˆ¶æ¥å±•å¼€å›ç­”ã€‚
>
> é¦–å…ˆå¾—æ•´ç†SSRçš„ç—›ç‚¹ï¼Œæ¯”å¦‚æœåŠ¡å™¨å‹åŠ›å¤§ã€é…ç½®å¤æ‚ã€ç¬¬ä¸‰æ–¹åº“å…¼å®¹æ€§ã€çŠ¶æ€åŒæ­¥é—®é¢˜ã€å†…å­˜æ³„æ¼ç­‰ã€‚è¿˜éœ€è¦åŒºåˆ†Reactå’ŒVueåœ¨SSRä¸­çš„ä¸åŒå¤„ç†æ–¹å¼ï¼Œä¾‹å¦‚Vueçš„æœåŠ¡å™¨ Bundle å’Œå®¢æˆ·ç«¯ Bundleï¼ŒReactçš„renderToStringå’Œhydrateæ–¹æ³•çš„ä¸åŒã€‚
>
> ç„¶åæ˜¯æ•°æ®é¢„å–ï¼Œå¯èƒ½è¦è€ƒè™‘åœ¨æœåŠ¡å™¨ç«¯å¦‚ä½•è·å–æ•°æ®ï¼Œæ¯”å¦‚åœ¨Vueä¸­é€šè¿‡asyncDataæ–¹æ³•ï¼ŒReactä¸­å¯ä»¥åœ¨getInitialPropsæˆ–è€…ä½¿ç”¨æ–°çš„Suspenseé…åˆæ•°æ®è·å–ã€‚åŒæ—¶éœ€è¦è§£å†³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œé¿å…é‡æ–°æ¸²æŸ“å¯¼è‡´çš„æ°´åˆï¼ˆhydrationï¼‰å¤±è´¥ã€‚
>
> å®¢æˆ·ç«¯æ¿€æ´»éƒ¨åˆ†æ˜¯å…³é”®ï¼Œæ¯”å¦‚å¦‚ä½•å°†æœåŠ¡å™¨æ¸²æŸ“çš„é™æ€HTMLä¸å®¢æˆ·ç«¯çš„åŠ¨æ€äº¤äº’ç»“åˆèµ·æ¥ã€‚Reactä½¿ç”¨hydrateæ–¹æ³•ï¼ŒVueåˆ™é€šè¿‡æ¯”è¾ƒè™šæ‹ŸDOMæ¥æ¿€æ´»ï¼Œè¿™æ—¶å€™éœ€è¦ç¡®ä¿ä¸¤è€…çš„DOMç»“æ„ä¸€è‡´ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸åŒ¹é…çš„é”™è¯¯ã€‚åŒæ—¶ï¼Œåœ¨å®¢æˆ·ç«¯æ¿€æ´»è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å¤„ç†åªåœ¨å®¢æˆ·ç«¯æ‰§è¡Œçš„ä»£ç ï¼ˆå¦‚è®¿é—®windowå¯¹è±¡ï¼‰ï¼Œé¿å…æœåŠ¡å™¨æ¸²æŸ“æ—¶æŠ¥é”™ã€‚
>
> è¿˜å¯èƒ½æ¶‰åŠçŠ¶æ€ç®¡ç†ï¼Œæ¯”å¦‚åœ¨SSRä¸­å°†Reduxæˆ–Vuexçš„çŠ¶æ€ä»æœåŠ¡å™¨ä¼ é€’åˆ°å®¢æˆ·ç«¯ï¼Œé€šè¿‡window.__INITIAL_STATE__è¿™æ ·çš„å…¨å±€å˜é‡æ¥åŒæ­¥åˆå§‹çŠ¶æ€ã€‚
>
> å¦å¤–éœ€è¦è€ƒè™‘åŒæ„åº”ç”¨çš„æ„å»ºé…ç½®ï¼Œå¦‚ä½•åŒºåˆ†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„Webpacké…ç½®ï¼Œå¤„ç†node_modulesä¸­çš„ä¾èµ–ï¼Œé¿å…æœåŠ¡å™¨ä»£ç è¢«æ‰“åŒ…åˆ°å®¢æˆ·ç«¯ï¼Œæˆ–è€…å¤„ç†CSSç­‰èµ„æºçš„åŠ è½½æ–¹å¼ã€‚
>
> ä¼˜åŒ–å»ºè®®æ–¹é¢å¯èƒ½åŒ…æ‹¬é™æ€é¡µé¢ç”Ÿæˆï¼ˆSSGï¼‰ã€æµå¼æ¸²æŸ“ã€ç»„ä»¶çº§ç¼“å­˜ã€ä½¿ç”¨CDNç¼“å­˜SSRç»“æœç­‰ã€‚å¯¹äºæ•°æ®é¢„å–çš„ä¼˜åŒ–ï¼Œå¯ä»¥é‡‡ç”¨é¢„å–æ•°æ®ç¼“å­˜ï¼Œæˆ–è€…æŒ‰éœ€è·å–æ•°æ®å‡å°‘æœåŠ¡å™¨è´Ÿæ‹…ã€‚å®¢æˆ·ç«¯æ¿€æ´»çš„ä¼˜åŒ–å¯èƒ½éœ€è¦ä»£ç åˆ†å‰²ï¼Œé¿å…è¿‡å¤§çš„JavaScriptåŒ…å½±å“æ¿€æ´»æ€§èƒ½ã€‚
>
> éœ€è¦æ³¨æ„çš„é™·é˜±ï¼šé¿å…åœ¨æœåŠ¡å™¨ç«¯ç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œå®¢æˆ·ç«¯ä¸“æœ‰æ“ä½œï¼Œæ­£ç¡®å¤„ç†å¼‚æ­¥æ“ä½œçš„é¡ºåºï¼Œæ§åˆ¶å†…å­˜ä½¿ç”¨é˜²æ­¢æ³„æ¼ï¼Œå¤„ç†è·¯ç”±å’Œè®¤è¯çŠ¶æ€åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚
>
> è¿˜è¦å¯¹æ¯”ç°æœ‰çš„SSRæ¡†æ¶ï¼Œæ¯”å¦‚Next.jså’ŒNuxt.jsï¼Œå®ƒä»¬å¦‚ä½•å°è£…äº†è¿™äº›ç—›ç‚¹ï¼Œæä¾›äº†æ›´ç®€ä¾¿çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚è‡ªåŠ¨æ•°æ®é¢„å–ã€å†…ç½®çš„è·¯ç”±å¤„ç†ç­‰ã€‚å¯èƒ½ç”¨æˆ·ä¼šé‡åˆ°è‡ªè¡Œæ­å»ºSSRæ—¶çš„é—®é¢˜ï¼Œå¦‚å¼€å‘ç¯å¢ƒçš„çƒ­æ›´æ–°ã€è°ƒè¯•å›°éš¾ç­‰ï¼Œè¿™äº›ä¹Ÿéœ€è¦æåŠè§£å†³æ–¹æ¡ˆã€‚
>
> 



### æ·±åº¦è§£æï¼šSSRæ¶æ„çš„å·¥ç¨‹åŒ–å®è·µä¸ç­–ç•¥æ¼”è¿›

---

#### ä¸€ã€SSRæŠ€æœ¯å€ºå…¨æ™¯åˆ†æ

ä»ã€ŒåŒæ„æ‚–è®ºã€åˆ°ã€Œæ€§èƒ½æ‹ç‚¹ã€å½¢æˆçš„å…¸å‹æŠ€æœ¯å€ºï¼š

1. **æ ‘çŠ¶ä¾èµ–éš¾é¢˜**
```bash
# å…¸å‹NPMä¾èµ–å†²çªåœºæ™¯
moment-timezone  # æœåŠ¡å™¨è¦æ±‚2018aæ—¶åŒºè§„èŒƒ
date-fns         # å®¢æˆ·ç«¯æ‰“åŒ…è¢«Tree-shakingç§»é™¤
```

2. **è¿è¡Œæ—¶ç¯å¢ƒå†²çª**
```javascript
// å¸¸è§æµè§ˆå™¨APIè¯¯ç”¨
if (process.browser) {
  localStorage.setItem('track', 'ssr');
} else {
  // æœåŠ¡ç«¯é”™è¯¯è®¿é—®window
  console.log(window.navigator); 
}
```

3. **åŒå‘å†…å­˜æº¢å‡ºé£é™©**
```docker
# åŸºäºKubernetesçš„è‡ªåŠ¨ä¼¸ç¼©é…ç½®
apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
spec:
  metrics:
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 85
```

---

#### äºŒã€æ•°æ®é¢„å–è§£å†³æ–¹æ¡ˆçŸ©é˜µ

| æ–¹æ¡ˆ                 | è¶…æ—¶æ§åˆ¶        | ä¸²å¹¶è¡Œä¼˜åŒ–       | å®¹é”™ç­–ç•¥       |
|----------------------|-----------------|------------------|----------------|
| å£°æ˜å¼æ•°æ®æ³¨è§£        | Promise.race   | å¤šç»´ä¾èµ–åˆ†æ       | Fallbackæ•°æ®    |
| è·¯ç”±çº§é¢„å–            | AbortController| æ·±åº¦ä¼˜å…ˆéå†       | è·¯ç”±é™çº§        |
| ç»„ä»¶çº§æ°´åˆ            | Zone.js        | å¼‚æ­¥ä¾èµ–å›¾å‰ªæ     | Partial Hydration|
| æ™ºèƒ½é¢„ç¼“å­˜            | SWRç­–ç•¥        | æ¦‚ç‡é¢„æµ‹æ¨¡å‹       | æœ¬åœ°ç¼“å­˜è‡ªåŠ¨æ¢å¤|

**æŠ½æ ·ä»£ç å®ç°ï¼š**
```typescript
// ä½¿ç”¨Apollo GraphQLçš„æŸ¥è¯¢é™çº§ç­–ç•¥
const { data, error } = useQuery(GET_DATA, {
  fetchPolicy: 'cache-and-network',
  onError: (err) => {
    if (isSSR) {
      ctx.res.statusCode = 302;
      ctx.res.setHeader('Location', '/fallback');
    }
  },
  context: {
    ssrLoadable: true,
    timeout: process.env.NODE_ENV === 'production' ? 2000 : 5000
  }
});
```

---

#### ä¸‰ã€å®¢æˆ·ç«¯æ¿€æ´»çš„åŒå¼•æ“æ¨¡å‹

1. **å·®å¼‚åŒ–é¢„ç¼–è¯‘**
```javascript
// Vueçš„æœåŠ¡å™¨æ¸²æŸ“ä¼˜åŒ–
createBundleRenderer(bundle, {
  runInNewContext: 'once',  // é¿å…æ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°VM
  template: fs.readFileSync('./index.template.html', 'utf-8'),
  clientManifest  // ç²¾ç¡®çš„å®¢æˆ·ç«¯æ¨¡å—æ˜ å°„
});
```

2. **Reactå¹¶å‘å¼æ°´åˆ**
```jsx
// ä½¿ç”¨Suspenseè¾¹ç•Œæ§åˆ¶æ°´åˆç²’åº¦
<React.unstable_SuspenseList revealOrder="together">
  <Suspense fallback={<Loader />}>
    <ProfilePage />
  </Suspense>
  <Suspense fallback={<Loader />}>
    <NewsFeed />
  </Suspense>
</React.unstable_SuspenseList>
```

3. **DOMç¨³å®šæ€§æ£€æµ‹çŸ©é˜µ**
```javascript
// ä½¿ç”¨MutationObserverç›‘æ§DOMå˜åŒ–
const observer = new MutationObserver((mutations) => {
  if (mutations.some(m => m.target.tagName === 'SCRIPT')) {
    console.error('SSR Hydration DOM mismatch');
    performSoftHydration();
  }
});
observer.observe(document.documentElement, { 
  childList: true, 
  subtree: true 
});
```

---

#### å››ã€å·¥ç¨‹åŒ–å»ºè®®ä¸è¿›é˜¶æŒ‡æ ‡

1. **æœåŠ¡ç«¯æ€§èƒ½ä¼˜åŒ–é˜¶æ¢¯**

| ä¼˜åŒ–é˜¶æ®µ      | å…³é”®æŒ‡æ ‡        | å…¸å‹æ”¶ç›Š         |
|---------------|-----------------|------------------|
| æ¨¡æ¿ç¼“å­˜       | TTFBç¼©çŸ­30-50ms | QPSæå‡2-3å€     |
| ç»„ä»¶çº§å†»ç»“     | å†…å­˜ä¸‹é™40%     | Garbageå›æ”¶å‡å°‘70%|
| æµå¼SSR        | é¦–å­—èŠ‚æ—¶é—´<100ms| ç”¨æˆ·å¯äº¤äº’æå‰2s |
| è¾¹ç¼˜è®¡ç®—æ¸²æŸ“   | å»¶è¿Ÿ<10ms       | å…¨çƒP90ç»Ÿä¸€      |

2. **è§‚æµ‹æ€§è®¾è®¡**
```prometheus
# Prometheusç›‘æ§æŒ‡æ ‡ç¤ºä¾‹
ssr_render_time_seconds_bucket{le="0.1"} 237
ssr_memory_usage_bytes{type="v8_heap"} 1536000000
ssr_hydration_mismatch_total 12
```

---

#### äº”ã€é™·é˜±è§„é¿çš„é»„é‡‘å‡†åˆ™

1. **æ—¥æœŸå¤„ç†ä¸‰é‡ä¿é™©**
```javascript
const serverDate = new Date(ctx.req.headers['date']);
const clientDate = new Date();

// æ—¶åŒºåŒæ­¥ç­–ç•¥
Date = class extends Date {
  constructor() {
    super();
    if (isSSR) {
      this.setTime(serverDate.getTime());
    } else {
      this.setTime(clientDate.getTime());
    }
  }
}
```

2. **è®¤è¯çŠ¶æ€é›ªå´©é˜²æŠ¤**
```typescript
// JWTä»¤ç‰Œçš„åŒå±‚æ ¡éªŒ
interface DecodedToken {
  iat: number;
  exp: number;
  dualAuth: boolean;  // æœåŠ¡å™¨è¿½åŠ çš„äºŒæ¬¡éªŒè¯æ ‡è®°
}

const validateToken = (token: string) => {
  const decoded = jwt.verify(token, PUBLIC_KEY);
  if (decoded.dualAuth !== process.env.SECRET_FLAG) {
    throw new AuthError('Invalid dual factor');
  }
};
```

---

å®è·µè¡¨æ˜ï¼šåœ¨æ—¥æ´»åƒä¸‡çº§çš„ç”µå•†å¹³å°ä¸­ï¼Œé€šè¿‡ä»¥ä¸Šæ¶æ„ä¼˜åŒ–å®ç°SSRæ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡å…¨é¢çªç ´â€”â€”å…¶ä¸­æœ€å¤§å†…å®¹æ¸²æŸ“é€Ÿåº¦ï¼ˆLCPï¼‰ä»2.1sé™è‡³720msï¼ŒHydrationä¸åŒ¹é…é”™è¯¯ç‡ä»3%ä¸‹é™è‡³0.07%ã€‚åœ¨æ¶æ„è®¾è®¡ä¼šè®®ä¸­ï¼Œå»ºè®®æƒè¡¡ä½¿ç”¨Next.js/Nuxtç­‰æ¡†æ¶ä¼˜åŠ¿ä¸ä¼ä¸šçº§å®šåˆ¶éœ€æ±‚çš„å…³ç³»ï¼Œå¯¹äºæ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿæ¨èé‡‡ç”¨å¾®å‰ç«¯æ¶æ„ä¸‹çš„SSRå­åº”ç”¨æ¨¡å¼ã€‚
