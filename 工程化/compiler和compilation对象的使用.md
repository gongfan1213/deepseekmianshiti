> ğŸ’­ å—¯ï¼Œç”¨æˆ·é—®çš„æ˜¯compilerå’Œcompilationå¯¹è±¡åœ¨Webpackä¸­çš„ä½¿ç”¨ã€‚é¦–å…ˆå¾—ç¡®è®¤ä»–ä»¬çš„çŸ¥è¯†ç‚¹æ˜¯å¦è¶³å¤Ÿã€‚å¯èƒ½ä»–ä»¬æƒ³äº†è§£è¿™ä¸¤ä¸ªå¯¹è±¡çš„ç»“æ„å’Œä½œç”¨ã€‚å¯èƒ½éœ€è¦ä»åŸºæœ¬æ¦‚å¿µè®²èµ·ï¼Œæ¯”å¦‚compileræ˜¯Webpackçš„æ ¸å¿ƒå¼•æ“ï¼Œè´Ÿè´£æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œè€Œcompilationåˆ™åœ¨å¤„ç†æ¯æ¬¡æ„å»ºæ—¶çš„æ•°æ®ã€‚
>
> ç”¨æˆ·å¯èƒ½å®é™…åœ¨ç¼–å†™è‡ªå®šä¹‰æ’ä»¶æˆ–é…ç½®é«˜çº§æ„å»ºæµç¨‹æ—¶é‡åˆ°é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦çŸ¥é“å¦‚ä½•è®¿é—®å’Œæ“ä½œè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚æˆ‘åº”è¯¥ä¸¾ä¾‹è¯´æ˜å¦‚ä½•åœ¨æ’ä»¶ä¸­åˆ©ç”¨å®ƒä»¬ï¼Œæ¯”å¦‚è®°å½•ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¿®æ”¹æ¨¡å—æˆ–èµ„æºã€‚
>
> è¿˜è¦æåˆ°compilerå’Œcompilationçš„å…³ç³»ï¼Œæ¯”å¦‚compilerç”Ÿæˆcompilationå®ä¾‹ï¼Œæ¯ä¸ªbuildå¯èƒ½æœ‰ä¸åŒçš„compilationã€‚éœ€è¦è§£é‡Šå®ƒä»¬çš„èŒè´£åŒºåˆ†ï¼Œæ¯”å¦‚compilerå¤„ç†å…¨å±€é…ç½®ï¼Œå¯åŠ¨æµç¨‹ï¼Œè€Œcompilationå¤„ç†æ¨¡å—ä¾èµ–å›¾ã€ä¼˜åŒ–ç­‰ã€‚
>
> å¦å¤–ï¼Œè¦æ³¨æ„é”™è¯¯å¤„ç†ï¼Œä»¥åŠèµ„æºæ“ä½œçš„å¸¸ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚emité’©å­ä¿®æ”¹è¾“å‡ºå†…å®¹ã€‚å¯èƒ½éœ€è¦æç¤ºç”¨æˆ·å¸¸ç”¨çš„é’©å­æœ‰å“ªäº›ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒä»¬ï¼Œé¿å…å¸¸è§é™·é˜±ï¼Œæ¯”å¦‚åœ¨ç‰¹å®šé˜¶æ®µä¿®æ”¹èµ„æºæ˜¯å¦æœ‰æ•ˆã€‚
>
> æœ€åç¡®ä¿è¯­è¨€é€šä¿—ï¼Œä¾‹å­é‡Œç”¨å®é™…çš„ä»£ç ç‰‡æ®µï¼Œæ¯”å¦‚æ’ä»¶ä¸­çš„applyå‡½æ•°ï¼Œtapæ–¹æ³•æ³¨å†Œé’©å­å›è°ƒã€‚è¿™æ ·ç”¨æˆ·èƒ½æ›´å¥½åœ°ç†è§£å¦‚ä½•åº”ç”¨è¿™äº›å¯¹è±¡åˆ°å®é™…é¡¹ç›®ä¸­ã€‚
>
> 



åœ¨ Webpack ä¸­ï¼Œ`compiler` å’Œ `compilation` æ˜¯ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡ï¼Œä¸»è¦ç”¨åœ¨æ’ä»¶å’Œè‡ªå®šä¹‰æ„å»ºæµç¨‹å¼€å‘ä¸­ã€‚å®ƒä»¬æä¾›äº†ä¸æ„å»ºè¿‡ç¨‹æ·±åº¦äº¤äº’çš„èƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„æ ¸å¿ƒç”¨é€”å’Œä½¿ç”¨æ–¹æ³•ï¼š

---

### ä¸€ã€`compiler` å¯¹è±¡
- **è§’è‰²**ï¼šWebpack çš„ä¸­å¤®å¼•æ“ï¼Œä»£è¡¨å®Œæ•´çš„é…ç½®ç¯å¢ƒ
- **ç”Ÿå‘½å‘¨æœŸ**ï¼šä»å¯åŠ¨åˆ°ç»“æŸå…¨ç¨‹å­˜åœ¨
- **è®¿é—®æ–¹å¼**ï¼šåœ¨æ’ä»¶ä¸­é€šè¿‡ `apply(compiler)` è·å–
- **ä¸»è¦åŠŸèƒ½**ï¼š
  - è®¿é—®å…¨å±€é…ç½® (`compiler.options`)
  - æ§åˆ¶æ„å»ºå¯åŠ¨ (`compiler.run()`)
  - ç›‘å¬å…¨å±€ç”Ÿå‘½å‘¨æœŸé’©å­

**å…¸å‹ä½¿ç”¨åœºæ™¯**ï¼š
```javascript
class MyPlugin {
  apply(compiler) {
    // ç›‘å¬ "beforeRun" ç”Ÿå‘½å‘¨æœŸ
    compiler.hooks.beforeRun.tap('MyPlugin', () => {
      console.log('æ„å»ºå³å°†å¼€å§‹');
    });

    // è®¿é—® webpack é…ç½®
    console.log('å½“å‰æ¨¡å¼:', compiler.options.mode);
  }
}
```

---

### äºŒã€`compilation` å¯¹è±¡
- **è§’è‰²**ï¼šå•æ¬¡æ„å»ºè¿‡ç¨‹çš„æŠ½è±¡ï¼ŒåŒ…å«å½“å‰æ¨¡å—å›¾ã€ç”Ÿæˆçš„èµ„æºç­‰ä¿¡æ¯
- **ç”Ÿå‘½å‘¨æœŸ**ï¼šæ¯æ¬¡æ„å»ºï¼ˆåŒ…æ‹¬ watch æ¨¡å¼ä¸‹çš„å¢é‡æ„å»ºï¼‰éƒ½ä¼šæ–°å»º
- **è®¿é—®æ–¹å¼**ï¼šé€šè¿‡ compiler é’©å­è·å¾—ï¼ˆå¦‚ `compilation` é’©å­ï¼‰
- **ä¸»è¦åŠŸèƒ½**ï¼š
  - æ¨¡å—ä¾èµ–å…³ç³»å¤„ç†
  - èµ„æºç”Ÿæˆä¸ä¼˜åŒ–
  - æä¾›è¯¦ç»†æ„å»ºä¿¡æ¯ï¼ˆassetsã€modulesã€chunksï¼‰

**å…¸å‹ä½¿ç”¨åœºæ™¯**ï¼š
```javascript
compiler.hooks.compilation.tap('MyPlugin', (compilation) => {
  // ç›‘å¬èµ„æºç”Ÿæˆé˜¶æ®µ
  compilation.hooks.optimizeChunkAssets.tap('MyPlugin', (chunks) => {
    chunks.forEach(chunk => {
      chunk.files.forEach(file => {
        console.log('å¤„ç†æ–‡ä»¶:', file);
      });
    });
  });
});
```

---

### ä¸‰ã€å…³é”®åŒºåˆ«
|                 | compiler                     | compilation               |
|-----------------|-----------------------------|---------------------------|
| **ç”Ÿå‘½å‘¨æœŸ**      | æ•´ä¸ª Webpack è¿è¡ŒæœŸé—´         | å•æ¬¡æ„å»ºæœŸé—´               |
| **æ•°æ®ç»“æ„**      | å…¨å±€é…ç½®å’ŒçŠ¶æ€               | å½“å‰æ„å»ºçš„æ¨¡å—/èµ„æº/ä¾èµ–ä¿¡æ¯ |
| **ä¸»è¦ç”¨é€”**      | æ§åˆ¶æ„å»ºå¯åœã€ç›‘å¬å…¨å±€äº‹ä»¶    | æ“ä½œå…·ä½“æ¨¡å—å’Œèµ„æº         |

---

### å››ã€é«˜çº§ç”¨æ³•
#### 1. ä¿®æ”¹èµ„æºå†…å®¹
```javascript
compiler.hooks.emit.tap('MyPlugin', (compilation) => {
  // ä¿®æ”¹å³å°†è¾“å‡ºçš„æ–‡ä»¶
  const asset = compilation.assets['main.js'];
  asset.source = () => '// è‡ªå®šä¹‰å†…å®¹\n' + asset.source();
});
```

#### 2. å¤„ç†ç‰¹å®šæ–‡ä»¶ç±»å‹
```javascript
compilation.hooks.buildModule.tap('MyPlugin', (module) => {
  if (module.resource && module.resource.endsWith('.vue')) {
    console.log('å¤„ç† Vue æ–‡ä»¶:', module.resource);
  }
});
```

#### 3. è‡ªå®šä¹‰è¿›åº¦æŠ¥å‘Š
```javascript
compiler.hooks.compilation.tap('MyPlugin', (compilation) => {
  compilation.hooks.seal.tap('MyPlugin', () => {
    console.log('å¼€å§‹å°è£…é˜¶æ®µ...');
  });
});
```

---

### äº”ã€æœ€ä½³å®è·µ
1. **åˆç†é€‰æ‹©é’©å­å±‚çº§**ï¼š
   - å…¨å±€æ€§é…ç½®æ“ä½œä½¿ç”¨ `compiler` çº§åˆ«é’©å­
   - èµ„æºå¤„ç†ä½¿ç”¨ `compilation` çº§åˆ«é’©å­

2. **æ³¨æ„å†…å­˜ç®¡ç†**ï¼š
   - é¿å…åœ¨ `compilation` ä¸­ä¿å­˜é•¿æœŸå¼•ç”¨
   - ä½¿ç”¨ `compiler.hooks.watchClose` è¿›è¡Œæ¸…ç†

3. **é”™è¯¯å¤„ç†**ï¼š
```javascript
compilation.hooks.failedModule.tap('MyPlugin', (module, error) => {
  console.error('æ¨¡å—ç¼–è¯‘å¤±è´¥:', module.identifier());
});
```

è¿™äº›å¯¹è±¡èµ‹äºˆäº† Webpack æå¼ºçš„æ‰©å±•æ€§ï¼Œç†Ÿç»ƒæŒæ¡éœ€è¦ç»“åˆ [Webpack ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾](https://webpack.js.org/api/compiler-hooks/#hooks) å®é™…è°ƒè¯•åˆ†æã€‚
