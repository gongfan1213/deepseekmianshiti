好的，我来根据您提供的文章链接：[https://segmentfault.com/a/1190000039165592](https://segmentfault.com/a/1190000039165592) （关于TCP 三次握手和四次挥手，满分回答在此），详细整理 TCP 三次握手和四次挥手的内容。

**TCP 三次握手 (Three-Way Handshake)**

TCP 三次握手是建立 TCP 连接的过程，它确保了客户端和服务器双方都具备发送和接收数据的能力。

**图解过程**

```
客户端                  服务器
  |                       |
  | ---- SYN (seq=x) ---> |  (1. 客户端发起连接请求)
  |                       |
  | <--- SYN + ACK (seq=y, ack=x+1) ---- | (2. 服务器确认并分配资源)
  |                       |
  | ---- ACK (seq=x+1, ack=y+1) ---> | (3. 客户端确认连接建立)
  |                       |
  |      连接已建立         |
```

**详细步骤**

1.  **第一次握手 (SYN):**
    *   客户端向服务器发送一个 SYN（同步）报文段。
    *   SYN 报文段包含：
        *   **SYN 标志位：** 设置为 1，表示这是一个连接请求。
        *   **序列号 (Sequence Number, seq):**  客户端选择一个初始序列号 x。
    *   客户端进入 `SYN_SENT` 状态。

2.  **第二次握手 (SYN + ACK):**
    *   服务器收到客户端的 SYN 报文段后，如果同意建立连接，会向客户端发送一个 SYN + ACK 报文段。
    *   SYN + ACK 报文段包含：
        *   **SYN 标志位：** 设置为 1。
        *   **ACK 标志位：** 设置为 1，表示这是一个确认报文。
        *   **序列号 (seq):** 服务器选择一个初始序列号 y。
        *   **确认号 (Acknowledgment Number, ack):** 设置为 x + 1，表示期望收到客户端的下一个序列号。
    *   服务器进入 `SYN_RCVD` 状态。

3.  **第三次握手 (ACK):**
    *   客户端收到服务器的 SYN + ACK 报文段后，会向服务器发送一个 ACK 报文段。
    *   ACK 报文段包含：
        *   **ACK 标志位：** 设置为 1。
        *   **序列号 (seq):** 设置为 x + 1。
        *   **确认号 (ack):** 设置为 y + 1，表示期望收到服务器的下一个序列号。
    *   客户端进入 `ESTABLISHED` 状态。服务器收到 ACK 报文段后，也进入 `ESTABLISHED` 状态。

**三次握手的目的**

*   **确认双方的发送和接收能力：** 确保客户端和服务器都能发送和接收数据。
*   **同步序列号：** 双方交换初始序列号，用于后续的数据传输和可靠性保证。
*   **防止旧的重复连接：** 避免历史连接请求被误认为是新的连接请求。

**TCP 四次挥手 (Four-Way Handshake)**

TCP 四次挥手是终止 TCP 连接的过程，它确保了客户端和服务器双方都同意关闭连接，并释放资源。

**图解过程**

```
客户端                  服务器
  |                       |
  | ---- FIN (seq=u) ---> |  (1. 客户端请求关闭连接)
  |                       |
  | <--- ACK (seq=v, ack=u+1) ---- | (2. 服务器确认关闭请求)
  |                       |
  | <--- FIN (seq=v) ---- |  (3. 服务器请求关闭连接)
  |                       |
  | ---- ACK (seq=u+1, ack=v+1) ---> | (4. 客户端确认关闭)
  |                       |
  |      连接已关闭         |
```

**详细步骤**

1.  **第一次挥手 (FIN):**
    *   客户端向服务器发送一个 FIN（结束）报文段，表示客户端没有数据要发送了，请求关闭连接。
    *   FIN 报文段包含：
        *   **FIN 标志位：** 设置为 1。
        *   **序列号 (seq):**  假设为 u。
    *   客户端进入 `FIN_WAIT_1` 状态。

2.  **第二次挥手 (ACK):**
    *   服务器收到客户端的 FIN 报文段后，会向客户端发送一个 ACK 报文段，表示已收到客户端的关闭请求。
    *   ACK 报文段包含：
        *   **ACK 标志位：** 设置为 1。
        *   **序列号 (seq):** 假设为 v。
        *   **确认号 (ack):** 设置为 u + 1。
    *   服务器进入 `CLOSE_WAIT` 状态。客户端进入 `FIN_WAIT_2` 状态。
    *   **注意：** 此时，连接处于半关闭状态。客户端不能再发送数据，但仍然可以接收数据。服务器可能还有数据要发送。

3.  **第三次挥手 (FIN):**
    *   当服务器也没有数据要发送时，会向客户端发送一个 FIN 报文段，表示服务器也请求关闭连接。
    *   FIN 报文段包含：
        *   **FIN 标志位：** 设置为 1。
        *   **序列号 (seq):** 设置为 v（与第二次挥手中的序列号相同）。
    *   服务器进入 `LAST_ACK` 状态。

4.  **第四次挥手 (ACK):**
    *   客户端收到服务器的 FIN 报文段后，会向服务器发送一个 ACK 报文段，表示已收到服务器的关闭请求。
    *   ACK 报文段包含：
        *   **ACK 标志位：** 设置为 1。
        *   **序列号 (seq):** 设置为 u + 1。
        *   **确认号 (ack):** 设置为 v + 1。
    *   客户端进入 `TIME_WAIT` 状态。等待 2MSL（Maximum Segment Lifetime，报文最大生存时间）后，客户端关闭连接。
    *   服务器收到 ACK 报文段后，立即关闭连接。

**四次挥手的目的**

*   **确保双方都同意关闭连接：** 避免一方在另一方不知情的情况下关闭连接，导致数据丢失。
*   **优雅地关闭连接：** 允许双方在关闭连接之前发送完所有剩余的数据。
*    **TIME_WAIT状态**：防止旧的重复连接

**关键概念补充**
* SYN: (Synchronize)用于建立连接。
* ACK: (Acknowledge)用于确认收到的数据包。
* FIN: (Finish)用于关闭连接。
* seq: 报文序号。
* ack: 确认号, 确认收到对方哪个序号之前的报文.

希望这份整理对您有所帮助！


---
**消息来源**
- [详解TCP 三次握手、四次挥手，附带精美图解和超高频面试题](https://segmentfault.com/a/1190000022410446)
- [关于TCP 三次握手和四次挥手，满分回答在此](https://segmentfault.com/a/1190000039165592)
- [简述TCP三次握手和四次挥手过程](https://segmentfault.com/a/1190000025153419)
- [tcp-ip - “三次握手，四次挥手”你真的懂吗？ - 码农桃花源](https://segmentfault.com/a/1190000018170885)
- [TCP总结：TCP 三次握手和四次挥手- 面试](https://segmentfault.com/a/1190000039142786)
- [三次握手、四次挥手](https://segmentfault.com/a/1190000044493828)
- [TCP 三次握手和四次挥手详解](https://segmentfault.com/a/1190000040571193)
- [三次握手、四次挥手以及TCP标志位的详细介绍](https://segmentfault.com/a/1190000021151221)
- [TCP 的三次握手，四次挥手和重要的细节—干货满满，建议细读](https://segmentfault.com/a/1190000021252464)
- [深入解析：HTTP和HTTPS的三次握手与四次挥手](https://segmentfault.com/a/1190000045536632)
